(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{371:function(t,a,s){t.exports=s.p+"assets/img/fragment_life.e3e37dc0.jpeg"},471:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"android基础"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#android基础"}},[t._v("#")]),t._v(" Android基础")]),t._v(" "),n("p",[t._v("[TOC]")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/7bb56481063d",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考1"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"四大组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四大组件"}},[t._v("#")]),t._v(" 四大组件")]),t._v(" "),n("h4",{attrs:{id:"_1-生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-生命周期"}},[t._v("#")]),t._v(" 1. 生命周期")]),t._v(" "),n("h5",{attrs:{id:"_1-activity声明周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-activity声明周期"}},[t._v("#")]),t._v(" 1. Activity声明周期？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("生命周期")]),t._v(" "),n("p",[t._v("**normal:**onCreate->onStart()->onResume->onPause()->onStop()->onDestroy();")]),t._v(" "),n("p",[n("strong",[t._v("the acitvity comes to the foreground:")]),t._v(" onStop()->onRestart()->onStart->...")]),t._v(" "),n("p",[n("strong",[t._v("low memory:")]),t._v(" onPause()/onStop()->process is killed.")]),t._v(" "),n("p",[n("strong",[t._v("AActivity切换到BActivity:")])]),t._v(" "),n("p",[t._v("AActivity:onCreate()->onStart()->onResume()->onPause();")]),t._v(" "),n("p",[t._v("BActivity:onCreate()->onStart()->onResume();")]),t._v(" "),n("p",[t._v("AActivity:onStop();")]),t._v(" "),n("p",[t._v("返回AAcitvity：")]),t._v(" "),n("p",[t._v("BActivity:onPause();")]),t._v(" "),n("p",[t._v("AActivity:onRestart()->onStart()->onResume();")]),t._v(" "),n("p",[t._v("BActivity:onStop()->onDestory();")]),t._v(" "),n("p",[n("strong",[t._v("AActivity切换到BDialog:")])]),t._v(" "),n("p",[t._v("AActivity:onCreate()->onStart()->onResume()->onPause();")]),t._v(" "),n("p",[t._v("BDialog:onCreate()->onStart()->onResume();")])]),t._v(" "),n("li",[n("p",[t._v("onSaveinstanceState()/onRestoreInstanceState()")]),t._v(" "),n("p",[t._v("outState参数作用： 数据报保存，键值对形式保存在Bundel对象中。")]),t._v(" "),n("p",[n("strong",[t._v("onSaveInstanceState调用时机：")])]),t._v(" "),n("p",[t._v("(1)activity被系统销毁，也可能没有销毁就调用了；")]),t._v(" "),n("p",[t._v("(2)按下Home键或电源键，Acitvity进入后台；")]),t._v(" "),n("p",[t._v("(3)启动其他Activity，Activity被压入栈底；")]),t._v(" "),n("p",[t._v("注意：")]),t._v(" "),n("p",[t._v("(1)用户主动销毁不会调用，如单击回退键或调用finish();")]),t._v(" "),n("p",[t._v("(2)调用时间不固定，该方法一定在onStop之前调用，但不确定在onPause之前还是之后；")]),t._v(" "),n("p",[n("strong",[t._v("onRestoreInstanceState调用时机：")])]),t._v(" "),n("p",[t._v("(1)在Activity被系统销毁后，恢复时被调用； bundle对象也通过参数传递到onCreate()方法中。")])])]),t._v(" "),n("img",{staticStyle:{zoom:"80%"},attrs:{src:s(371)}}),t._v(" "),n("h5",{attrs:{id:"_2-service生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-service生命周期"}},[t._v("#")]),t._v(" 2. Service生命周期？")]),t._v(" "),n("blockquote",[n("p",[t._v("startService()->onCreate()->onStartCommand()->onDestory();")]),t._v(" "),n("p",[t._v("bindService()->onCreate()->onBind()->onUnbind()->onDestroy();")])]),t._v(" "),n("img",{staticStyle:{zoom:"80%"},attrs:{src:"images/fragment_lifecycle.png"}}),t._v(" "),n("p",[t._v("1）启动Service服务\n单次："),n("code",[t._v("startService() —> onCreate() —> onStartCommand()")]),t._v("\n多次："),n("code",[t._v("startService() —> onCreate() —> onStartCommand() —> onStartCommand()")]),t._v("\n2）停止Service服务\n"),n("code",[t._v("stopService() —> onDestroy()")]),t._v("\n3）绑定Service服务\n"),n("code",[t._v("bindService() —> onCreate() —> onBind()")]),t._v("\n4）解绑Service服务\n"),n("code",[t._v("unbindService() —> onUnbind() —> onDestroy()")]),t._v("\n5）启动绑定Service服务\n"),n("code",[t._v("startService() —> onCreate() —> onStartCommand() —> bindService() —> onBind()")]),t._v("\n6）解绑停止Service服务\n"),n("code",[t._v("unbindService() —> onUnbind() —> stopService() —> onDestroy()")]),t._v("\n7）解绑绑定Service服务\n"),n("code",[t._v("unbindService() —> onUnbind(ture) —> bindService() —> onRebind()")])]),t._v(" "),n("h5",{attrs:{id:"_3-onresume中可以直接调用getheight获取高度信息吗-ks"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-onresume中可以直接调用getheight获取高度信息吗-ks"}},[t._v("#")]),t._v(" 3.  onResume中可以直接调用getHeight获取高度信息吗(ks)？")]),t._v(" "),n("p",[t._v("​\t不可以。调用的时候还未开始测量UI。")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleResumeActivity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IBinder")]),t._v(" token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" clearHide"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" isForward"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" reallyResume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unscheduleGcIdler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        mSomeActivitiesChanged "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1. 调用performReusmeActivity，其中会调用activity.onResume()")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ActivityClientRecord")]),t._v(" r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("performResumeActivity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" clearHide"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Activity")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mFinished "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" willBeVisible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWindow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View")]),t._v(" decor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDecorView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                decor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setVisibility")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INVISIBLE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ViewManager")]),t._v(" wm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWindowManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WindowManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LayoutParams")]),t._v(" l "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAttributes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mDecor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" decor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WindowManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LayoutParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE_BASE_APPLICATION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("softInputMode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|=")]),t._v(" forwardBit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mVisibleFromClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mWindowAdded "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2. 将decorView添加到window中，这也是View绘制开始的起点")]),t._v("\n                    wm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("        \n")])])]),n("h5",{attrs:{id:"_3-java虚拟机和dalvik虚拟机和art区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-java虚拟机和dalvik虚拟机和art区别"}},[t._v("#")]),t._v(" 3. java虚拟机和Dalvik虚拟机和ART区别？")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/Android/07面试题/android/100qaAndroid基础.html"}},[t._v("查看")])],1),t._v(" "),n("h5",{attrs:{id:"_4-讲解一下context"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-讲解一下context"}},[t._v("#")]),t._v(" 4. 讲解一下Context？")]),t._v(" "),n("blockquote",[n("p",[t._v("Context是一个抽象基类，可以理解为上下文，或环境，是提供一些程序运行的基本信息。")])]),t._v(" "),n("p",[t._v("Context有两个子类，ContextWrapper(包装类)和ContextImpl(实现类)。")]),t._v(" "),n("p",[t._v("ContextWrapper有三个直接子类，ContextThemeWrapper(Activity继承)、Service、Application。")]),t._v(" "),n("p",[t._v("Context一共三种类型：Application、Service和Activity，绝大多数情况下是通用的。")]),t._v(" "),n("p",[t._v("Context数量=Activity数量+Service数量+1(Application)")]),t._v(" "),n("h5",{attrs:{id:"_5-四种launchmode及其使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-四种launchmode及其使用场景"}},[t._v("#")]),t._v(" 5. 四种LaunchMode及其使用场景？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("standard模式")]),t._v(" "),n("p",[t._v("默认模式，创建Activity并放入栈中。")])]),t._v(" "),n("li",[n("p",[t._v("singleTop模式")]),t._v(" "),n("p",[t._v("如果activity正好在栈顶，就会重用该实例(调用实例onNewIntent())。多次点击或新闻类app。")]),t._v(" "),n("p",[t._v("使用场景： 跳转按钮多次单击界面重复、")])]),t._v(" "),n("li",[n("p",[t._v("singleTask模式")]),t._v(" "),n("p",[t._v("如果存在，清空该实例上面的实例，并调用onNewIntent()方法。场景：主界面、浏览器。")])]),t._v(" "),n("li",[n("p",[t._v("singleInstance模式")]),t._v(" "),n("p",[t._v("在一个新栈中创建该Activity的实例，并让多个应用共享该栈中的该Activity实例(新栈中只有它一个实例)。")]),t._v(" "),n("p",[t._v("如呼叫来电、闹铃提醒。")])])]),t._v(" "),n("h5",{attrs:{id:"_6-android动画种类和实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-android动画种类和实现"}},[t._v("#")]),t._v(" 6. Android动画种类和实现？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("帧动画")]),t._v(" "),n("p",[t._v("专门用来一个一个的显示Drawable的resources，像放幻灯片一样。")])]),t._v(" "),n("li",[n("p",[t._v("补间动画")]),t._v(" "),n("p",[t._v("指通过指定View的初始状态、变化时间、方式，通过一系列算法进行图片变换。只要有Alpha、Scale、Translate、Rotate四种效果。")]),t._v(" "),n("p",[n("strong",[t._v("注意：只是在视图层实现了动画效果，并没有真正改变View的属性，比如滑动列表，改变标题栏的透明度。")])])]),t._v(" "),n("li",[n("p",[t._v("属性动画")])])]),t._v(" "),n("h5",{attrs:{id:"_7-asynctask实现原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-asynctask实现原理"}},[t._v("#")]),t._v(" 7. AsyncTask实现原理？")]),t._v(" "),n("blockquote",[n("p",[t._v("AsyncTask的实现原理 = 线程池 + Handler。")])]),t._v(" "),n("p",[t._v("由于线程池大小限制问题，适合http请求或耗时较短的任务，大规模的下载或数据库操作会导致线程池阻塞。")]),t._v(" "),n("p",[t._v("缺陷： AsyncTask第一次使用必须在主线程加载(4.1系统之前)；只能在UI线程使用；多次调用报错；代码太多，控制不灵活。")]),t._v(" "),n("h5",{attrs:{id:"_8-谈谈你对binder机制的理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-谈谈你对binder机制的理解"}},[t._v("#")]),t._v(" 8. 谈谈你对Binder机制的理解？")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/Android/07面试题/android/100qaAndroid基础.html"}},[t._v("参考Android基础")])],1),t._v(" "),n("p",[t._v("​\tLinux传统IPC主要有：管道、消息队列、共享内存和Socket等。消息队列和管道采用存储-转发方式，至少需要两次拷贝过程(用户空间-内核空间)。内存共享控制复杂，难以使用。socket作为一款通用接口，其传输效率低，开销大，主要用于跨网络的低速进程通信。从安全角度考虑，传统IPC无法获取对方进程可靠的UID/PID,且访问接入点是开放的，无法建立私用通道。")]),t._v(" "),n("p",[t._v("​\tBindler通信机制起源于一个简单的想法："),n("strong",[t._v("将申请服务的请求和对应的响应信息，写入一个所有进程都能访问的地址空间中。当进程使用这些数据时，只需要访问对应的内存地址，以减少内容复制引入的开销。为此，Bindler机制利用kernel空间作为共享区域，并用binder driver来建立每个进程的内存地址和kernel空间中存储地址的映射。从而使数据只copy一次就可以。同时为发送方添加UID/PID身份，既支持实名也支持匿名Bunder，提高安全性。")])]),t._v(" "),n("ul",[n("li",[t._v("bindler架构")])]),t._v(" "),n("ol",[n("li",[n("p",[t._v("四大组成部分")]),t._v(" "),n("p",[t._v("Client进程：使用服务的进程；")]),t._v(" "),n("p",[t._v("Server进程：提供服务的进程；")]),t._v(" "),n("p",[t._v("ServiceManager进程：SM的作用是将字符串形式的Binder名字转化成Client中对应Binder的引用，使得client能够通过binder名字获取对应server中binder实体的引用；")]),t._v(" "),n("p",[t._v("Binder驱动：驱动负责进程之间Binder通信的建立、数据的传递和交互等一系列底层支持。")])]),t._v(" "),n("li",[n("p",[t._v("使用步骤")]),t._v(" "),n("p",[t._v("**注册服务：**服务端通过SM注册服务，注册过程是向Binder驱动全局链表binder_procs中插入服务的信息。")]),t._v(" "),n("p",[t._v("**查询服务：**客户端向SM中发起获取服务的请求，SM从服务列表中查找Client需要的对应服务信息，将该服务的代理Binder(BinderProxy)返回给客户端。")]),t._v(" "),n("p",[n("strong",[t._v("使用服务：")])]),t._v(" "),n("p",[t._v("① Binder驱动为跨进程通信做准备：通过调用mmap()系统函数实现内存映射。在Binder驱动中创建一块接收缓存区。同时将内核缓存区地址和Server端中用户空间一块地址同时都映射到该接收缓存区中。这时候就创建了虚拟区间和映射的关系。")]),t._v(" "),n("p",[t._v("② Client进程将数据发送到Server进程。Client进程通过调用copy_from_user()发送数据拷贝到内核中（Binder驱动）的缓存区中，此时Client发起请求的线程会被挂起。由于在①中构建了映射关系，此时相当于也将数据发送到了Server端的用户空间中。之后Binder驱动通知Server端进程执行解包。")]),t._v(" "),n("p",[t._v("③ Server进程根据Client进程发送来的数据，调用目标方法。收到Binder驱动通知后，Server进程对数据进行解包，并调用相关方法处理。")]),t._v(" "),n("p",[t._v("④ Server进程将目标方法处理结果返回给Client进程。将处理结果放回自己的共享空间（即①中映射的Binder驱动缓存区中）。Binder驱动通知Client进程获取返回结果，此时②中被挂起的线程会被重新唤醒。Client进程通过系统调用copy_to_user(),从内核缓存区拷贝Server进程返回的结果。")]),t._v(" "),n("p",[t._v("从上面使用服务的过程可以看到，整个过程只拷贝了一次发送的数据和一次接收的数据。而正如开头所述，消息队列和管道这两种IPC拷贝次数为2次。")])])]),t._v(" "),n("h5",{attrs:{id:"_9-android中进程通讯方式有哪些"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-android中进程通讯方式有哪些"}},[t._v("#")]),t._v(" 9. Android中进程通讯方式有哪些？")]),t._v(" "),n("p",[t._v("Intent(Bundle)：四大组件通讯；")]),t._v(" "),n("p",[t._v("AIDL：一对多进程通讯；")]),t._v(" "),n("p",[t._v("Messenger： 基于AIDL，server只有一个线程；")]),t._v(" "),n("p",[t._v("ContentProvider：数据源的增删改查(例如通讯录)；")]),t._v(" "),n("p",[t._v("BroadcastReceiver:广播。")]),t._v(" "),n("h5",{attrs:{id:"_10-view的绘制流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-view的绘制流程"}},[t._v("#")]),t._v(" 10. View的绘制流程？")]),t._v(" "),n("p",[t._v("参考案例分析")]),t._v(" "),n("h5",{attrs:{id:"_11-事件传递流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-事件传递流程"}},[t._v("#")]),t._v(" 11. 事件传递流程？")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/Android/07面试题/android/100qaAndroid基础.html"}},[t._v("查看")])],1),t._v(" "),n("p",[t._v("1、Touch事件传递的相关API有dispatchTouchEvent、onTouchEvent、onInterceptTouchEvent；")]),t._v(" "),n("p",[t._v("2、Touch事件相关的类有View、ViewGroup、Activity；")]),t._v(" "),n("p",[t._v("3、Touch事件会被封装成MotionEvent对象，该对象封装了手势按下、移动、松开等动作；")]),t._v(" "),n("p",[t._v("4、Touch事件通常从Activity#dispatchTouchEvent发出，只要没有被消费，会一直往下传递，到最底层的View；")]),t._v(" "),n("p",[t._v("5、如果Touch事件传递到的每个View都不消费事件，那么Touch事件会反向向上传递,最终交由Activity#onTouchEvent处理；")]),t._v(" "),n("p",[t._v("6、onInterceptTouchEvent为ViewGroup特有，可以拦截事件；")]),t._v(" "),n("p",[t._v("7、Down事件到来时，如果一个View没有消费该事件，那么后续的MOVE/UP事件都不会再给它；")]),t._v(" "),n("p",[n("img",{attrs:{src:"images/androideventhandler.jpg",alt:"event_handler"}})]),t._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/hnlgzb/article/details/83653302",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),n("OutboundLink")],1)]),t._v(" "),n("h5",{attrs:{id:"_12-anr是什么-如何避免anr"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-anr是什么-如何避免anr"}},[t._v("#")]),t._v(" 12. ANR是什么？如何避免ANR?")]),t._v(" "),n("p",[t._v("ANR:Application Not Responding，即应用无响应")]),t._v(" "),n("p",[t._v("ANR一般有三种类型：")]),t._v(" "),n("p",[t._v("1：KeyDispatchTimeout(5 seconds) –主要类型")]),t._v(" "),n("p",[t._v("按键或触摸事件在特定时间内无响应")]),t._v(" "),n("p",[t._v("2：BroadcastTimeout(10 seconds)")]),t._v(" "),n("p",[t._v("BroadcastReceiver在特定时间内无法处理完成")]),t._v(" "),n("p",[t._v("3：ServiceTimeout(20 seconds) –小概率类型")]),t._v(" "),n("p",[t._v("​\tService在特定的时间内无法处理完成")]),t._v(" "),n("p",[t._v("超时的原因一般有两种：")]),t._v(" "),n("p",[t._v("(1)当前的事件没有机会得到处理（UI线程正在处理前一个事件没有及时完成或者looper被某种原因阻塞住）")]),t._v(" "),n("p",[t._v("(2)当前的事件正在处理，但没有及时完成")]),t._v(" "),n("p",[t._v("​\tUI线程尽量只做跟UI相关的工作，耗时的工作（数据库操作，I/O，连接网络或者其他可能阻碍UI线程的操作）放入单独的线程处理，尽量用Handler来处理UI thread和thread之间的交互。")]),t._v(" "),n("p",[t._v("UI线程主要包括如下：")]),t._v(" "),n("p",[t._v("Activity:onCreate(), onResume(), onDestroy(), onKeyDown(), onClick()")]),t._v(" "),n("p",[t._v("AsyncTask: onPreExecute(), onProgressUpdate(), onPostExecute(), onCancel()")]),t._v(" "),n("p",[t._v("Mainthread handler: handleMessage(), post(runnable r) other")]),t._v(" "),n("h5",{attrs:{id:"_13-内存泄漏及优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-内存泄漏及优化"}},[t._v("#")]),t._v(" 13. 内存泄漏及优化？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("内存泄漏和内存溢出区别？")]),t._v(" "),n("p",[t._v("内存溢出OOM:当程序申请内存时，没有足够内存供其使用。比如integer类型中放long，就会内存溢出。")]),t._v(" "),n("p",[t._v("内存泄漏：对象无法被回收。检查工具：leakCanary。")])]),t._v(" "),n("li",[n("p",[t._v("内存泄漏原因：")]),t._v(" "),n("p",[t._v("(1)Handler引起的内存泄漏(解决：静态内部类+弱引用)；")]),t._v(" "),n("p",[t._v("(2)单例模式引起的内存泄漏(解决：用全局ApplicationContext代替ActivityContext)；")]),t._v(" "),n("p",[t._v("(3)非静态内部类或匿名类引起的内存泄漏(解决：修改为静态内部类)；")]),t._v(" "),n("p",[t._v("(4)注册/反注册未成对使用；(广播，eventbus等)；")]),t._v(" "),n("p",[t._v("(5)资源对象没有关闭(close(),recycler())；")]),t._v(" "),n("p",[t._v("(6)集合对象没有及时清理。")])])]),t._v(" "),n("h5",{attrs:{id:"_14-webview和js交互的三种调用方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-webview和js交互的三种调用方式"}},[t._v("#")]),t._v(" 14. webview和js交互的三种调用方式？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("1 Android原生交互方式")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1. JS调用native方法(4.2之后使用，不然存在安全漏洞)")]),t._v("\nmWebView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addJavascriptInterface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsInterface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "android"是js那边调用Java方法时的一个“句柄”或者引用，跟h5约定好，可以写成别的。android.openUrlByBrowser()')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsInterface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JavascriptInterface")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("backpage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("　　"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无返回值，无参")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("finish")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JavascriptInterface")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("openUrlByBrowser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("　　"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无返回值，有参")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("openBrowser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@JavascriptInterface")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("haszhifubao")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("　　"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 有返回值")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppPackageChecked")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isExist")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebShowActivity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.eg.android.AlipayGphone"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2. native调用js方法")]),t._v("\nmWebView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadUrl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"javascript:pauseVideo()"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("　　"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pauseVideo()是H5那边定义好的")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// android 4.4以上 才能使用")]),t._v("\nbuttonLeft"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setOnClickListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OnClickListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onClick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View")]),t._v(" view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                webView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        webView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("evaluateJavascript")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"javascript:callJS()"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ValueCallback")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                            "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReceiveValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将button显示的文字改成JS返回的字符串")]),t._v("\n                                buttonLeft"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("2 拦截URL跳转方式方式")]),t._v(" "),n("p",[t._v("通过 WebViewClient 的shouldOverrideUrlLoading ()方法回调拦截 url 。")])]),t._v(" "),n("li",[n("p",[t._v("3 拦截Prompt提示框方法")]),t._v(" "),n("p",[t._v("通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）方法回调拦截JS对话框alert()、confirm()、prompt（） 消息。")])])]),t._v(" "),n("h5",{attrs:{id:"_15-launcher原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_15-launcher原理"}},[t._v("#")]),t._v(" 15. Launcher原理？")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/Android/07面试题/android/100qaAndroid基础.html"}},[t._v("查看")])],1),t._v(" "),n("p",[t._v("Launcher进程、system_server进程、Zygote进程、App进程。")]),t._v(" "),n("h5",{attrs:{id:"_16-window、activity、decorview、viewroot区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_16-window、activity、decorview、viewroot区别"}},[t._v("#")]),t._v(" 16. Window、Activity、DecorView、ViewRoot区别？")]),t._v(" "),n("p",[t._v("...案例分析")]),t._v(" "),n("p",[t._v("Activity(attach)->PhoneWindow(包含)->DecorView对象->addView。")]),t._v(" "),n("h5",{attrs:{id:"_17-performtraversals-执行至少2次问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_17-performtraversals-执行至少2次问题"}},[t._v("#")]),t._v(" 17. performTraversals 执行至少2次问题？")]),t._v(" "),n("p",[t._v("造成这个现象的根本原因是performTranversal函数在View的测量流程中会执行2次(与Surface是否存在有关)。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("视图容器的ViewGroup宽高不是match_parent或具体数值时，都会对子view进行两次measure，layout.")]),t._v(" "),n("p",[t._v("大家应该都知道，有些"),n("code",[t._v("ViewGroup")]),t._v("可能会让自己的子视图测量两次。比如说，父视图先让每个子视图自己测量，使用"),n("code",[t._v("View.MeasureSpec.UNSPECIFIED")]),t._v("，然后在根据每个子视图希望得到的大小不超过父视图的一些限制，就让子视图得到自己希望的大小，否则就用其他尺寸来重新测量子视图。这一类的视图有"),n("code",[t._v("FrameLayout")]),t._v(","),n("code",[t._v("RelativeLayout")]),t._v("等。")])]),t._v(" "),n("li",[n("p",[t._v("View初始化时的三次measure,两次layout却只一次draw吗？")]),t._v(" "),n("p",[t._v("两次measure效率太低，android底层做了优化。")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("measure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" widthMeasureSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" heightMeasureSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当FLAG_FORCE_LAYOUT位为１时，就是当前视图请求一次布局操作")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或者当前当前widthSpec和heightSpec不等于上次调用时传入的参数的时候")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//才进行从新绘制。")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("forceLayout "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("matchingSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("widthMeasureSpec "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" mOldWidthMeasureSpec "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n                    heightMeasureSpec "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" mOldHeightMeasureSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onMeasure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("widthMeasureSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" heightMeasureSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_18-listview-recycleview-区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_18-listview-recycleview-区别"}},[t._v("#")]),t._v(" 18. Listview recycleView 区别？")]),t._v(" "),n("ul",[n("li",[t._v("封装了对viewholder的回收复用；")]),t._v(" "),n("li",[t._v("可以同时实现线性布局、网格布局、瀑布流布局，完美替代Listview+GirdeView，更容易组合设计出自己的滑动布局；")]),t._v(" "),n("li",[t._v("自带了itemAnimation，可以设置加载和移除时的动画。")])]),t._v(" "),n("h5",{attrs:{id:"_19-relativelayout、linearlayout性能区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_19-relativelayout、linearlayout性能区别"}},[t._v("#")]),t._v(" 19. RelativeLayout、LinearLayout性能区别？")]),t._v(" "),n("blockquote",[n("p",[t._v("影响布局性能有两个因素，1. 层级深度 2. 选择RL或LL。")]),t._v(" "),n("p",[t._v("重要性： 1 > 2。")])]),t._v(" "),n("p",[t._v("相同的层级深度下，两个布局的性能差别在measure，RL>LL。")]),t._v(" "),n("p",[t._v("**原因：**RL内的子View会进行两次onMeasure，分别是横向和纵向的； LL分两种情况，如果没有weight，就只关心orientation，子view测量一次，如果有weight，子view测量两次；分别是先orientation，再是weight。")]),t._v(" "),n("p",[t._v("**例子：**相同的布局，一个RelativeLayout可以完成，但是要使用多个LinearLayout，肯定使用Relativelayout的，尽管会子view会测量两次，但是也比使用多个LinearLayout性能好多了。")]),t._v(" "),n("h5",{attrs:{id:"_20-convertview和viewholder的理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_20-convertview和viewholder的理解"}},[t._v("#")]),t._v(" 20. convertView和ViewHolder的理解？")]),t._v(" "),n("p",[t._v("RecycleBin机制。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("convertView 是作为缓存的view，通过使用这个缓存减少inflater加载组件这一步；")])]),t._v(" "),n("li",[n("p",[t._v("viewHolder中持有的组件和convertView中的组件指向同一对象，所有这里使用viewholder就是替换掉findViewById,防止多次调用。")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("finalint position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View")]),t._v(" convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ViewGroup")]),t._v(" parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ViewHolder")]),t._v(" holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//观察convertView随ListView滚动情况             ")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("v")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MyListViewBase"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"getView "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" position "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('" "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("convertView "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    convertView "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mInflater"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inflate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    holder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ViewHolder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**得到各个控件的对象*/")]),t._v("                     \n    holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findViewById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ItemTitle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findViewById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ItemText"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bt "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Button")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findViewById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ItemButton"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//绑定ViewHolder对象                    ")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    holder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ViewHolder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//取出ViewHolder对象                   ")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**设置TextView显示的内容，即我们存放在动态数组中的数据*/")]),t._v("             \n  holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ItemTitle"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ItemText"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" convertView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),n("h5",{attrs:{id:"_21-硬件加速原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_21-硬件加速原理"}},[t._v("#")]),t._v(" 21. 硬件加速原理？")]),t._v(" "),n("p",[t._v("对于App开发者，简单了解硬件加速原理及上层API实现，开发时就可以充分利用硬件加速提高页面的性能。以Android举例，实现一个圆角矩形按钮通常有两种方案：使用PNG图片；使用代码（XML/Java）实现。简单对比两种方案如下。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方案")]),t._v(" "),n("th",[t._v("原理")]),t._v(" "),n("th",[t._v("特点")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("使用PNG图片")]),t._v(" "),n("td",[t._v("解码png生成bitmap，传递到底层，由GPU渲染")]),t._v(" "),n("td",[t._v("图片解码消耗CPU运算资源，Bitmap占用内存大，绘制慢")])]),t._v(" "),n("tr",[n("td",[t._v("使用xml或java")]),t._v(" "),n("td",[t._v("直接将Shape信息传递到底层，有GPU渲染")]),t._v(" "),n("td",[t._v("消耗cpu资源少，占用内存小，绘制块")])])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("CPU更擅长复杂逻辑控制，而GPU得益于大量ALU和并行结构设计，更擅长数学运算。")])]),t._v(" "),n("li",[n("p",[t._v("页面由各种基础元素（DisplayList）构成，渲染时需要进行大量浮点运算。")])]),t._v(" "),n("li",[n("p",[t._v("硬件加速条件下，CPU用于控制复杂绘制逻辑、构建或更新DisplayList；GPU用于完成图形计算、渲染DisplayList。")])]),t._v(" "),n("li",[n("p",[t._v("硬件加速条件下，刷新界面尤其是播放动画时，CPU只重建或更新必要的DisplayList，进一步提高渲染效率。")])])]),t._v(" "),n("p",[t._v("实现同样效果，应尽量使用更简单的DisplayList，从而达到更好的性能（Shape代替Bitmap等）。")]),t._v(" "),n("h5",{attrs:{id:"_22-andorid-6-7-8-9-10-系统新特性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_22-andorid-6-7-8-9-10-系统新特性"}},[t._v("#")]),t._v(" 22. Andorid 6 7 8 9 10 系统新特性？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("10.0系统")]),t._v(" "),n("ol",[n("li",[t._v("新增了运动健康计步权限，否则无法使用内置计步器计步；")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Android10")]),t._v("之后，计步器需要健身运动权限 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uses")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("permission android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android.permission.ACTIVITY_RECOGNITION"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 动态申请权限")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestStepPermission")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//动态申请健康运动权限")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" permissions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Manifest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTIVITY_RECOGNITION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VERSION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SDK_INT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VERSION_CODES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Q")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" get "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextCompat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkSelfPermission")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" permissions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 权限是否已经 授权 GRANTED---授权  DINIED---拒绝")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("get "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PackageManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PERMISSION_GRANTED"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果没有授予该权限，就去提示用户请求自动开启权限")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ActivityCompat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestPermissions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" permissions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("321")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("默认开启沙箱模式，即使动态申请了存储卡读写权限，在外部存储上读写文件依然失败。")]),t._v(" "),n("p",[n("code",[t._v('android:requestLegacyExternalStorage="true"')])])]),t._v(" "),n("li",[n("p",[t._v("支持屏幕折叠和5G;")])])])]),t._v(" "),n("li",[n("p",[t._v("9.0系统")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("默认禁止访问http地址，只允许访问https地址。如果仍要访问http地址，需要修改配置")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("xml version"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),t._v(" encoding"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("network"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("security"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("base"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config cleartextTrafficPermitted"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("network"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("security"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("application\n        android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("icon"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@mipmap/ic_launcher"')]),t._v("\n        android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("label"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@string/app_name"')]),t._v("\n        android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("theme"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@style/AppTheme"')]),t._v("\n        android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("networkSecurityConfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@xml/network_security_config"')]),t._v("\n        android"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('".MainApplication"')]),t._v("\n")])])])])])]),t._v(" "),n("li",[n("p",[t._v("8.0系统")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("消息通知需要指定渠道编号才能推送；")])]),t._v(" "),n("li",[n("p",[t._v("属性动画组合AnimatorSet增加了setCurrentPlayTime和reverse方法，从而允许倒过来播放属性动画组合。")])]),t._v(" "),n("li",[n("p",[t._v("悬浮窗要使用类型TYPE_APPLICATION_OVERLAY，原来的类型TYPE_SYSTEM_ALERT从Android8.0开始被舍弃了。")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WindowManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LayoutParams")]),t._v(" wmParams "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WindowManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LayoutParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置为TYPE_SYSTEM_ALERT类型，才能悬浮在其它页面之上")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VERSION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SDK_INT "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VERSION_CODES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("O")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意TYPE_SYSTEM_ALERT从Android8.0开始被舍弃了")]),t._v("\n        wmParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WindowManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LayoutParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE_SYSTEM_ALERT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从Android8.0开始悬浮窗要使用TYPE_APPLICATION_OVERLAY")]),t._v("\n        wmParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WindowManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LayoutParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE_APPLICATION_OVERLAY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])]),t._v(" "),n("li",[n("p",[t._v("7.0")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("APK signature scheme v2(引入V2签名方案)。")]),t._v(" "),n("p",[t._v("Android 应用的签名工具有两种：jarsigner 和 signAPK。它们的签名算法没什么区别，主要是签名使用的文件不同。")]),t._v(" "),n("p",[t._v("jarsigner：jdk 自带的签名工具，可以对 jar 进行签名。使用 keystore 文件进行签名。生成的签名文件默认使用 keystore 的别名命名。\nsignAPK：Android sdk 提供的专门用于 Android 应用的签名工具。使用 pk8、x509.pem 文件进行签名。其中 pk8 是私钥文件，x509.pem 是含有公钥的文件。生成的签名文件统一使用“CERT”命名。")]),t._v(" "),n("p",[n("strong",[t._v("区别：")])]),t._v(" "),n("p",[t._v("V2对整个APK进行签名，V1对jar进行签名；")]),t._v(" "),n("p",[t._v("V2签名校验速度会更快；")]),t._v(" "),n("p",[t._v("V2不允许通过修改META-INF文件进行多渠道打包。")])])])]),t._v(" "),n("li",[n("p",[t._v("6.0")]),t._v(" "),n("ol",[n("li",[t._v("动态权限管理。")])])])]),t._v(" "),n("h3",{attrs:{id:"_1-基础机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础机制"}},[t._v("#")]),t._v(" 1. 基础机制")]),t._v(" "),n("h4",{attrs:{id:"_1-binder机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-binder机制"}},[t._v("#")]),t._v(" 1. Binder机制")]),t._v(" "),n("p",[t._v("​\tbinder是什么？来自哪里？")]),t._v(" "),n("p",[t._v("​\t传统IPC机制方式和缺点？binder原理和优势？")]),t._v(" "),n("h4",{attrs:{id:"_2-launcher启动过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-launcher启动过程"}},[t._v("#")]),t._v(" 2. Launcher启动过程")]),t._v(" "),n("p",[t._v("​\t什么是Launcher？启动过程？")]),t._v(" "),n("p",[t._v("​\t包含：linux三大进程；AMS、PMS；"),n("code",[t._v('<category android:name="android.intent.category.Home">')]),t._v("属性。")]),t._v(" "),n("h3",{attrs:{id:"_2-线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-线程"}},[t._v("#")]),t._v(" 2. 线程")]),t._v(" "),n("h4",{attrs:{id:"_1-为什么android中要设计成只能在ui线程更新ui呢"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么android中要设计成只能在ui线程更新ui呢"}},[t._v("#")]),t._v(" 1.  为什么Android中要设计成只能在UI线程更新UI呢？")]),t._v(" "),n("p",[t._v("​\t根本原因：为了达到流畅的用户体验，在16ms内完成一帧的绘制(刷新频率60HZ)。")]),t._v(" "),n("p",[t._v("​\t单线程访问好处：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[t._v("1. 多线程设计复杂，并发问题难处理(加锁和同时更新UI不可控)，更新性能很难达到；\n\n2. 单线程架构设计简单，提高界面更新性能问题；\n3. Android的UI控件不是**线程安全**的，如果在多线程中并发访问可能会导致UI控件处于不可预期的状态。\n")])])]),n("h4",{attrs:{id:"_2-主线程和ui线程区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-主线程和ui线程区别"}},[t._v("#")]),t._v(" 2. 主线程和UI线程区别？")]),t._v(" "),n("p",[t._v("​\tActivityThread的main函数是app的入口方法，也叫主线程；")]),t._v(" "),n("p",[t._v("​\tUI线程是View绘制和刷新所在的线程，即ViewRootImpl创建算在的线程。")]),t._v(" "),n("p",[t._v("​\t通常情况下，我们一般认为Main Thread就是UIThread。更确切的说，UIThread是"),n("strong",[t._v("创建View所在的线程")]),t._v("，否则会报错"),n("code",[t._v("Only the original thread that created a view hierarchy can touch its views.")])]),t._v(" "),n("h4",{attrs:{id:"_3-非ui线程真的不能刷新ui吗"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-非ui线程真的不能刷新ui吗"}},[t._v("#")]),t._v(" 3. 非UI线程真的不能刷新UI吗？")]),t._v(" "),n("p",[t._v("​\t答：不一定，之所以子线程不能更新界面，是因为Android在线程的方法里面采用checkThread进行判断是否是主线程，而这个方法是在ViewRootImpl中的，这个类是在onResume里面才生成的，因此，如果这个时候子线程在onCreate方法里面生成更新UI，而且没有做阻塞，就是耗时多的操作，还是可以更新UI的。")]),t._v(" "),n("h4",{attrs:{id:"_4-surfaceview为什么可以在子线程绘制呢"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-surfaceview为什么可以在子线程绘制呢"}},[t._v("#")]),t._v(" 4. SurfaceView为什么可以在子线程绘制呢？")]),t._v(" "),n("p",[t._v("​\t窗口中的view共享一个window，window又对应一个Surface，所以窗口中的view共享一个Surface。他的绘制操作，最终都会调用到ViewRootImpl，那么这个就会被检查是否主线程了，所以只要在ViewRootImpl启动后，访问UI的所有操作都不可以在子线程中进行。")]),t._v(" "),n("p",[t._v("​\t而SurfaceView本身就自带一个Surface，使用双缓存机制，与主线程和Window窗口是分离的，容易实现子线程访问(一般出现在游戏或被动更新功能中)。")]),t._v(" "),n("h3",{attrs:{id:"_3-handler"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-handler"}},[t._v("#")]),t._v(" 3. Handler")]),t._v(" "),n("h4",{attrs:{id:"_1-谈谈handler机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-谈谈handler机制"}},[t._v("#")]),t._v(" 1. 谈谈Handler机制？")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("作用")]),t._v(" "),n("p",[t._v("跨线程通信，因为子线程不能操作UI。")])]),t._v(" "),n("li",[n("p",[t._v("组成")]),t._v(" "),n("p",[t._v("Message(消息)、MessageQueue(消息队列)、Handler(消息处理器)、Looper(消息池)。")]),t._v(" "),n("p",[t._v("组成比例(1个线程)：Thread(1):Looper(1):MessageQueue(1):Handler(N)。")])]),t._v(" "),n("li",[n("p",[t._v("流程")]),t._v(" "),n("p",[t._v("​\t主线程创建的时候会创建一个Looper，同时在Looper内部创建一个消息队列。而创建Handler的时候会取出当前线程的Looper和消息队列，然后Handler在子线程通过"),n("strong",[t._v("MessageQueue.equeueMessage")]),t._v("在消息队列中添加一条Message；")]),t._v(" "),n("p",[t._v("​\t通过"),n("strong",[t._v("Looper.looper()"),n("strong",[t._v("开启的消息循环会不断调用")]),t._v("MessageQueue.next()")]),t._v("，无消息时会阻塞。取得对应的Message并且通过"),n("strong",[t._v("Handler.dispatchMessage")]),t._v("传递给Handler，最终调用Handler.handlerMessage处理消息。")])])]),t._v(" "),n("h4",{attrs:{id:"_2-hander引起的内存泄漏如何处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-hander引起的内存泄漏如何处理"}},[t._v("#")]),t._v(" 2. Hander引起的内存泄漏如何处理？")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("泄漏原因")]),t._v(" "),n("p",[n("strong",[t._v("非静态内部类默认持有外部类的引用。")])]),t._v(" "),n("p",[t._v("当用户关闭activity时，Hander持有activity的引用，导致activity泄漏。")])]),t._v(" "),n("li",[n("p",[t._v("解决方法")]),t._v(" "),n("p",[t._v("将Handler定义为静态内部类，在内部类持有Activity的弱引用，并在onDestory中调用"),n("strong",[t._v("handler.removeMessages")]),t._v("。")])])]),t._v(" "),n("h4",{attrs:{id:"_3-looper死循环为什么不会导致anr"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-looper死循环为什么不会导致anr"}},[t._v("#")]),t._v(" 3. Looper死循环为什么不会导致ANR?")]),t._v(" "),n("p",[t._v("​\tANR发生条件：消息没有及时处理、消息处理事件过长。")]),t._v(" "),n("p",[t._v("​\t而阻塞是没有消息时发生的，不符合ANR条件。"),n("strong",[t._v("主线程就任务就是处理各种消息，没有消息就会阻塞等待。")])]),t._v(" "),n("ul",[n("li",[t._v("简单的来说：ActivityThread的main方法主要就是做消息循环，一旦退出消息循环，那么你的程序也就可以退出了。")]),t._v(" "),n("li",[t._v("因为Android 的是由事件驱动的，looper.loop() 不断地接收事件、处理事件，每一个点击触摸或者说Activity的生命周期都是运行在 Looper.loop() 的控制之下，如果它停止了，应用也就停止了。只能是某一个消息或者说对消息的处理阻塞了 Looper.loop()，而不是 Looper.loop() 阻塞它。")])]),t._v(" "),n("p",[n("a",{attrs:{href:"http://blog.itpub.net/69989885/viewspace-2761246/",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),n("OutboundLink")],1)]),t._v(" "),n("h4",{attrs:{id:"_4-message如何存储"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-message如何存储"}},[t._v("#")]),t._v(" 4. Message如何存储？")]),t._v(" "),n("p",[t._v("​\t按时间顺序的单链表结构存储，最近时间在链表头。其他时间Message会遍历插入链表对应位置。")]),t._v(" "),n("h4",{attrs:{id:"_5-子线程如何使用hander"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-子线程如何使用hander"}},[t._v("#")]),t._v(" 5. 子线程如何使用Hander?")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepare")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 创建looper和消息队里(绑定当前线程)")]),t._v("\n            val handler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" object "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2. handler")]),t._v("\n                override fun "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("loop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. 循环处理消息")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//4. 上面阻塞了，永远不会执行到这里。  ")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h4",{attrs:{id:"_6-message如何创建效果好"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-message如何创建效果好"}},[t._v("#")]),t._v(" 6. Message如何创建效果好？")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("直接生成 "),n("code",[t._v("Message m = new Message()")]),t._v(";")])]),t._v(" "),n("li",[n("p",[t._v("通过"),n("code",[t._v("Message m = Message.obtain()")]),t._v(";")])]),t._v(" "),n("li",[n("p",[t._v("通过"),n("code",[t._v("Message m = mHander.obtainMessage()")]),t._v("，内部调用2方法;")]),t._v(" "),n("p",[t._v("后两者效果更好，因为Android默认的消息池中消息数量是50(对象池，链表实现)，而后两者是直接在消息池中取出一个Message实例，这样做就可以避免多生成Message实例。")])])]),t._v(" "),n("h4",{attrs:{id:"_7-handlerthread干嘛用的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-handlerthread干嘛用的"}},[t._v("#")]),t._v(" 7. HandlerThread干嘛用的？")]),t._v(" "),n("p",[t._v("​\t是google提供的一个带looper的线程，方便与线程通信(UI消息的简单实现)。")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HandlerThread")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mTid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("myTid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepare")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            mLooper "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("myLooper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("notifyAll")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setThreadPriority")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mPriority"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onLooperPrepared")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("loop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        mTid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外界调用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),t._v(" mThreadHandler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handlerThread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传入loop")]),t._v("\n")])])]),n("h4",{attrs:{id:"_8-handler-postdealy-实现和消息阻塞的深层机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-handler-postdealy-实现和消息阻塞的深层机制"}},[t._v("#")]),t._v(" 8. Handler.postDealy()实现和消息阻塞的深层机制？")]),t._v(" "),n("blockquote",[n("p",[t._v("IO事件：输入输出(input/output)的对象可以是文件(file)， 网络(socket)，进程之间的管道(pipe)。在linux系统中，都用文件描述符(fd)来表示。")])]),t._v(" "),n("ol",[n("li",[t._v("根据Message时间先后将消息插入Message链表；")]),t._v(" "),n("li",[t._v("无限循环计算当前Message是否立即执行(when)，如果没到执行时间，调用"),n("code",[t._v("nativePollOnce(ptr, nextPollTimeoutMillis);")]),t._v("阻塞消息队列，等待系统到时间自动唤醒执行；")]),t._v(" "),n("li",[t._v("如果阻塞期间有新消息过来，如果需要立即执行，就立即执行；如果没到时间，插入到前面，然后重新计算阻塞队列唤醒时间；")]),t._v(" "),n("li",[t._v("一个消息执行完毕，自动再进行下一次唤醒时间计算，然后阻塞。")])]),t._v(" "),n("p",[t._v("epoll机制：epoll是Linux内核为处理大批量"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6/9809582",target:"_blank",rel:"noopener noreferrer"}},[t._v("文件描述符"),n("OutboundLink")],1),t._v("而作了改进的poll，是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量"),n("a",{attrs:{href:"https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91%E8%BF%9E%E6%8E%A5/3763280",target:"_blank",rel:"noopener noreferrer"}},[t._v("并发连接"),n("OutboundLink")],1),t._v("中只有少量活跃的情况下的系统CPU利用率。")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("select")]),t._v(" 和 "),n("code",[t._v("poll")]),t._v(" 监听文件描述符list，进行一个线性的查找 O(n)")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("epoll")]),t._v(": 使用了内核文件级别的回调机制O(1)")]),t._v(" "),n("p",[t._v("epoll高效的本质在于：")]),t._v(" "),n("p",[t._v("减少了用户态和内核态的文件句柄拷贝")]),t._v(" "),n("p",[t._v("减少了对可读可写文件句柄的遍历")]),t._v(" "),n("p",[t._v("mmap 加速了内核与用户空间的信息传递，epoll是通过内核与用户mmap同一块内存，避免了无谓的内存拷贝")]),t._v(" "),n("p",[t._v("IO性能不会随着监听的文件描述的数量增长而下降")]),t._v(" "),n("p",[t._v("使用红黑树存储fd，以及对应的回调函数，其插入，查找，删除的性能不错，相比于hash，不必预先分配很多的空间")]),t._v(" "),n("h4",{attrs:{id:"_9-native-looper"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-native-looper"}},[t._v("#")]),t._v(" 9. Native Looper?")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("目的")]),t._v(" "),n("p",[t._v("Native Loope主要配合Java looper 实现线程通信机制。")])]),t._v(" "),n("li",[n("p",[t._v("实现")]),t._v(" "),n("p",[t._v("​\t整个的结构很简单，JAVA Looper包含一个MessageQueue，MessageQueue对应的Native 实例是一个NativeMessageQueue实例，NativeMessageQueue在创建的时候生成一个Native Looper。  "),n("strong",[t._v("其实Native Looper存在的意义就是作为JAVA Looper机制的开关器。")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageQueue")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" mPtr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 本地消息队列指针")]),t._v("\n\t "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("native")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativeInit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("native")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativeDestroy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" ptr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("native")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativePollOnce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" ptr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" timeoutMillis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否block ")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("native")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativeWake")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" ptr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 唤醒本地线程")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("native")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativeIsPolling")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" ptr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("native")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativeSetFileDescriptorEvents")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" ptr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" fd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// C++")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NativeMessageQueue")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NativeMessageQueue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    mLooper "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getForThread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mLooper "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" NULL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n        mLooper "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setForThread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mLooper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])]),n("p",[t._v("两种情况：")]),t._v(" "),n("p",[t._v("​\t当添加Message时，会唤醒本地线程，调用nativewake函数；")]),t._v(" "),n("p",[t._v("​\t当消息队列为空时，调用nativePollOnce阻塞本地线程。")])]),t._v(" "),n("li",[n("p",[t._v("。。")])])])])]),t._v(" "),n("h3",{attrs:{id:"_4-view"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-view"}},[t._v("#")]),t._v(" 4. View")]),t._v(" "),n("h4",{attrs:{id:"_1-activity、window、view关系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-activity、window、view关系"}},[t._v("#")]),t._v(" 1. Activity、Window、View关系？")]),t._v(" "),n("h3",{attrs:{id:"_5-性能优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-性能优化"}},[t._v("#")]),t._v(" 5. 性能优化")]),t._v(" "),n("h3",{attrs:{id:"_6-架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-架构"}},[t._v("#")]),t._v(" 6. 架构")]),t._v(" "),n("h4",{attrs:{id:"_1-说说你对软件架构的理解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-说说你对软件架构的理解"}},[t._v("#")]),t._v(" 1. 说说你对软件架构的理解？")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("软件架构的本质、设计三原则；")])]),t._v(" "),n("li",[n("p",[t._v("架构设计思想和方法(solid/分离关注点/依赖注入/面向切面)；")])]),t._v(" "),n("li",[n("p",[t._v("android架构的发展。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/66535377",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),n("OutboundLink")],1)])])]),t._v(" "),n("h3",{attrs:{id:"_7-开源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-开源"}},[t._v("#")]),t._v(" 7. 开源")]),t._v(" "),n("h4",{attrs:{id:"_1-glide"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-glide"}},[t._v("#")]),t._v(" 1. Glide")]),t._v(" "),n("h4",{attrs:{id:"_2-retrofit"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-retrofit"}},[t._v("#")]),t._v(" 2. Retrofit")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("如何与UI线程通信的？")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Android")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Platform")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultCallbackExecutor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MainThreadExecutor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CallAdapter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Factory")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultCallAdapterFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" callbackExecutor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorCallAdapterFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callbackExecutor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MainThreadExecutor")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//!!! 通过建立绑定UI线程Looper的Hander实现。")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),t._v(" handler "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Looper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMainLooper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),t._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("...")])])]),t._v(" "),n("h3",{attrs:{id:"_8-加载图片问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-加载图片问题"}},[t._v("#")]),t._v(" 8. 加载图片问题")]),t._v(" "),n("h4",{attrs:{id:"_1-基础知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础知识"}},[t._v("#")]),t._v(" 1. 基础知识")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("一张图片加载到内存大小")]),t._v(" "),n("p",[t._v("图片内存大小 = 图片宽度 * 图片高度 * 一个像素字节数(4)")]),t._v(" "),n("p",[t._v("利用一个1000*1000像素的图片，默认加载后大小为4M。")])]),t._v(" "),n("li",[n("p",[t._v("一个像素所占字节数")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RGB_565"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Glide用2字节")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RGB_888"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认4字节")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("图片压缩方法")]),t._v(" "),n("p",[t._v("质量压缩、采样率压缩。")])])]),t._v(" "),n("h4",{attrs:{id:"_2-加载大图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-加载大图"}},[t._v("#")]),t._v(" 2. 加载大图")]),t._v(" "),n("p",[t._v("缩放大图宽高")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1. 仅仅获取图片宽高")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BitmapFactory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Options")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Options")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\noptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inJustDecodeBounds "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BitmapFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeResource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drawable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bigpicture"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" outHeight "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("outHeight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" outWidth "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("outWidth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2. 计算缩放参数")]),t._v("\noptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inSampleSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缩小一倍")]),t._v("\n")])])]),n("h4",{attrs:{id:"_3-展示巨图局部"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-展示巨图局部"}},[t._v("#")]),t._v(" 3. 展示巨图局部")]),t._v(" "),n("p",[t._v("通过"),n("code",[t._v("BitmapRegionDecoder")]),t._v("只读取对应显示矩形框图大小。")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InputStream")]),t._v(" inputStream "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAssets")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bigpicture.jpg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BitmapRegionDecoder")]),t._v(" regionDecoder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BitmapRegionDecoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newInstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("inputStream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" measuredHeight "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMeasuredHeight")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" measuredWidth "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMeasuredWidth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Rect")]),t._v(" rect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Rect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" measuredWidth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" measuredHeight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmap")]),t._v(" bitmap "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" regionDecoder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeRegion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Options")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImageBitmap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bitmap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),n("h4",{attrs:{id:"_4-滑动显示巨图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-滑动显示巨图"}},[t._v("#")]),t._v(" 4. 滑动显示巨图")]),t._v(" "),n("p",[t._v("同上，通过移动距离 动态调整矩形框大小。")]),t._v(" "),n("ol",[n("li",[t._v("在 onMeasure 中拿到测量后的大小，设置给 Rect")]),t._v(" "),n("li",[t._v("在 onTouchEvent() 方法中，计算滑动的距离，然后设置给 Rect")]),t._v(" "),n("li",[t._v("设置了新的显示区域以后，调用 invalidate() 方法， 请求绘制，这时候会调用 onDraw() 方法")]),t._v(" "),n("li",[t._v("在 onDraw() 方法中根据 Rect 拿到需要显示的局部 Bitmap， 通过 Canvas 绘制回来。")])]),t._v(" "),n("h4",{attrs:{id:"_5-缩放移动地图-zoom-pan"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-缩放移动地图-zoom-pan"}},[t._v("#")]),t._v(" 5. 缩放移动地图(zoom pan)")]),t._v(" "),n("p",[n("strong",[t._v("要点：")])]),t._v(" "),n("ul",[n("li",[t._v("实现View，重写measure，layout，draw过程")]),t._v(" "),n("li",[t._v("将整个Bitmap分割成很多方块")]),t._v(" "),n("li",[t._v("使用BitmapRegionDecoder来区间加载这些小的Bitmap，铺满整个屏幕")]),t._v(" "),n("li",[t._v("以屏幕的左上角为原点，用户移动的时候，控制图片的Translate,映射Bitmap内容到屏幕上去")])]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/davemorrissey/subsampling-scale-image-view",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考 subsampling-scale-image-view"),n("OutboundLink")],1)]),t._v(" "),n("ul",[n("li",[t._v("引用")])]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/yangchong211/YCBlogs",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考1"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.im/post/5c81db916fb9a049d37fe6a1",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考2"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/gatieme/CodingInterviews",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考3"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);