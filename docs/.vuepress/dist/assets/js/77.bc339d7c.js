(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{445:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"插件化理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件化理解"}},[t._v("#")]),t._v(" 插件化理解")]),t._v(" "),s("p",[t._v("[TOC]")]),t._v(" "),s("h2",{attrs:{id:"一、介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、介绍"}},[t._v("#")]),t._v(" 一、介绍")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("what")]),t._v(" "),s("p",[t._v("组件化实现了业务组件解耦和功能复用，用户最终安装的是一个完整的APK("),s("strong",[t._v("组件化是实现插件化的前提")]),t._v(")；")]),t._v(" "),s("p",[t._v("插件化实现了业务功能的动态加载和替换，用户最终安装的是一个空宿主APK，然后通过DexClassLoader动态下载和加载功能插件apk。")])]),t._v(" "),s("li",[s("p",[t._v("why")]),t._v(" "),s("p",[t._v("用户不用安装APK就可以实现升级应用功能，减少发版频率，增加用户体验；")]),t._v(" "),s("p",[t._v("提供了快速修复bug和更新的能力；")]),t._v(" "),s("p",[t._v("减少了旧版接口兼容对服务器的压力；")]),t._v(" "),s("p",[t._v("模块化、解耦合、并行开发、65535问题；")])]),t._v(" "),s("li",[s("p",[t._v("how")]),t._v(" "),s("blockquote",[s("p",[t._v("**插件化原理：**这里就简单的带入一下，因为各家的实现基础原理都是差不多，类的加载通过反射把插件包中的dex插入到"),s("code",[t._v("BaseDexClassLoader")]),t._v("的"),s("code",[t._v("pathList")]),t._v("数组中保证类能够正确被找到，资源也通过反射调用"),s("code",[t._v("AssetManager")]),t._v("的"),s("code",[t._v("addAssetPaths")]),t._v("方法保证资源能够被正确的加载，JNI中的so包也可以通过反射插入到"),s("code",[t._v("BaseDexClassLoader")]),t._v("的"),s("code",[t._v("nativeLibraryDirectories")]),t._v("数组中。当然由于用了很多的反射也需要适配的很多不同版本的API，以及各种国内手机厂商ROM，这会在后面详细介绍。")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("资源和代码的加载")]),t._v(" "),s("p",[t._v("DexClassLoader加载apk，同个hook获取Resources上下文。")])]),t._v(" "),s("li",[s("p",[t._v("Android生命周期的管理？")]),t._v(" "),s("p",[t._v("通过Activity占坑方式实现；")]),t._v(" "),s("p",[t._v("通过Hook启动一个占坑Activity，然后再通过hook handler把真正的Activity替换回来(欺骗系统启动了一个已经注册的Activity)。")])]),t._v(" "),s("li",[s("p",[t._v("宿主APK和插件APK资源引用的冲突问题")]),t._v(" "),s("blockquote",[s("p",[t._v("资源的ID生成是有规则的，规则：0xPPTTNNNN，由8位16进制组成，其中：\nPP段：表示资源的包空间：0x01表示系统资源空间，0x7f表示应用资源空间。\nTT段：表示资源类型。\nNNNN段：4个16进制表示资源id，一个apk中同一类型资源从0000开始递增")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" anim pop_dialog_out "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x7f040001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" anim slide_left_in "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x7f040002")]),t._v("\n")])])])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("修改aapt源码，定制appt工具编译期间修改PP段(DynamicAPK就是这样做的)。")])]),t._v(" "),s("li",[s("p",[t._v("修改aapt的产物，即，编译后重新整理插件APK的资源，编排ID。")]),t._v(" "),s("p",[t._v("前面说过apk编译之后会生成ID以及对应的索引表resorce.arsc，那么我们能不能后期修改相关ID及索引表呢？答案是肯定的，个人比较赞同这种思路，不用入侵原有编译流程。")])])])])])])]),t._v(" "),s("h2",{attrs:{id:"二、业界框架介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、业界框架介绍"}},[t._v("#")]),t._v(" 二、业界框架介绍")]),t._v(" "),s("h3",{attrs:{id:"_1-dynamicloadapk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-dynamicloadapk"}},[t._v("#")]),t._v(" 1. DynamicLoadAPK")]),t._v(" "),s("p",[t._v("​\t "),s("strong",[t._v("插桩方式")]),t._v("实现四大组件生命周期管理("),s("strong",[t._v("静态代理，占坑的Activity会获取插件Activity的实例接口并在合适的生命周期方法中调用")]),t._v(")；")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加载插件和hook上下文")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadPathToPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Activity")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("File")]),t._v(" filesDir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MODE_PRIVATE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugin.apk"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("File")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filesDir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAbsolutePath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//然后我们开始加载我们的apk 使用DexClassLoader")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("File")]),t._v(" dexOutDir "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dex"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MODE_PRIVATE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        loader "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DexClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dexOutDir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAbsolutePath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过PackAgemanager 来获取插件的第一个activity是哪一个")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PackageManager")]),t._v(" packageManager "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPackageManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        packageInfo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" packageManager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPackageArchiveInfo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PackageManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET_ACTIVITIES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//然后开始加载我们的资源 肯定要使用Resource 但是它是AssetManager创建出来的 就是AssertManager 有一个addAssertPath 这个方法 但是私有的 所有使用反射")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" assetManagerClass "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AssetManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AssetManager")]),t._v(" assertManagerObj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AssetManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" assetManagerClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newInstance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" addAssetPathMethod "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" assetManagerClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"addAssetPath"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            addAssetPathMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAccessible")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            addAssetPathMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("assertManagerObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在创建一个Resource")]),t._v("\n            resources "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("assertManagerObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDisplayMetrics")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" activity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//对外提供插件的classLoader")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClassLoader")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" loader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//插件中的Resource")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Resources")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resources"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-droidplugin-360"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-droidplugin-360"}},[t._v("#")]),t._v(" 2. DroidPlugin(360)")]),t._v(" "),s("h3",{attrs:{id:"_3-replugin-360"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-replugin-360"}},[t._v("#")]),t._v(" 3. RePlugin(360)")]),t._v(" "),s("h3",{attrs:{id:"_4-small"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-small"}},[t._v("#")]),t._v(" 4. Small")]),t._v(" "),s("h3",{attrs:{id:"_5-virtualapk-滴滴"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-virtualapk-滴滴"}},[t._v("#")]),t._v(" 5. VirtualAPK(滴滴)")]),t._v(" "),s("h2",{attrs:{id:"三、知识点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、知识点"}},[t._v("#")]),t._v(" 三、知识点")]),t._v(" "),s("h4",{attrs:{id:"_1-app编译流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-app编译流程"}},[t._v("#")]),t._v(" 1. APP编译流程")]),t._v(" "),s("p",[t._v("第一步：aapt。为res目录下的资源生成R.java文件，同时为AndroidManifest.xml生成Manifest.java文件")]),t._v(" "),s("p",[t._v("第二步：aidl。把项目中自定义的aidl文件生成相应的Java代码文件")]),t._v(" "),s("p",[t._v("第三步：javac。把项目中所有的Java代码编译成class文件。包括三部分Java代码，自己写的的业务逻辑代码，aapt生成的Java文件，aidl生成的Java文件")]),t._v(" "),s("p",[t._v("第四步：proguard。混淆同时生成proguardMapping.txt。这一步是可选的")]),t._v(" "),s("p",[t._v("第五步：dex。把所有的class文件（包括第三方库的class文件）转换成dex文件")]),t._v(" "),s("p",[t._v("第六步：aapt。把res目录下的资源、assets目录下的文件，打包成一个.ap_文件")]),t._v(" "),s("p",[t._v("第七步：apkbuilder。将所有的dex文件、ap_文件、AndroidManifest.xml打包为.apk文件，这是一个未签名的apk包")]),t._v(" "),s("p",[t._v("第八步：jarsigner。对apk进行签名")]),t._v(" "),s("p",[t._v("第九步：zipaligin。对要发布的apk文件进行对齐操作，以便在运行时节省内存.")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("参考")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzA3MzE4ODY0Mg==&mid=2455983042&idx=1&sn=ba8131152ba3e04bcc8ae3fca0ba9d97&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t._v("1. 插件化框架知多少"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/Tencent/Shadow",target:"_blank",rel:"noopener noreferrer"}},[t._v("2. 腾讯 shadow "),s("strong",[t._v("零反射无Hack实现插件技术")]),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/didi/VirtualAPK",target:"_blank",rel:"noopener noreferrer"}},[t._v("3. 滴滴 VirtualAPK"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://ivonhoe.github.io/2018/01/18/Small%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/",target:"_blank",rel:"noopener noreferrer"}},[t._v("4. Small框架原理"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=e.exports}}]);