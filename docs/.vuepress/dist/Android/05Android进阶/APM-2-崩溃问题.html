<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>崩溃优化 | 知鱼之乐@Android</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Just playing around 1">
    
    <link rel="preload" href="/assets/css/0.styles.fab77d47.css" as="style"><link rel="preload" href="/assets/js/app.fc57e022.js" as="script"><link rel="preload" href="/assets/js/2.a8c6c3ae.js" as="script"><link rel="preload" href="/assets/js/60.79bf5e30.js" as="script"><link rel="prefetch" href="/assets/js/10.1f0b4cf4.js"><link rel="prefetch" href="/assets/js/100.a8dab1a2.js"><link rel="prefetch" href="/assets/js/101.aed67765.js"><link rel="prefetch" href="/assets/js/102.31e4829d.js"><link rel="prefetch" href="/assets/js/103.b84e3b94.js"><link rel="prefetch" href="/assets/js/104.0abcb0ed.js"><link rel="prefetch" href="/assets/js/105.2b1efd12.js"><link rel="prefetch" href="/assets/js/106.ca343c2b.js"><link rel="prefetch" href="/assets/js/107.0e1aaf70.js"><link rel="prefetch" href="/assets/js/108.bcbe1496.js"><link rel="prefetch" href="/assets/js/109.f2e58033.js"><link rel="prefetch" href="/assets/js/11.3b5d4d9d.js"><link rel="prefetch" href="/assets/js/110.dca83119.js"><link rel="prefetch" href="/assets/js/111.1bf4c2bb.js"><link rel="prefetch" href="/assets/js/112.d27bf211.js"><link rel="prefetch" href="/assets/js/113.fe77b001.js"><link rel="prefetch" href="/assets/js/114.3e90742f.js"><link rel="prefetch" href="/assets/js/115.f06c8502.js"><link rel="prefetch" href="/assets/js/116.f249f2f6.js"><link rel="prefetch" href="/assets/js/117.9c9e3266.js"><link rel="prefetch" href="/assets/js/118.585552a4.js"><link rel="prefetch" href="/assets/js/119.6fd28d8c.js"><link rel="prefetch" href="/assets/js/12.8483cbcc.js"><link rel="prefetch" href="/assets/js/13.9a0c00e0.js"><link rel="prefetch" href="/assets/js/14.fc54f0bc.js"><link rel="prefetch" href="/assets/js/15.0bdd8246.js"><link rel="prefetch" href="/assets/js/16.4955e533.js"><link rel="prefetch" href="/assets/js/17.7c49eeb3.js"><link rel="prefetch" href="/assets/js/18.e9655f93.js"><link rel="prefetch" href="/assets/js/19.aba98f0e.js"><link rel="prefetch" href="/assets/js/20.a663dfab.js"><link rel="prefetch" href="/assets/js/21.70be6b04.js"><link rel="prefetch" href="/assets/js/22.7dfb9f5a.js"><link rel="prefetch" href="/assets/js/23.2094fa32.js"><link rel="prefetch" href="/assets/js/24.505d35c8.js"><link rel="prefetch" href="/assets/js/25.490bc59a.js"><link rel="prefetch" href="/assets/js/26.53c05b33.js"><link rel="prefetch" href="/assets/js/27.198828b7.js"><link rel="prefetch" href="/assets/js/28.4706c105.js"><link rel="prefetch" href="/assets/js/29.894c0ad0.js"><link rel="prefetch" href="/assets/js/3.024d7a3e.js"><link rel="prefetch" href="/assets/js/30.2d82fef6.js"><link rel="prefetch" href="/assets/js/31.a37622a3.js"><link rel="prefetch" href="/assets/js/32.c9292e8d.js"><link rel="prefetch" href="/assets/js/33.e8e5ec21.js"><link rel="prefetch" href="/assets/js/34.3b67fe72.js"><link rel="prefetch" href="/assets/js/35.3d267609.js"><link rel="prefetch" href="/assets/js/36.8bfcd8bd.js"><link rel="prefetch" href="/assets/js/37.32a3bbc5.js"><link rel="prefetch" href="/assets/js/38.460433c9.js"><link rel="prefetch" href="/assets/js/39.4e8803a4.js"><link rel="prefetch" href="/assets/js/4.e465ce45.js"><link rel="prefetch" href="/assets/js/40.814a2790.js"><link rel="prefetch" href="/assets/js/41.e91c05fe.js"><link rel="prefetch" href="/assets/js/42.7aee18ea.js"><link rel="prefetch" href="/assets/js/43.b807463f.js"><link rel="prefetch" href="/assets/js/44.0dd75758.js"><link rel="prefetch" href="/assets/js/45.172d766d.js"><link rel="prefetch" href="/assets/js/46.3efe575d.js"><link rel="prefetch" href="/assets/js/47.80f31f9f.js"><link rel="prefetch" href="/assets/js/48.a86f2753.js"><link rel="prefetch" href="/assets/js/49.466c0d9e.js"><link rel="prefetch" href="/assets/js/5.19e860bb.js"><link rel="prefetch" href="/assets/js/50.87e4b15b.js"><link rel="prefetch" href="/assets/js/51.029ae25a.js"><link rel="prefetch" href="/assets/js/52.0e581e9f.js"><link rel="prefetch" href="/assets/js/53.1e5f9e2c.js"><link rel="prefetch" href="/assets/js/54.2b5b61b4.js"><link rel="prefetch" href="/assets/js/55.8aae53fb.js"><link rel="prefetch" href="/assets/js/56.808353f6.js"><link rel="prefetch" href="/assets/js/57.43f3f7f0.js"><link rel="prefetch" href="/assets/js/58.839639ab.js"><link rel="prefetch" href="/assets/js/59.9782d5b0.js"><link rel="prefetch" href="/assets/js/6.f4100330.js"><link rel="prefetch" href="/assets/js/61.e76d4646.js"><link rel="prefetch" href="/assets/js/62.ebe40240.js"><link rel="prefetch" href="/assets/js/63.8d04f05e.js"><link rel="prefetch" href="/assets/js/64.eb42f05d.js"><link rel="prefetch" href="/assets/js/65.0c100fe9.js"><link rel="prefetch" href="/assets/js/66.0c985612.js"><link rel="prefetch" href="/assets/js/67.d987014f.js"><link rel="prefetch" href="/assets/js/68.02a03b99.js"><link rel="prefetch" href="/assets/js/69.732c8bba.js"><link rel="prefetch" href="/assets/js/7.50e53555.js"><link rel="prefetch" href="/assets/js/70.a5ed6d0f.js"><link rel="prefetch" href="/assets/js/71.7b2360c4.js"><link rel="prefetch" href="/assets/js/72.cc2d252c.js"><link rel="prefetch" href="/assets/js/73.880477c8.js"><link rel="prefetch" href="/assets/js/74.8f437293.js"><link rel="prefetch" href="/assets/js/75.d828f38b.js"><link rel="prefetch" href="/assets/js/76.df328550.js"><link rel="prefetch" href="/assets/js/77.1702435f.js"><link rel="prefetch" href="/assets/js/78.390418a2.js"><link rel="prefetch" href="/assets/js/79.61a0689c.js"><link rel="prefetch" href="/assets/js/8.5eed9a57.js"><link rel="prefetch" href="/assets/js/80.4f2b2e40.js"><link rel="prefetch" href="/assets/js/81.f21e3404.js"><link rel="prefetch" href="/assets/js/82.0ce11abf.js"><link rel="prefetch" href="/assets/js/83.70856362.js"><link rel="prefetch" href="/assets/js/84.f1570cca.js"><link rel="prefetch" href="/assets/js/85.68ef1379.js"><link rel="prefetch" href="/assets/js/86.54990a22.js"><link rel="prefetch" href="/assets/js/87.63b0353b.js"><link rel="prefetch" href="/assets/js/88.c3bdd28c.js"><link rel="prefetch" href="/assets/js/89.86f7c8ab.js"><link rel="prefetch" href="/assets/js/9.83e89ef4.js"><link rel="prefetch" href="/assets/js/90.907c0b0d.js"><link rel="prefetch" href="/assets/js/91.892fd2e3.js"><link rel="prefetch" href="/assets/js/92.5512365b.js"><link rel="prefetch" href="/assets/js/93.86b0c0a7.js"><link rel="prefetch" href="/assets/js/94.3b3989f8.js"><link rel="prefetch" href="/assets/js/95.71c7db4d.js"><link rel="prefetch" href="/assets/js/96.da562058.js"><link rel="prefetch" href="/assets/js/97.08808c5f.js"><link rel="prefetch" href="/assets/js/98.064887d6.js"><link rel="prefetch" href="/assets/js/99.203d8e27.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fab77d47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">知鱼之乐@Android</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Android/01基础机制/1.Android系统启动流程.html" class="sidebar-link">Android系统启动过程</a></li><li><a href="/Android/01基础机制/2.Binder进程通信机制.html" class="sidebar-link">Binder进程通信机制</a></li><li><a href="/Android/07面试题/1.面试题-计算机基础.html" class="sidebar-link">1面试题-计算机基础</a></li><li><a href="/Android/07面试题/2.面试题-Android.html" class="sidebar-link">2面试题-Android</a></li><li><a href="/Android/07面试题/3.面试题-架构设计.html" class="sidebar-link">3面试题-架构设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>操作系统等</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/操作系统等/C编译原理.html" class="sidebar-link">C++编译原理</a></li><li><a href="/操作系统等/Linux常用操作手册.html" class="sidebar-link">Linux操作手册</a></li><li><a href="/操作系统等/IOS.html" class="sidebar-link">IOS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Tools/1.Mac开发快捷键大全.html" class="sidebar-link">Mac开发快捷键大全</a></li><li><a href="/Tools/2.翻墙工具指南.html" class="sidebar-link">翻墙工具指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>投名状</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ppt/警世通言.html" class="sidebar-link">警世通言</a></li><li><a href="/ppt/1.阿里技术合伙人.html" class="sidebar-link">阿里技术</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="崩溃优化"><a href="#崩溃优化" class="header-anchor">#</a> 崩溃优化</h3> <p>[TOC]</p> <blockquote><p>解决方案：</p> <p>java crash: app自定义捕获异常； umeng等第三方捕获异常。</p> <p>native crash: google breakpad捕获异常minidump文件，再有带有调试信息的so根据pc值和偏移量获取方法名和函数。</p></blockquote> <h4 id="一、概述"><a href="#一、概述" class="header-anchor">#</a> 一、概述</h4> <p>​	我们都知道，Android崩溃分为Java崩溃和Native崩溃。Java崩溃捕获比较简单，Native崩溃捕获复杂。</p> <p>​	正常的崩溃问题处理流程是，</p> <ol><li>定义崩溃率指标；</li> <li>收集和分析崩溃信息；</li> <li>持续优化和更新指标。</li></ol> <h4 id="二、java崩溃"><a href="#二、java崩溃" class="header-anchor">#</a> 二、Java崩溃</h4> <h5 id="_1-崩溃捕获原理"><a href="#_1-崩溃捕获原理" class="header-anchor">#</a> 1. 崩溃捕获原理</h5> <ol><li><p>当某个线程发生异常时，JVM会主动调用该线程的异常分发函数。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**  Thread.java
     * Dispatch an uncaught exception to the handler. This method is
     * intended to be called only by the JVM.
     */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">dispatchUncaughtException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>按优先级查找该线程的异常处理函数</p> <table><thead><tr><th>优先级</th> <th>影响范围</th> <th>如何设置</th></tr></thead> <tbody><tr><td>最高</td> <td>当个线程</td> <td>thread.setUncaughtExeptionHandler</td></tr> <tr><td>次高</td> <td>当前ThreadGroup中所有的线程</td> <td>重写threadGroup.uncaughtException</td></tr> <tr><td>最次</td> <td>全部线程(静态方法)</td> <td>Thread.setDefaultUncaughtExceptionHandler</td></tr> <tr><td>最末</td> <td>打印堆栈到log或控制台</td> <td>e.printStackTrace(System.err);</td></tr></tbody></table> <p>每个线程都是属于一个线程组的，UI线程(或新创建的线程)都属于main线程组，main线程组属于system线程组。</p></li> <li><p>执行处理函数</p></li></ol> <h5 id="_2-android代码"><a href="#_2-android代码" class="header-anchor">#</a> 2. Android代码</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// AppApplication.java </span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">setDefaultUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread<span class="token punctuation">.</span>UncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uncaughtException</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 收集、上传、分析。</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_3-知识点"><a href="#_3-知识点" class="header-anchor">#</a> 3. 知识点</h5> <p>​	Java异常分类；Thread线程代码；ThreadGroup和线程池。</p> <h4 id="三、native崩溃"><a href="#三、native崩溃" class="header-anchor">#</a> 三、Native崩溃</h4> <h5 id="_1-logcat默认崩溃信息"><a href="#_1-logcat默认崩溃信息" class="header-anchor">#</a> 1. Logcat默认崩溃信息：</h5> <div class="language-verilog extra-class"><pre class="language-verilog"><code><span class="token comment">// 根据Linux信号量类型我们能分析出错误类型(地址访问错误)，无法输出native和java堆栈</span>
<span class="token operator">---------</span> beginning of crash
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.340</span> <span class="token number">17883</span><span class="token operator">-</span><span class="token number">17883</span><span class="token operator">/</span>com<span class="token punctuation">.</span>alex<span class="token punctuation">.</span>androidjetpack A<span class="token operator">/</span>libc<span class="token punctuation">:</span> Fatal signal <span class="token number">11</span> <span class="token punctuation">(</span>SIGSEGV<span class="token punctuation">)</span><span class="token punctuation">,</span> code <span class="token number">1</span> <span class="token punctuation">(</span>SEGV_MAPERR<span class="token punctuation">)</span><span class="token punctuation">,</span> fault addr <span class="token number">0</span>x1b13f in tid <span class="token number">17883</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>androidjetpack<span class="token punctuation">)</span><span class="token punctuation">,</span> pid <span class="token number">17883</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>androidjetpack<span class="token punctuation">)</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.423</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> I<span class="token operator">/</span>crash_dump64<span class="token punctuation">:</span> obtaining <span class="token keyword">output</span> fd from tombstoned<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">:</span> kDebuggerdTombstone
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.424</span> <span class="token number">738</span><span class="token operator">-</span><span class="token number">738</span><span class="token operator">/?</span> I<span class="token comment">//system/bin/tombstoned: received crash request for pid 17883</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.425</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> I<span class="token operator">/</span>crash_dump64<span class="token punctuation">:</span> performing dump of process <span class="token number">17883</span> <span class="token punctuation">(</span>target tid <span class="token operator">=</span> <span class="token number">17883</span><span class="token punctuation">)</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.433</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span> <span class="token operator">***</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.433</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> Build fingerprint<span class="token punctuation">:</span> 'HONOR<span class="token operator">/</span>STF<span class="token operator">-</span>AL00<span class="token operator">/</span>HWSTF<span class="token punctuation">:</span><span class="token number">9</span><span class="token operator">/</span>HUAWEISTF<span class="token operator">-</span>AL00<span class="token operator">/</span><span class="token number">9.1</span><span class="token punctuation">.</span><span class="token number">0.201</span>C00<span class="token punctuation">:</span>user<span class="token operator">/</span><span class="token keyword">release</span><span class="token operator">-</span>keys'
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.433</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> Revision<span class="token punctuation">:</span> '<span class="token number">0</span>'
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.433</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> ABI<span class="token punctuation">:</span> 'arm64'
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> Happend<span class="token punctuation">:</span> 'Thu Dec <span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28</span> <span class="token number">2020</span>
    '
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> SYSVMTYPE<span class="token punctuation">:</span> Art
    APPVMTYPE<span class="token punctuation">:</span> Art
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> pid<span class="token punctuation">:</span> <span class="token number">17883</span><span class="token punctuation">,</span> tid<span class="token punctuation">:</span> <span class="token number">17883</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token punctuation">.</span>androidjetpack  <span class="token operator">&gt;&gt;&gt;</span> com<span class="token punctuation">.</span>alex<span class="token punctuation">.</span>androidjetpack <span class="token operator">&lt;&lt;&lt;</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span> signal <span class="token number">11</span> <span class="token punctuation">(</span>SIGSEGV<span class="token punctuation">)</span><span class="token punctuation">,</span> code <span class="token number">1</span> <span class="token punctuation">(</span>SEGV_MAPERR<span class="token punctuation">)</span><span class="token punctuation">,</span> fault addr <span class="token number">0</span>x1b13f
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span>     x0  <span class="token number">000000000001</span>b13f  x1  <span class="token number">0000000000000320</span>  x2  <span class="token number">000000000001</span>b13f  x3  <span class="token number">0000000000000320</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span>     x4  <span class="token number">0000007</span>cc7c15c00  x5  <span class="token number">0000007</span>ff25d5bf0  x6  <span class="token number">0000007</span>ff25d59f0  x7  <span class="token number">0000007</span>cc7758fb4
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">28.434</span> <span class="token number">18002</span><span class="token operator">-</span><span class="token number">18002</span><span class="token operator">/?</span> A<span class="token operator">/</span>DEBUG<span class="token punctuation">:</span>     x8  <span class="token number">000000000001</span>b13f  x9  <span class="token number">0000000000000320</span>  x10 <span class="token number">0000000000430000</span>  x11 <span class="token number">0000007</span>cc7b2d6d8

</code></pre></div><h5 id="_2-崩溃捕获原理"><a href="#_2-崩溃捕获原理" class="header-anchor">#</a> 2. 崩溃捕获原理</h5> <h6 id="_1-系统层面原理"><a href="#_1-系统层面原理" class="header-anchor">#</a> 1. 系统层面原理</h6> <img src="images/apm_crash_navite_handler.png" style="zoom:100%;"> <h6 id="_2-捕获native-crash"><a href="#_2-捕获native-crash" class="header-anchor">#</a> 2. 捕获Native crash</h6> <ol><li><p>注册信号处理函数</p> <div class="language-java extra-class"><pre class="language-java"><code>#include <span class="token generics"><span class="token punctuation">&lt;</span>signal<span class="token punctuation">.</span>h<span class="token punctuation">&gt;</span></span> 
<span class="token keyword">int</span> <span class="token function">sigaction</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">,</span><span class="token keyword">const</span> struct sigaction <span class="token operator">*</span>act<span class="token punctuation">,</span>struct sigaction <span class="token operator">*</span>oldact<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>设置额外栈空间</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code>#include <span class="token generics"><span class="token punctuation">&lt;</span>signal<span class="token punctuation">.</span>h<span class="token punctuation">&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">sigaltstack</span><span class="token punctuation">(</span><span class="token keyword">const</span> stack_t <span class="token operator">*</span>ss<span class="token punctuation">,</span> stack_t <span class="token operator">*</span>oss<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>SIGSEGV很有可能是栈溢出引起的，如果在默认的栈上运行很有可能会破坏程序运行的现场，无法获取到正确的上下文。而且当栈满了（太多次递归，栈上太多对象），系统会在同一个已经满了的栈上调用SIGSEGV的信号处理函数，又再一次引起同样的信号。</li> <li>我们应该开辟一块新的空间作为运行信号处理函数的栈。可以使用sigaltstack在任意线程注册一个可选的栈，保留一下在紧急情况下使用的空间。（系统会在危险情况下把栈指针指向这个地方，使得可以在一个新的栈上运行信号处理函数）</li></ul> <ol start="4"><li>兼容其他singal处理</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">my_handler</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> code<span class="token punctuation">,</span> siginfo_t <span class="token operator">*</span><span class="token keyword">const</span> si<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">const</span> sc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
  <span class="token comment">/* Call previous handler. */</span>  
  old_handler<span class="token punctuation">.</span><span class="token function">sa_sigaction</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> si<span class="token punctuation">,</span> sc<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><ul><li>某些信号可能在之前已经被安装过信号处理函数，而sigaction一个信号量只能注册一个处理函数，这意味着我们的处理函数会覆盖其他人的处理信号</li> <li>保存旧的处理函数，在处理完我们的信号处理函数后，在重新运行老的处理函数就能完成兼容。</li></ul> <h6 id="_3-收集native-crash原因"><a href="#_3-收集native-crash原因" class="header-anchor">#</a> 3. 收集Native crash原因</h6> <ol><li><p>code</p> <p>查询Code标，找到错误大致原因。</p> <p><code>signal 11 (SIGSEGV), code 0 (SI_USER), fault addr 0x0</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">case</span> SIGFPE<span class="token operator">:</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> FPE_INTDIV<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Integer divide by zero&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_INTOVF<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Integer overflow&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_FLTDIV<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Floating-point divide by zero&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_FLTOVF<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Floating-point overflow&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_FLTUND<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Floating-point underflow&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_FLTRES<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Floating-point inexact result&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_FLTINV<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Invalid floating-point operation&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> FPE_FLTSUB<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Subscript out of range&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Floating-point&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> SIGSEGV<span class="token operator">:</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> SEGV_MAPERR<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Address not mapped to object&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> SEGV_ACCERR<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Invalid permissions for mapped object&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Segmentation violation&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>分析pc值和查找共享库名称和相对偏移量</p> <p>得到相对偏移地址之后，使用readelf查看共享库的符号表，就可以知道是哪个函数crash了。</p></li></ol> <img src="images/apm_native_crash_address_anay.png" style="zoom:50%;"> <h6 id="_4-获取堆栈"><a href="#_4-获取堆栈" class="header-anchor">#</a> 4. 获取堆栈</h6> <p>在前一步，我们获取了奔溃时的pc值和各个寄存器的内容，通过SP和FP所限定的stack frame，就可以得到母函数的SP和FP，从而得到母函数的stack frame（PC，LR，SP，FP会在函数调用的第一时间压栈），以此追溯，即可得到所有函数的调用顺序。</p> <ul><li>在4.1.1以上，5.0以下：使用安卓系统自带的libcorkscrew.so</li> <li>5.0以上：安卓系统中没有了libcorkscrew.so，使用自己编译的libunwind</li></ul> <h6 id="_5-获取函数符号"><a href="#_5-获取函数符号" class="header-anchor">#</a> 5. 获取函数符号</h6> <p>可以通过libcorkscrew中的get_backtrace_symbols函数获得函数符号。</p> <p>更通用的方法是通过dladdr获得函数名字。</p> <p>传入每一层堆栈的相对偏移地址，就可以从dli_fname中获得函数名字。</p> <h6 id="_6-获取java堆栈"><a href="#_6-获取java堆栈" class="header-anchor">#</a> 6. 获取Java堆栈</h6> <p>如何获得native crash所对应的java层堆栈，这个问题曾经困扰了我一段时间。这里有一个前提：我们认为crash线程就是捕获到信号的线程，虽然这在SIGABRT下不一定可靠。有了这个认知，接下来就好办了。在信号处理函数中获得当前线程的名字，然后把crash线程的名字传给java层，在java里dump出这个线程的堆栈，就是crash所对应的java层堆栈了。</p> <p>在c中获得线程名字：</p> <p>然后传给java层：</p> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">/**
     * 根据线程名获得线程对象，native层会调用该方法，不能混淆
     * @param threadName
     * @return
     */</span>
    <span class="token annotation punctuation">@Keep</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Thread</span> <span class="token function">getThreadByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> threadName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>threadName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> threadSet <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">getAllStackTraces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">[</span><span class="token punctuation">]</span> threadArray <span class="token operator">=</span> threadSet<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">[</span>threadSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> theThread <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread <span class="token operator">:</span> threadArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>threadName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                theThread <span class="token operator">=</span>  thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;threadName: &quot;</span> <span class="token operator">+</span> threadName <span class="token operator">+</span> <span class="token string">&quot;, thread: &quot;</span> <span class="token operator">+</span> theThread<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> theThread<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h6 id="_7-结果展示"><a href="#_7-结果展示" class="header-anchor">#</a> 7. 结果展示</h6> <p>经过诸多探索，终于得到了完美的堆栈(有时候需要与logcat结合分析)：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Error</span><span class="token operator">:</span> signal <span class="token number">11</span> <span class="token punctuation">(</span><span class="token class-name">Address</span> not mapped <span class="token keyword">to</span> <span class="token namespace">object</span><span class="token punctuation">)</span> at address <span class="token number">0x0</span>
  at <span class="token class-name"><span class="token namespace">dalvik<span class="token punctuation">.</span>system<span class="token punctuation">.</span></span>NativeStart</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Error</span><span class="token operator">:</span> signal <span class="token number">11</span> <span class="token punctuation">(</span><span class="token class-name">Address</span> not mapped <span class="token keyword">to</span> <span class="token namespace">object</span><span class="token punctuation">)</span> at address <span class="token number">0x0</span>
  at <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>moai<span class="token punctuation">.</span>crashcatcher<span class="token punctuation">.</span>demo<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libQMCrashGenerator<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0xd8e</span><span class="token punctuation">(</span>dangerousFunction<span class="token operator">:</span><span class="token number">0x5</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>moai<span class="token punctuation">.</span>crashcatcher<span class="token punctuation">.</span>demo<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libQMCrashGenerator<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0xd95</span><span class="token punctuation">(</span>wrapDangerousFunction<span class="token operator">:</span><span class="token number">0x2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>moai<span class="token punctuation">.</span>crashcatcher<span class="token punctuation">.</span>demo<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libQMCrashGenerator<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0xd9d</span><span class="token punctuation">(</span>nativeInvalidAddressCrash<span class="token operator">:</span><span class="token number">0x2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x1ee8c</span><span class="token punctuation">(</span>dvmPlatformInvoke<span class="token operator">:</span><span class="token number">0x70</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x503b7</span><span class="token punctuation">(</span><span class="token function">dvmCallJNIMethod</span><span class="token punctuation">(</span>unsigned <span class="token keyword">int</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">JValue</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Method</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0x1ee</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x28268</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x2f738</span><span class="token punctuation">(</span><span class="token function">dvmMterpStd</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0x44</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x2cda8</span><span class="token punctuation">(</span><span class="token function">dvmInterpret</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Method</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">JValue</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0xb8</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x648e3</span><span class="token punctuation">(</span><span class="token function">dvmInvokeMethod</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Method</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">ArrayObject</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">ArrayObject</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">ClassObject</span><span class="token operator">*</span><span class="token punctuation">,</span> bool<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0x1aa</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x6cff9</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x28268</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x2f738</span><span class="token punctuation">(</span><span class="token function">dvmMterpStd</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0x44</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x2cda8</span><span class="token punctuation">(</span><span class="token function">dvmInterpret</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Method</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">JValue</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0xb8</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x643d9</span><span class="token punctuation">(</span><span class="token function">dvmCallMethodV</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Method</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token operator">*</span><span class="token punctuation">,</span> bool<span class="token punctuation">,</span> <span class="token class-name">JValue</span><span class="token operator">*</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">__va_list</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0x14c</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x4bca1</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libandroid_runtime<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x50ac3</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libandroid_runtime<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0x518e7</span><span class="token punctuation">(</span>android<span class="token operator">::</span><span class="token class-name">AndroidRuntime</span><span class="token operator">::</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">0x206</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>bin<span class="token operator">/</span>app_process<span class="token punctuation">.</span><span class="token function">0xf33</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token function">0xf584</span><span class="token punctuation">(</span>__libc_init<span class="token operator">:</span><span class="token number">0x64</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">)</span>
  at <span class="token operator">/</span>system<span class="token operator">/</span>bin<span class="token operator">/</span>app_process<span class="token punctuation">.</span><span class="token function">0x107c</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Error</span><span class="token operator">:</span> java stack
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>crashcatcher<span class="token punctuation">.</span></span>CrashCatcher</span><span class="token punctuation">.</span><span class="token function">nativeInvalidAddressCrash</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>crashcatcher<span class="token punctuation">.</span></span>CrashCatcher</span><span class="token punctuation">.</span><span class="token function">invalidAddressCrash</span><span class="token punctuation">(</span><span class="token class-name">CrashCatcher</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>tencent<span class="token punctuation">.</span>moai<span class="token punctuation">.</span>crashcatcher<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span>MainActivity</span>$<span class="token number">4.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span>View</span><span class="token punctuation">.</span><span class="token function">performClick</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">4488</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span>View</span>$<span class="token class-name">PerformClick</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">18860</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Handler</span><span class="token punctuation">.</span><span class="token function">handleCallback</span><span class="token punctuation">(</span><span class="token class-name">Handler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">808</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Handler</span><span class="token punctuation">.</span><span class="token function">dispatchMessage</span><span class="token punctuation">(</span><span class="token class-name">Handler</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">103</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Looper</span><span class="token punctuation">.</span><span class="token function">loop</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">222</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span>ActivityThread</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">ActivityThread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">5484</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invokeNative</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">515</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>ZygoteInit</span>$<span class="token class-name">MethodAndArgsCaller</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ZygoteInit</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">860</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>ZygoteInit</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">ZygoteInit</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">676</span><span class="token punctuation">)</span>
  at <span class="token class-name"><span class="token namespace">dalvik<span class="token punctuation">.</span>system<span class="token punctuation">.</span></span>NativeStart</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="_3-解决方案"><a href="#_3-解决方案" class="header-anchor">#</a> 3. 解决方案</h5> <p>Google Breakpad 权威，代码体量大；</p> <p>coffeecatch 存在兼容问题；</p> <p>bugly、阿里-岳鹰平台、网易云捕(中小公司可以使用)。</p> <h5 id="_4-知识点"><a href="#_4-知识点" class="header-anchor">#</a> 4. 知识点</h5> <p>NDK开发、Linux系统知识和编译知识。</p> <p><a href="https://mp.weixin.qq.com/s/g-WzYF3wWAljok1XjPoo7w?" target="_blank" rel="noopener noreferrer">参考文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/AndroidAdvanceWithGeektime/Chapter01" target="_blank" rel="noopener noreferrer">breadpad项目练习研究<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="四、解决方案"><a href="#四、解决方案" class="header-anchor">#</a> 四、解决方案</h4> <h5 id="_1-定义崩溃验收标准"><a href="#_1-定义崩溃验收标准" class="header-anchor">#</a> 1. 定义崩溃验收标准</h5> <p><strong>UV 崩溃率：</strong><code>UV 崩溃率 = 发生崩溃的 UV / 登录 UV</code></p> <p>当然，崩溃率与用户使用时长有关，另外还可以单独统计PV崩溃率、启动崩溃率、重复崩溃率等指标。</p> <ul><li><p>启动崩溃</p> <p>可以通过添加<strong>安全模式</strong>解决，如何启动崩溃是保存错误信息，如何连续发生三次，清除补丁或对应缓存。</p></li></ul> <h5 id="_2-实现崩溃的捕获、分析、报警、持续改进"><a href="#_2-实现崩溃的捕获、分析、报警、持续改进" class="header-anchor">#</a> 2. 实现崩溃的捕获、分析、报警、持续改进</h5> <h5 id="_3-启动崩溃安全模式解决方法"><a href="#_3-启动崩溃安全模式解决方法" class="header-anchor">#</a> 3. 启动崩溃安全模式解决方法</h5> <p><a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247488429&amp;idx=1&amp;sn=448b414a0424d06855359b3eb2ba8569&amp;source=41#wechat_redirect" target="_blank" rel="noopener noreferrer">安全模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="_4-崩溃分析方法"><a href="#_4-崩溃分析方法" class="header-anchor">#</a> 4. 崩溃分析方法</h5> <p><strong>信息采集：</strong></p> <ol><li>崩溃信息</li> <li>系统信息</li> <li>内存信息</li> <li>资源信息</li> <li>业务信息</li></ol> <p><strong>分析：</strong></p> <ol><li>确认重点</li> <li>查找共性</li> <li>尝试复现</li></ol> <h4 id="五、breakpad源码研究"><a href="#五、breakpad源码研究" class="header-anchor">#</a> 五、BreakPad源码研究</h4> <p><a href="https://github.com/AndroidAdvanceWithGeektime/Chapter01" target="_blank" rel="noopener noreferrer">1. demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/google/breakpad" target="_blank" rel="noopener noreferrer">2. 源码地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>Google breakpad是一个跨平台的崩溃转储和分析框架和工具集合。</p> <p>Breakpad由三个主要组件：</p> <ul><li>client，以library的形式内置在你的应用中，当崩溃发生时写 <strong>minidump文件</strong></li> <li>symbol dumper, 读取由编译器生成的调试信息（debugging information），并生成 <strong>symbol file</strong></li> <li>processor， 读取 <strong>minidump文件</strong> 和 <strong>symbol file</strong> ，生成可读的c/c++ Stack trace.</li></ul> <p>简单来说就是一个生成 minidump，一个生成symbol file，然后将其合并处理成可读的Stack trace。</p></blockquote> <ol><li><p>自己编译源码</p> <p>翻墙下载源代码；</p> <p>生成堆栈解析执行文件： <code>/Users/xin/Desktop/breakpad/src/processor/minidump_stackwalk</code></p></li> <li><p>生成crashlog</p> <p>运行项目，生成crashlog;</p> <p>执行命令(<strong>生成可读的文件</strong>)：<code>/minidump_stackwalk crashDump/***.dmp &gt;crashLog.txt</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Operating</span> system<span class="token operator">:</span> <span class="token class-name">Android</span>
                  <span class="token number">0.0</span><span class="token number">.0</span> <span class="token class-name">Linux</span> <span class="token number">4.9</span><span class="token number">.148</span> #<span class="token number">1</span> SMP PREEMPT <span class="token class-name">Wed</span> <span class="token class-name">Jul</span> <span class="token number">24</span> <span class="token number">06</span><span class="token operator">:</span><span class="token number">26</span><span class="token operator">:</span><span class="token number">03</span> CST <span class="token number">2019</span> aarch64
CPU<span class="token operator">:</span> arm64
     <span class="token number">8</span> <span class="token class-name">CPUs</span>

GPU<span class="token operator">:</span> UNKNOWN

<span class="token class-name">Crash</span> reason<span class="token operator">:</span>  SIGSEGV <span class="token operator">/</span>SEGV_MAPERR
<span class="token class-name">Crash</span> address<span class="token operator">:</span> <span class="token number">0x0</span>
<span class="token class-name">Process</span> uptime<span class="token operator">:</span> not available

<span class="token class-name">Thread</span> <span class="token number">0</span> <span class="token punctuation">(</span>crashed<span class="token punctuation">)</span>
 <span class="token number">0</span>  libcrash<span class="token operator">-</span>lib<span class="token punctuation">.</span>so <span class="token operator">+</span> <span class="token number">0x650</span>
     x0 <span class="token operator">=</span> <span class="token number">0x0000007cc7cc5460</span>    x1 <span class="token operator">=</span> <span class="token number">0x0000007ff25d5ca4</span>
     x2 <span class="token operator">=</span> <span class="token number">0x0000007ff25d5d40</span>    x3 <span class="token operator">=</span> <span class="token number">0x0000007cc7758f98</span>
     x4 <span class="token operator">=</span> <span class="token number">0x0000007ff25d5f60</span>    x5 <span class="token operator">=</span> <span class="token number">0x0000007cc3c77218</span>
     x6 <span class="token operator">=</span> <span class="token number">0x0000007ff25d5af0</span>    x7 <span class="token operator">=</span> <span class="token number">0x0000007caae25adc</span>
     x8 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>    x9 <span class="token operator">=</span> <span class="token number">0x0000000000000001</span>
    x10 <span class="token operator">=</span> <span class="token number">0x0000000000430000</span>   x11 <span class="token operator">=</span> <span class="token number">0x0000007cc7b2d6d8</span>
    x12 <span class="token operator">=</span> <span class="token number">0x0000007d4e121590</span>   x13 <span class="token operator">=</span> <span class="token number">0x8f68110c7404b1eb</span>
    x14 <span class="token operator">=</span> <span class="token number">0x0000007d4e089000</span>   x15 <span class="token operator">=</span> <span class="token number">0xffffffffffffffff</span>
    x16 <span class="token operator">=</span> <span class="token number">0x0000007cb7362fe8</span>   x17 <span class="token operator">=</span> <span class="token number">0x0000007cb736163c</span>
    x18 <span class="token operator">=</span> <span class="token number">0x0000000000000001</span>   x19 <span class="token operator">=</span> <span class="token number">0x0000007cc7c15c00</span>
    x20 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>   x21 <span class="token operator">=</span> <span class="token number">0x0000007cc7c15c00</span>
    x22 <span class="token operator">=</span> <span class="token number">0x0000007ff25d5f70</span>   x23 <span class="token operator">=</span> <span class="token number">0x0000007caae98bad</span>
    x24 <span class="token operator">=</span> <span class="token number">0x0000000000000004</span>   x25 <span class="token operator">=</span> <span class="token number">0x0000007d4e4bd5e0</span>
    x26 <span class="token operator">=</span> <span class="token number">0x0000007cc7c15ca0</span>   x27 <span class="token operator">=</span> <span class="token number">0x0000000000000001</span>
    x28 <span class="token operator">=</span> <span class="token number">0x0000007ff25d5ca0</span>    fp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5c70</span>
     lr <span class="token operator">=</span> <span class="token number">0x0000007cb7361674</span>    sp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5c50</span>
     pc <span class="token operator">=</span> <span class="token number">0x0000007cb7361650</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> given as instruction pointer in context
 <span class="token number">1</span>  libcrash<span class="token operator">-</span>lib<span class="token punctuation">.</span>so <span class="token operator">+</span> <span class="token number">0x670</span>
     fp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5ca0</span>    lr <span class="token operator">=</span> <span class="token number">0x0000007cc7a52fe4</span>
     sp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5c80</span>    pc <span class="token operator">=</span> <span class="token number">0x0000007cb7361674</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> previous frame's frame pointer
 <span class="token number">2</span>  libart<span class="token punctuation">.</span>so <span class="token operator">+</span> <span class="token number">0x577fe0</span>
     fp <span class="token operator">=</span> <span class="token number">0x132c090800000001</span>    lr <span class="token operator">=</span> <span class="token number">0x0000007d4e4bd5e0</span>
     sp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5cb0</span>    pc <span class="token operator">=</span> <span class="token number">0x0000007cc7a52fe4</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> previous frame's frame pointer
 <span class="token number">3</span>  system<span class="token annotation punctuation">@framework</span><span class="token annotation punctuation">@boot</span><span class="token operator">-</span>framework<span class="token punctuation">.</span>art <span class="token operator">+</span> <span class="token number">0x10744c</span>
     sp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5cc0</span>    pc <span class="token operator">=</span> <span class="token number">0x00000000706f1450</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> stack scanning
 <span class="token number">4</span>  dalvik<span class="token operator">-</span>main space <span class="token punctuation">(</span>region space<span class="token punctuation">)</span> <span class="token punctuation">(</span>deleted<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x6c0904</span>
     sp <span class="token operator">=</span> <span class="token number">0x0000007ff25d5cf8</span>    pc <span class="token operator">=</span> <span class="token number">0x00000000132c0908</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> stack scanning
 
<span class="token class-name">Thread</span> <span class="token number">1</span>
 <span class="token number">0</span>  libc<span class="token punctuation">.</span>so <span class="token operator">+</span> <span class="token number">0x1f2ec</span>
     x0 <span class="token operator">=</span> <span class="token number">0x0000007cc7c44ae8</span>    x1 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>
     x2 <span class="token operator">=</span> <span class="token number">0x0000000000000024</span>    x3 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>
     x4 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>    x5 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>
     x6 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>    x7 <span class="token operator">=</span> <span class="token number">0x000000002e230bf8</span>
     x8 <span class="token operator">=</span> <span class="token number">0x0000000000000062</span>    x9 <span class="token operator">=</span> <span class="token number">0xec34b51c15165519</span>
    x10 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>   x11 <span class="token operator">=</span> <span class="token number">0x0000000000000001</span>
    x12 <span class="token operator">=</span> <span class="token number">0x0000000000000002</span>   x13 <span class="token operator">=</span> <span class="token number">0x00000000000026f8</span>
    x14 <span class="token operator">=</span> <span class="token number">0x0008bf3a10477400</span>   x15 <span class="token operator">=</span> <span class="token number">0x00001348ba1548b2</span>
    x16 <span class="token operator">=</span> <span class="token number">0x0000007cc7b2a338</span>   x17 <span class="token operator">=</span> <span class="token number">0x0000007d4a4612d0</span>
    x18 <span class="token operator">=</span> <span class="token number">0x0000000000000000</span>   x19 <span class="token operator">=</span> <span class="token number">0x0000007cc7c44ad8</span>
    x20 <span class="token operator">=</span> <span class="token number">0x0000007cc1434000</span>   x21 <span class="token operator">=</span> <span class="token number">0x0000000000000024</span>
    x22 <span class="token operator">=</span> <span class="token number">0x0000007cc7c44ae8</span>   x23 <span class="token operator">=</span> <span class="token number">0x0000007cc7c44af0</span>
    x24 <span class="token operator">=</span> <span class="token number">0x0000007cc13ff570</span>   x25 <span class="token operator">=</span> <span class="token number">0x0000007cc13ff588</span>
    x26 <span class="token operator">=</span> <span class="token number">0x0000000000000001</span>   x27 <span class="token operator">=</span> <span class="token number">0x0000000000000016</span>
    x28 <span class="token operator">=</span> <span class="token number">0x0000007cc7c44a88</span>    fp <span class="token operator">=</span> <span class="token number">0x0000007cc13ff3e0</span>
     lr <span class="token operator">=</span> <span class="token number">0x0000007cc75b6d98</span>    sp <span class="token operator">=</span> <span class="token number">0x0000007cc13ff380</span>
     pc <span class="token operator">=</span> <span class="token number">0x0000007d4a4612ec</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> given as instruction pointer in context
 <span class="token number">1</span>  libart<span class="token punctuation">.</span>so <span class="token operator">+</span> <span class="token number">0xdbd94</span>
     fp <span class="token operator">=</span> <span class="token number">0x0000007cc13ff420</span>    lr <span class="token operator">=</span> <span class="token number">0x0000007cc799bfc8</span>
     sp <span class="token operator">=</span> <span class="token number">0x0000007cc13ff3f0</span>    pc <span class="token operator">=</span> <span class="token number">0x0000007cc75b6d98</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> previous frame's frame pointer
 <span class="token number">2</span>  libart<span class="token punctuation">.</span>so <span class="token operator">+</span> <span class="token number">0x4c0fc4</span>
     fp <span class="token operator">=</span> <span class="token number">0x0000007cc13ff450</span>    lr <span class="token operator">=</span> <span class="token number">0x0000007cc799b530</span>
     sp <span class="token operator">=</span> <span class="token number">0x0000007cc13ff430</span>    pc <span class="token operator">=</span> <span class="token number">0x0000007cc799bfc8</span>
    <span class="token class-name">Found</span> by<span class="token operator">:</span> previous frame's frame pointer
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   
</code></pre></div></li> <li><p>符号解析，可以使用 ndk 中提供的<code>addr2line</code>来根据地址进行一个符号反解的过程</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 出现乱码</span>
/Users/xin/Library/Android/sdk/ndk/21.0.6113669/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/arm-linux-androideabi-addr2line -f -C -e  /Users/xin/Desktop/libcrash-lib.so 0x650
<span class="token comment">#输出结果如下</span>
??
??:0
<span class="token comment"># 修复  </span>
aarch64-linux-android-addr2line -f -C -e /Users/xin/Chapter01/sample/build/intermediates/cmake/debug/obj/arm64-v8a/libcrash-lib.so 0x650
<span class="token comment">#输出结果如下  </span>
Crash<span class="token punctuation">(</span><span class="token punctuation">)</span>
/Users/xin/Chapter01/sample/src/main/cpp/crash.cpp:10 
</code></pre></div></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fc57e022.js" defer></script><script src="/assets/js/2.a8c6c3ae.js" defer></script><script src="/assets/js/60.79bf5e30.js" defer></script>
  </body>
</html>
