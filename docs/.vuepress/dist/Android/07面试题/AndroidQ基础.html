<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android基础 | 知鱼之乐@Android</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Just playing around 1">
    
    <link rel="preload" href="/assets/css/0.styles.4250c2dd.css" as="style"><link rel="preload" href="/assets/js/app.154db40d.js" as="script"><link rel="preload" href="/assets/js/2.c485b593.js" as="script"><link rel="preload" href="/assets/js/83.bb518bb6.js" as="script"><link rel="prefetch" href="/assets/js/10.284a1fb6.js"><link rel="prefetch" href="/assets/js/100.5c196c66.js"><link rel="prefetch" href="/assets/js/101.e25c184d.js"><link rel="prefetch" href="/assets/js/102.aca05560.js"><link rel="prefetch" href="/assets/js/103.496a1e10.js"><link rel="prefetch" href="/assets/js/104.3d7ad49b.js"><link rel="prefetch" href="/assets/js/105.65266e37.js"><link rel="prefetch" href="/assets/js/106.075f6399.js"><link rel="prefetch" href="/assets/js/107.5e687d88.js"><link rel="prefetch" href="/assets/js/108.b0d931a6.js"><link rel="prefetch" href="/assets/js/109.1fbe0311.js"><link rel="prefetch" href="/assets/js/11.e798c60c.js"><link rel="prefetch" href="/assets/js/110.22406ae5.js"><link rel="prefetch" href="/assets/js/111.2520bf9a.js"><link rel="prefetch" href="/assets/js/112.df856058.js"><link rel="prefetch" href="/assets/js/113.52e5a381.js"><link rel="prefetch" href="/assets/js/12.8595f619.js"><link rel="prefetch" href="/assets/js/13.e2df1669.js"><link rel="prefetch" href="/assets/js/14.c1715815.js"><link rel="prefetch" href="/assets/js/15.4ba71b7a.js"><link rel="prefetch" href="/assets/js/16.f37b9e9b.js"><link rel="prefetch" href="/assets/js/17.e63cfee0.js"><link rel="prefetch" href="/assets/js/18.bf266249.js"><link rel="prefetch" href="/assets/js/19.86da6a30.js"><link rel="prefetch" href="/assets/js/20.59042c57.js"><link rel="prefetch" href="/assets/js/21.35c89e65.js"><link rel="prefetch" href="/assets/js/22.f0e14166.js"><link rel="prefetch" href="/assets/js/23.16271f95.js"><link rel="prefetch" href="/assets/js/24.e38465fd.js"><link rel="prefetch" href="/assets/js/25.3f521cbf.js"><link rel="prefetch" href="/assets/js/26.333dd313.js"><link rel="prefetch" href="/assets/js/27.7061ef4f.js"><link rel="prefetch" href="/assets/js/28.5d3fbad1.js"><link rel="prefetch" href="/assets/js/29.29fbd9ec.js"><link rel="prefetch" href="/assets/js/3.191b68cc.js"><link rel="prefetch" href="/assets/js/30.112b0e7d.js"><link rel="prefetch" href="/assets/js/31.3fecc995.js"><link rel="prefetch" href="/assets/js/32.04c75f57.js"><link rel="prefetch" href="/assets/js/33.61c4ff7b.js"><link rel="prefetch" href="/assets/js/34.8bc44ae4.js"><link rel="prefetch" href="/assets/js/35.762ddb6b.js"><link rel="prefetch" href="/assets/js/36.ef3ac3f7.js"><link rel="prefetch" href="/assets/js/37.e4eb6644.js"><link rel="prefetch" href="/assets/js/38.38dc5f21.js"><link rel="prefetch" href="/assets/js/39.c79e2f32.js"><link rel="prefetch" href="/assets/js/4.bf6d514d.js"><link rel="prefetch" href="/assets/js/40.b1a86a15.js"><link rel="prefetch" href="/assets/js/41.19ea00cb.js"><link rel="prefetch" href="/assets/js/42.5352d715.js"><link rel="prefetch" href="/assets/js/43.fe921c0c.js"><link rel="prefetch" href="/assets/js/44.1b362439.js"><link rel="prefetch" href="/assets/js/45.f9401b96.js"><link rel="prefetch" href="/assets/js/46.2eb3594f.js"><link rel="prefetch" href="/assets/js/47.4816a892.js"><link rel="prefetch" href="/assets/js/48.16e90e9c.js"><link rel="prefetch" href="/assets/js/49.253e1d1a.js"><link rel="prefetch" href="/assets/js/5.92dc8a5a.js"><link rel="prefetch" href="/assets/js/50.0f29ea4c.js"><link rel="prefetch" href="/assets/js/51.eba922d1.js"><link rel="prefetch" href="/assets/js/52.fe29f1ee.js"><link rel="prefetch" href="/assets/js/53.66f14271.js"><link rel="prefetch" href="/assets/js/54.45d67d8f.js"><link rel="prefetch" href="/assets/js/55.ef6915bf.js"><link rel="prefetch" href="/assets/js/56.23f695c8.js"><link rel="prefetch" href="/assets/js/57.ccaabdb5.js"><link rel="prefetch" href="/assets/js/58.885add6f.js"><link rel="prefetch" href="/assets/js/59.81596e96.js"><link rel="prefetch" href="/assets/js/6.e8ea9ce9.js"><link rel="prefetch" href="/assets/js/60.28a3dd94.js"><link rel="prefetch" href="/assets/js/61.3b44974d.js"><link rel="prefetch" href="/assets/js/62.988302f9.js"><link rel="prefetch" href="/assets/js/63.9c5af58f.js"><link rel="prefetch" href="/assets/js/64.0fe27314.js"><link rel="prefetch" href="/assets/js/65.7aefff74.js"><link rel="prefetch" href="/assets/js/66.842eead8.js"><link rel="prefetch" href="/assets/js/67.3430d619.js"><link rel="prefetch" href="/assets/js/68.a0f61146.js"><link rel="prefetch" href="/assets/js/69.acfcecdc.js"><link rel="prefetch" href="/assets/js/7.c35f8860.js"><link rel="prefetch" href="/assets/js/70.1312b8b4.js"><link rel="prefetch" href="/assets/js/71.5ea783fc.js"><link rel="prefetch" href="/assets/js/72.586ee0be.js"><link rel="prefetch" href="/assets/js/73.b2c1f283.js"><link rel="prefetch" href="/assets/js/74.1926c49c.js"><link rel="prefetch" href="/assets/js/75.e15a7328.js"><link rel="prefetch" href="/assets/js/76.418b3c51.js"><link rel="prefetch" href="/assets/js/77.47177d4a.js"><link rel="prefetch" href="/assets/js/78.b83394ed.js"><link rel="prefetch" href="/assets/js/79.1efeffbc.js"><link rel="prefetch" href="/assets/js/8.fc97d996.js"><link rel="prefetch" href="/assets/js/80.c90de858.js"><link rel="prefetch" href="/assets/js/81.7f6acf2b.js"><link rel="prefetch" href="/assets/js/82.b247ecbb.js"><link rel="prefetch" href="/assets/js/84.e703630c.js"><link rel="prefetch" href="/assets/js/85.1ed5dfe2.js"><link rel="prefetch" href="/assets/js/86.65db5952.js"><link rel="prefetch" href="/assets/js/87.d9006703.js"><link rel="prefetch" href="/assets/js/88.26263b10.js"><link rel="prefetch" href="/assets/js/89.5bd2a4ab.js"><link rel="prefetch" href="/assets/js/9.83a0b4f2.js"><link rel="prefetch" href="/assets/js/90.ddd03a69.js"><link rel="prefetch" href="/assets/js/91.d5b9aa03.js"><link rel="prefetch" href="/assets/js/92.78f67ee8.js"><link rel="prefetch" href="/assets/js/93.0cbd404f.js"><link rel="prefetch" href="/assets/js/94.35ba1cae.js"><link rel="prefetch" href="/assets/js/95.9476e1ff.js"><link rel="prefetch" href="/assets/js/96.6de39c9e.js"><link rel="prefetch" href="/assets/js/97.09936f14.js"><link rel="prefetch" href="/assets/js/98.f675a377.js"><link rel="prefetch" href="/assets/js/99.a3d7bd05.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4250c2dd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">知鱼之乐@Android</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Android/01基础机制/1.Android系统启动流程.html" class="sidebar-link">Android系统启动过程</a></li><li><a href="/Android/01基础机制/2.Binder进程通信机制.html" class="sidebar-link">Binder进程通信机制</a></li><li><a href="/Android/07面试题/1.面试题-计算机基础.html" class="sidebar-link">1面试题-计算机基础</a></li><li><a href="/Android/07面试题/2.面试题-Android.html" class="sidebar-link">2面试题-Android</a></li><li><a href="/Android/07面试题/3.面试题-架构设计.html" class="sidebar-link">3面试题-架构设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>业务功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/业务功能设计/1.设计流畅的图片展示.html" class="sidebar-link">多图片显示</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Tools/1.Mac开发快捷键大全.html" class="sidebar-link">Mac开发快捷键大全</a></li><li><a href="/Tools/2.翻墙工具指南.html" class="sidebar-link">翻墙工具指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ppt/警世通言.html" class="sidebar-link">警世通言</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="android基础"><a href="#android基础" class="header-anchor">#</a> Android基础</h2> <p>[TOC]</p> <p><a href="https://www.jianshu.com/p/7bb56481063d" target="_blank" rel="noopener noreferrer">参考1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="四大组件"><a href="#四大组件" class="header-anchor">#</a> 四大组件</h3> <h4 id="_1-生命周期"><a href="#_1-生命周期" class="header-anchor">#</a> 1. 生命周期</h4> <h5 id="_1-activity声明周期"><a href="#_1-activity声明周期" class="header-anchor">#</a> 1. Activity声明周期？</h5> <ul><li><p>生命周期</p> <p>**normal:**onCreate-&gt;onStart()-&gt;onResume-&gt;onPause()-&gt;onStop()-&gt;onDestroy();</p> <p><strong>the acitvity comes to the foreground:</strong> onStop()-&gt;onRestart()-&gt;onStart-&gt;...</p> <p><strong>low memory:</strong> onPause()/onStop()-&gt;process is killed.</p> <p><strong>AActivity切换到BActivity:</strong></p> <p>AActivity:onCreate()-&gt;onStart()-&gt;onResume()-&gt;onPause();</p> <p>BActivity:onCreate()-&gt;onStart()-&gt;onResume();</p> <p>AActivity:onStop();</p> <p>返回AAcitvity：</p> <p>BActivity:onPause();</p> <p>AActivity:onRestart()-&gt;onStart()-&gt;onResume();</p> <p>BActivity:onStop()-&gt;onDestory();</p> <p><strong>AActivity切换到BDialog:</strong></p> <p>AActivity:onCreate()-&gt;onStart()-&gt;onResume()-&gt;onPause();</p> <p>BDialog:onCreate()-&gt;onStart()-&gt;onResume();</p></li> <li><p>onSaveinstanceState()/onRestoreInstanceState()</p> <p>outState参数作用： 数据报保存，键值对形式保存在Bundel对象中。</p> <p><strong>onSaveInstanceState调用时机：</strong></p> <p>(1)activity被系统销毁，也可能没有销毁就调用了；</p> <p>(2)按下Home键或电源键，Acitvity进入后台；</p> <p>(3)启动其他Activity，Activity被压入栈底；</p> <p>注意：</p> <p>(1)用户主动销毁不会调用，如单击回退键或调用finish();</p> <p>(2)调用时间不固定，该方法一定在onStop之前调用，但不确定在onPause之前还是之后；</p> <p><strong>onRestoreInstanceState调用时机：</strong></p> <p>(1)在Activity被系统销毁后，恢复时被调用； bundle对象也通过参数传递到onCreate()方法中。</p></li></ul> <h5 id="_2-service生命周期"><a href="#_2-service生命周期" class="header-anchor">#</a> 2. Service生命周期？</h5> <blockquote><p>startService()-&gt;onCreate()-&gt;onStartCommand()-&gt;onDestory();</p> <p>bindService()-&gt;onCreate()-&gt;onBind()-&gt;onUnbind()-&gt;onDestroy();</p></blockquote> <img src="images/fragment_lifecycle.png" style="zoom:80%;"> <p>1）启动Service服务
单次：<code>startService() —&gt; onCreate() —&gt; onStartCommand()</code>
多次：<code>startService() —&gt; onCreate() —&gt; onStartCommand() —&gt; onStartCommand()</code>
2）停止Service服务
<code>stopService() —&gt; onDestroy()</code>
3）绑定Service服务
<code>bindService() —&gt; onCreate() —&gt; onBind()</code>
4）解绑Service服务
<code>unbindService() —&gt; onUnbind() —&gt; onDestroy()</code>
5）启动绑定Service服务
<code>startService() —&gt; onCreate() —&gt; onStartCommand() —&gt; bindService() —&gt; onBind()</code>
6）解绑停止Service服务
<code>unbindService() —&gt; onUnbind() —&gt; stopService() —&gt; onDestroy()</code>
7）解绑绑定Service服务
<code>unbindService() —&gt; onUnbind(ture) —&gt; bindService() —&gt; onRebind()</code></p> <h5 id="_3-onresume中可以直接调用getheight获取高度信息吗-ks"><a href="#_3-onresume中可以直接调用getheight获取高度信息吗-ks" class="header-anchor">#</a> 3.  onResume中可以直接调用getHeight获取高度信息吗(ks)？</h5> <p>​	不可以。调用的时候还未开始测量UI。</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">handleResumeActivity</span><span class="token punctuation">(</span><span class="token class-name">IBinder</span> token<span class="token punctuation">,</span>
            <span class="token keyword">boolean</span> clearHide<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isForward<span class="token punctuation">,</span> <span class="token keyword">boolean</span> reallyResume<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">unscheduleGcIdler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mSomeActivitiesChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
 
        <span class="token comment">//1. 调用performReusmeActivity，其中会调用activity.onResume()</span>
        <span class="token class-name">ActivityClientRecord</span> r <span class="token operator">=</span> <span class="token function">performResumeActivity</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> clearHide<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">Activity</span> a <span class="token operator">=</span> r<span class="token punctuation">.</span>activity<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>window <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>a<span class="token punctuation">.</span>mFinished <span class="token operator">&amp;&amp;</span> willBeVisible<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                r<span class="token punctuation">.</span>window <span class="token operator">=</span> r<span class="token punctuation">.</span>activity<span class="token punctuation">.</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">View</span> decor <span class="token operator">=</span> r<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                decor<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>INVISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ViewManager</span> wm <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getWindowManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> l <span class="token operator">=</span> r<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                a<span class="token punctuation">.</span>mDecor <span class="token operator">=</span> decor<span class="token punctuation">;</span>
                l<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>TYPE_BASE_APPLICATION<span class="token punctuation">;</span>
                l<span class="token punctuation">.</span>softInputMode <span class="token operator">|=</span> forwardBit<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>mVisibleFromClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    a<span class="token punctuation">.</span>mWindowAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token comment">//2. 将decorView添加到window中，这也是View绘制开始的起点</span>
                    wm<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>decor<span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>        
</code></pre></div><h5 id="_3-java虚拟机和dalvik虚拟机和art区别"><a href="#_3-java虚拟机和dalvik虚拟机和art区别" class="header-anchor">#</a> 3. java虚拟机和Dalvik虚拟机和ART区别？</h5> <p><a href="/Android/07面试题/android/100qaAndroid基础.html">查看</a></p> <h5 id="_4-讲解一下context"><a href="#_4-讲解一下context" class="header-anchor">#</a> 4. 讲解一下Context？</h5> <blockquote><p>Context是一个抽象基类，可以理解为上下文，或环境，是提供一些程序运行的基本信息。</p></blockquote> <p>Context有两个子类，ContextWrapper(包装类)和ContextImpl(实现类)。</p> <p>ContextWrapper有三个直接子类，ContextThemeWrapper(Activity继承)、Service、Application。</p> <p>Context一共三种类型：Application、Service和Activity，绝大多数情况下是通用的。</p> <p>Context数量=Activity数量+Service数量+1(Application)</p> <h5 id="_5-四种launchmode及其使用场景"><a href="#_5-四种launchmode及其使用场景" class="header-anchor">#</a> 5. 四种LaunchMode及其使用场景？</h5> <ul><li><p>standard模式</p> <p>默认模式，创建Activity并放入栈中。</p></li> <li><p>singleTop模式</p> <p>如果activity正好在栈顶，就会重用该实例(调用实例onNewIntent())。多次点击或新闻类app。</p> <p>使用场景： 跳转按钮多次单击界面重复、</p></li> <li><p>singleTask模式</p> <p>如果存在，清空该实例上面的实例，并调用onNewIntent()方法。场景：主界面、浏览器。</p></li> <li><p>singleInstance模式</p> <p>在一个新栈中创建该Activity的实例，并让多个应用共享该栈中的该Activity实例(新栈中只有它一个实例)。</p> <p>如呼叫来电、闹铃提醒。</p></li></ul> <h5 id="_6-android动画种类和实现"><a href="#_6-android动画种类和实现" class="header-anchor">#</a> 6. Android动画种类和实现？</h5> <ul><li><p>帧动画</p> <p>专门用来一个一个的显示Drawable的resources，像放幻灯片一样。</p></li> <li><p>补间动画</p> <p>指通过指定View的初始状态、变化时间、方式，通过一系列算法进行图片变换。只要有Alpha、Scale、Translate、Rotate四种效果。</p> <p><strong>注意：只是在视图层实现了动画效果，并没有真正改变View的属性，比如滑动列表，改变标题栏的透明度。</strong></p></li> <li><p>属性动画</p></li></ul> <h5 id="_7-asynctask实现原理"><a href="#_7-asynctask实现原理" class="header-anchor">#</a> 7. AsyncTask实现原理？</h5> <blockquote><p>AsyncTask的实现原理 = 线程池 + Handler。</p></blockquote> <p>由于线程池大小限制问题，适合http请求或耗时较短的任务，大规模的下载或数据库操作会导致线程池阻塞。</p> <p>缺陷： AsyncTask第一次使用必须在主线程加载(4.1系统之前)；只能在UI线程使用；多次调用报错；代码太多，控制不灵活。</p> <h5 id="_8-谈谈你对binder机制的理解"><a href="#_8-谈谈你对binder机制的理解" class="header-anchor">#</a> 8. 谈谈你对Binder机制的理解？</h5> <p><a href="/Android/07面试题/android/100qaAndroid基础.html">参考Android基础</a></p> <p>​	Linux传统IPC主要有：管道、消息队列、共享内存和Socket等。消息队列和管道采用存储-转发方式，至少需要两次拷贝过程(用户空间-内核空间)。内存共享控制复杂，难以使用。socket作为一款通用接口，其传输效率低，开销大，主要用于跨网络的低速进程通信。从安全角度考虑，传统IPC无法获取对方进程可靠的UID/PID,且访问接入点是开放的，无法建立私用通道。</p> <p>​	Bindler通信机制起源于一个简单的想法：<strong>将申请服务的请求和对应的响应信息，写入一个所有进程都能访问的地址空间中。当进程使用这些数据时，只需要访问对应的内存地址，以减少内容复制引入的开销。为此，Bindler机制利用kernel空间作为共享区域，并用binder driver来建立每个进程的内存地址和kernel空间中存储地址的映射。从而使数据只copy一次就可以。同时为发送方添加UID/PID身份，既支持实名也支持匿名Bunder，提高安全性。</strong></p> <ul><li>bindler架构</li></ul> <ol><li><p>四大组成部分</p> <p>Client进程：使用服务的进程；</p> <p>Server进程：提供服务的进程；</p> <p>ServiceManager进程：SM的作用是将字符串形式的Binder名字转化成Client中对应Binder的引用，使得client能够通过binder名字获取对应server中binder实体的引用；</p> <p>Binder驱动：驱动负责进程之间Binder通信的建立、数据的传递和交互等一系列底层支持。</p></li> <li><p>使用步骤</p> <p>**注册服务：**服务端通过SM注册服务，注册过程是向Binder驱动全局链表binder_procs中插入服务的信息。</p> <p>**查询服务：**客户端向SM中发起获取服务的请求，SM从服务列表中查找Client需要的对应服务信息，将该服务的代理Binder(BinderProxy)返回给客户端。</p> <p><strong>使用服务：</strong></p> <p>① Binder驱动为跨进程通信做准备：通过调用mmap()系统函数实现内存映射。在Binder驱动中创建一块接收缓存区。同时将内核缓存区地址和Server端中用户空间一块地址同时都映射到该接收缓存区中。这时候就创建了虚拟区间和映射的关系。</p> <p>② Client进程将数据发送到Server进程。Client进程通过调用copy_from_user()发送数据拷贝到内核中（Binder驱动）的缓存区中，此时Client发起请求的线程会被挂起。由于在①中构建了映射关系，此时相当于也将数据发送到了Server端的用户空间中。之后Binder驱动通知Server端进程执行解包。</p> <p>③ Server进程根据Client进程发送来的数据，调用目标方法。收到Binder驱动通知后，Server进程对数据进行解包，并调用相关方法处理。</p> <p>④ Server进程将目标方法处理结果返回给Client进程。将处理结果放回自己的共享空间（即①中映射的Binder驱动缓存区中）。Binder驱动通知Client进程获取返回结果，此时②中被挂起的线程会被重新唤醒。Client进程通过系统调用copy_to_user(),从内核缓存区拷贝Server进程返回的结果。</p> <p>从上面使用服务的过程可以看到，整个过程只拷贝了一次发送的数据和一次接收的数据。而正如开头所述，消息队列和管道这两种IPC拷贝次数为2次。</p></li></ol> <h5 id="_9-android中进程通讯方式有哪些"><a href="#_9-android中进程通讯方式有哪些" class="header-anchor">#</a> 9. Android中进程通讯方式有哪些？</h5> <p>Intent(Bundle)：四大组件通讯；</p> <p>AIDL：一对多进程通讯；</p> <p>Messenger： 基于AIDL，server只有一个线程；</p> <p>ContentProvider：数据源的增删改查(例如通讯录)；</p> <p>BroadcastReceiver:广播。</p> <h5 id="_10-view的绘制流程"><a href="#_10-view的绘制流程" class="header-anchor">#</a> 10. View的绘制流程？</h5> <p>参考案例分析</p> <h5 id="_11-事件传递流程"><a href="#_11-事件传递流程" class="header-anchor">#</a> 11. 事件传递流程？</h5> <p><a href="/Android/07面试题/android/100qaAndroid基础.html">查看</a></p> <p>1、Touch事件传递的相关API有dispatchTouchEvent、onTouchEvent、onInterceptTouchEvent；</p> <p>2、Touch事件相关的类有View、ViewGroup、Activity；</p> <p>3、Touch事件会被封装成MotionEvent对象，该对象封装了手势按下、移动、松开等动作；</p> <p>4、Touch事件通常从Activity#dispatchTouchEvent发出，只要没有被消费，会一直往下传递，到最底层的View；</p> <p>5、如果Touch事件传递到的每个View都不消费事件，那么Touch事件会反向向上传递,最终交由Activity#onTouchEvent处理；</p> <p>6、onInterceptTouchEvent为ViewGroup特有，可以拦截事件；</p> <p>7、Down事件到来时，如果一个View没有消费该事件，那么后续的MOVE/UP事件都不会再给它；</p> <p><img src="images/androideventhandler.jpg" alt="event_handler"></p> <p><a href="https://blog.csdn.net/hnlgzb/article/details/83653302" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="_12-anr是什么-如何避免anr"><a href="#_12-anr是什么-如何避免anr" class="header-anchor">#</a> 12. ANR是什么？如何避免ANR?</h5> <p>ANR:Application Not Responding，即应用无响应</p> <p>ANR一般有三种类型：</p> <p>1：KeyDispatchTimeout(5 seconds) –主要类型</p> <p>按键或触摸事件在特定时间内无响应</p> <p>2：BroadcastTimeout(10 seconds)</p> <p>BroadcastReceiver在特定时间内无法处理完成</p> <p>3：ServiceTimeout(20 seconds) –小概率类型</p> <p>​	Service在特定的时间内无法处理完成</p> <p>超时的原因一般有两种：</p> <p>(1)当前的事件没有机会得到处理（UI线程正在处理前一个事件没有及时完成或者looper被某种原因阻塞住）</p> <p>(2)当前的事件正在处理，但没有及时完成</p> <p>​	UI线程尽量只做跟UI相关的工作，耗时的工作（数据库操作，I/O，连接网络或者其他可能阻碍UI线程的操作）放入单独的线程处理，尽量用Handler来处理UI thread和thread之间的交互。</p> <p>UI线程主要包括如下：</p> <p>Activity:onCreate(), onResume(), onDestroy(), onKeyDown(), onClick()</p> <p>AsyncTask: onPreExecute(), onProgressUpdate(), onPostExecute(), onCancel()</p> <p>Mainthread handler: handleMessage(), post(runnable r) other</p> <h5 id="_13-内存泄漏及优化"><a href="#_13-内存泄漏及优化" class="header-anchor">#</a> 13. 内存泄漏及优化？</h5> <ul><li><p>内存泄漏和内存溢出区别？</p> <p>内存溢出OOM:当程序申请内存时，没有足够内存供其使用。比如integer类型中放long，就会内存溢出。</p> <p>内存泄漏：对象无法被回收。检查工具：leakCanary。</p></li> <li><p>内存泄漏原因：</p> <p>(1)Handler引起的内存泄漏(解决：静态内部类+弱引用)；</p> <p>(2)单例模式引起的内存泄漏(解决：用全局ApplicationContext代替ActivityContext)；</p> <p>(3)非静态内部类或匿名类引起的内存泄漏(解决：修改为静态内部类)；</p> <p>(4)注册/反注册未成对使用；(广播，eventbus等)；</p> <p>(5)资源对象没有关闭(close(),recycler())；</p> <p>(6)集合对象没有及时清理。</p></li></ul> <h5 id="_14-webview和js交互的三种调用方式"><a href="#_14-webview和js交互的三种调用方式" class="header-anchor">#</a> 14. webview和js交互的三种调用方式？</h5> <ul><li><p>1 Android原生交互方式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//1. JS调用native方法(4.2之后使用，不然存在安全漏洞)</span>
mWebView<span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JsInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;android&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;android&quot;是js那边调用Java方法时的一个“句柄”或者引用，跟h5约定好，可以写成别的。android.openUrlByBrowser()</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JsInterface</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@JavascriptInterface</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">backpage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>　　<span class="token comment">// 无返回值，无参</span>
            <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@JavascriptInterface</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openUrlByBrowser</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>　　<span class="token comment">// 无返回值，有参</span>
            <span class="token function">openBrowser</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@JavascriptInterface</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">haszhifubao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>　　<span class="token comment">// 有返回值</span>
            <span class="token keyword">return</span> <span class="token class-name">AppPackageChecked</span><span class="token punctuation">.</span><span class="token function">isExist</span><span class="token punctuation">(</span><span class="token class-name">WebShowActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;com.eg.android.AlipayGphone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token comment">//2. native调用js方法</span>
mWebView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:pauseVideo()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>　　<span class="token comment">// pauseVideo()是H5那边定义好的</span>
<span class="token comment">// android 4.4以上 才能使用</span>
buttonLeft<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                webView<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        webView<span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:callJS()&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ValueCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token annotation punctuation">@Override</span>
                            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceiveValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token comment">//将button显示的文字改成JS返回的字符串</span>
                                buttonLeft<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>2 拦截URL跳转方式方式</p> <p>通过 WebViewClient 的shouldOverrideUrlLoading ()方法回调拦截 url 。</p></li> <li><p>3 拦截Prompt提示框方法</p> <p>通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）方法回调拦截JS对话框alert()、confirm()、prompt（） 消息。</p></li></ul> <h5 id="_15-launcher原理"><a href="#_15-launcher原理" class="header-anchor">#</a> 15. Launcher原理？</h5> <p><a href="/Android/07面试题/android/100qaAndroid基础.html">查看</a></p> <p>Launcher进程、system_server进程、Zygote进程、App进程。</p> <h5 id="_16-window、activity、decorview、viewroot区别"><a href="#_16-window、activity、decorview、viewroot区别" class="header-anchor">#</a> 16. Window、Activity、DecorView、ViewRoot区别？</h5> <p>...案例分析</p> <p>Activity(attach)-&gt;PhoneWindow(包含)-&gt;DecorView对象-&gt;addView。</p> <h5 id="_17-performtraversals-执行至少2次问题"><a href="#_17-performtraversals-执行至少2次问题" class="header-anchor">#</a> 17. performTraversals 执行至少2次问题？</h5> <p>造成这个现象的根本原因是performTranversal函数在View的测量流程中会执行2次(与Surface是否存在有关)。</p> <ul><li><p>视图容器的ViewGroup宽高不是match_parent或具体数值时，都会对子view进行两次measure，layout.</p> <p>大家应该都知道，有些<code>ViewGroup</code>可能会让自己的子视图测量两次。比如说，父视图先让每个子视图自己测量，使用<code>View.MeasureSpec.UNSPECIFIED</code>，然后在根据每个子视图希望得到的大小不超过父视图的一些限制，就让子视图得到自己希望的大小，否则就用其他尺寸来重新测量子视图。这一类的视图有<code>FrameLayout</code>,<code>RelativeLayout</code>等。</p></li> <li><p>View初始化时的三次measure,两次layout却只一次draw吗？</p> <p>两次measure效率太低，android底层做了优化。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">measure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token comment">// 当FLAG_FORCE_LAYOUT位为１时，就是当前视图请求一次布局操作</span>
  <span class="token comment">//或者当前当前widthSpec和heightSpec不等于上次调用时传入的参数的时候</span>
  <span class="token comment">//才进行从新绘制。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>forceLayout <span class="token operator">||</span> <span class="token operator">!</span>matchingSize <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span>widthMeasureSpec <span class="token operator">!=</span> mOldWidthMeasureSpec <span class="token operator">||</span>
                    heightMeasureSpec <span class="token operator">!=</span> mOldHeightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token function">onMeasure</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h5 id="_18-listview-recycleview-区别"><a href="#_18-listview-recycleview-区别" class="header-anchor">#</a> 18. Listview recycleView 区别？</h5> <ul><li>封装了对viewholder的回收复用；</li> <li>可以同时实现线性布局、网格布局、瀑布流布局，完美替代Listview+GirdeView，更容易组合设计出自己的滑动布局；</li> <li>自带了itemAnimation，可以设置加载和移除时的动画。</li></ul> <h5 id="_19-relativelayout、linearlayout性能区别"><a href="#_19-relativelayout、linearlayout性能区别" class="header-anchor">#</a> 19. RelativeLayout、LinearLayout性能区别？</h5> <blockquote><p>影响布局性能有两个因素，1. 层级深度 2. 选择RL或LL。</p> <p>重要性： 1 &gt; 2。</p></blockquote> <p>相同的层级深度下，两个布局的性能差别在measure，RL&gt;LL。</p> <p>**原因：**RL内的子View会进行两次onMeasure，分别是横向和纵向的； LL分两种情况，如果没有weight，就只关心orientation，子view测量一次，如果有weight，子view测量两次；分别是先orientation，再是weight。</p> <p>**例子：**相同的布局，一个RelativeLayout可以完成，但是要使用多个LinearLayout，肯定使用Relativelayout的，尽管会子view会测量两次，但是也比使用多个LinearLayout性能好多了。</p> <h5 id="_20-convertview和viewholder的理解"><a href="#_20-convertview和viewholder的理解" class="header-anchor">#</a> 20. convertView和ViewHolder的理解？</h5> <p>RecycleBin机制。</p> <ul><li><p>convertView 是作为缓存的view，通过使用这个缓存减少inflater加载组件这一步；</p></li> <li><p>viewHolder中持有的组件和convertView中的组件指向同一对象，所有这里使用viewholder就是替换掉findViewById,防止多次调用。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getView</span><span class="token punctuation">(</span>finalint position<span class="token punctuation">,</span> <span class="token class-name">View</span> convertView<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ViewHolder</span> holder<span class="token punctuation">;</span>
  <span class="token comment">//观察convertView随ListView滚动情况             </span>
  <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;MyListViewBase&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;getView &quot;</span> <span class="token operator">+</span> position <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> convertView<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>convertView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    convertView <span class="token operator">=</span> mInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**得到各个控件的对象*/</span>                     
    holder<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>ItemTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    holder<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>ItemText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    holder<span class="token punctuation">.</span>bt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>ItemButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
    convertView<span class="token punctuation">.</span><span class="token function">setTag</span><span class="token punctuation">(</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//绑定ViewHolder对象                    </span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span><span class="token punctuation">{</span>
    holder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ViewHolder</span><span class="token punctuation">)</span>convertView<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//取出ViewHolder对象                   </span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**设置TextView显示的内容，即我们存放在动态数组中的数据*/</span>             
  holder<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ItemTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  holder<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ItemText&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> convertView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h5 id="_21-硬件加速原理"><a href="#_21-硬件加速原理" class="header-anchor">#</a> 21. 硬件加速原理？</h5> <p>对于App开发者，简单了解硬件加速原理及上层API实现，开发时就可以充分利用硬件加速提高页面的性能。以Android举例，实现一个圆角矩形按钮通常有两种方案：使用PNG图片；使用代码（XML/Java）实现。简单对比两种方案如下。</p> <table><thead><tr><th>方案</th> <th>原理</th> <th>特点</th></tr></thead> <tbody><tr><td>使用PNG图片</td> <td>解码png生成bitmap，传递到底层，由GPU渲染</td> <td>图片解码消耗CPU运算资源，Bitmap占用内存大，绘制慢</td></tr> <tr><td>使用xml或java</td> <td>直接将Shape信息传递到底层，有GPU渲染</td> <td>消耗cpu资源少，占用内存小，绘制块</td></tr></tbody></table> <ul><li><p>CPU更擅长复杂逻辑控制，而GPU得益于大量ALU和并行结构设计，更擅长数学运算。</p></li> <li><p>页面由各种基础元素（DisplayList）构成，渲染时需要进行大量浮点运算。</p></li> <li><p>硬件加速条件下，CPU用于控制复杂绘制逻辑、构建或更新DisplayList；GPU用于完成图形计算、渲染DisplayList。</p></li> <li><p>硬件加速条件下，刷新界面尤其是播放动画时，CPU只重建或更新必要的DisplayList，进一步提高渲染效率。</p></li></ul> <p>实现同样效果，应尽量使用更简单的DisplayList，从而达到更好的性能（Shape代替Bitmap等）。</p> <h3 id="_1-基础机制"><a href="#_1-基础机制" class="header-anchor">#</a> 1. 基础机制</h3> <h4 id="_1-binder机制"><a href="#_1-binder机制" class="header-anchor">#</a> 1. Binder机制</h4> <p>​	binder是什么？来自哪里？</p> <p>​	传统IPC机制方式和缺点？binder原理和优势？</p> <h4 id="_2-launcher启动过程"><a href="#_2-launcher启动过程" class="header-anchor">#</a> 2. Launcher启动过程</h4> <p>​	什么是Launcher？启动过程？</p> <p>​	包含：linux三大进程；AMS、PMS；<code>&lt;category android:name=&quot;android.intent.category.Home&quot;&gt;</code>属性。</p> <h3 id="_2-线程"><a href="#_2-线程" class="header-anchor">#</a> 2. 线程</h3> <h4 id="_1-为什么android中要设计成只能在ui线程更新ui呢"><a href="#_1-为什么android中要设计成只能在ui线程更新ui呢" class="header-anchor">#</a> 1.  为什么Android中要设计成只能在UI线程更新UI呢？</h4> <p>​	根本原因：为了达到流畅的用户体验，在16ms内完成一帧的绘制(刷新频率60HZ)。</p> <p>​	单线程访问好处：</p> <div class="language- extra-class"><pre><code>1. 多线程设计复杂，并发问题难处理(加锁和同时更新UI不可控)，更新性能很难达到；

2. 单线程架构设计简单，提高界面更新性能问题；
3. Android的UI控件不是**线程安全**的，如果在多线程中并发访问可能会导致UI控件处于不可预期的状态。
</code></pre></div><h4 id="_2-主线程和ui线程区别"><a href="#_2-主线程和ui线程区别" class="header-anchor">#</a> 2. 主线程和UI线程区别？</h4> <p>​	ActivityThread的main函数是app的入口方法，也叫主线程；</p> <p>​	UI线程是View绘制和刷新所在的线程，即ViewRootImpl创建算在的线程。</p> <p>​	通常情况下，我们一般认为Main Thread就是UIThread。更确切的说，UIThread是<strong>创建View所在的线程</strong>，否则会报错<code>Only the original thread that created a view hierarchy can touch its views.</code></p> <h4 id="_3-非ui线程真的不能刷新ui吗"><a href="#_3-非ui线程真的不能刷新ui吗" class="header-anchor">#</a> 3. 非UI线程真的不能刷新UI吗？</h4> <p>​	答：不一定，之所以子线程不能更新界面，是因为Android在线程的方法里面采用checkThread进行判断是否是主线程，而这个方法是在ViewRootImpl中的，这个类是在onResume里面才生成的，因此，如果这个时候子线程在onCreate方法里面生成更新UI，而且没有做阻塞，就是耗时多的操作，还是可以更新UI的。</p> <h4 id="_4-surfaceview为什么可以在子线程绘制呢"><a href="#_4-surfaceview为什么可以在子线程绘制呢" class="header-anchor">#</a> 4. SurfaceView为什么可以在子线程绘制呢？</h4> <p>​	窗口中的view共享一个window，window又对应一个Surface，所以窗口中的view共享一个Surface。他的绘制操作，最终都会调用到ViewRootImpl，那么这个就会被检查是否主线程了，所以只要在ViewRootImpl启动后，访问UI的所有操作都不可以在子线程中进行。</p> <p>​	而SurfaceView本身就自带一个Surface，使用双缓存机制，与主线程和Window窗口是分离的，容易实现子线程访问(一般出现在游戏或被动更新功能中)。</p> <h3 id="_3-handler"><a href="#_3-handler" class="header-anchor">#</a> 3. Handler</h3> <h4 id="_1-谈谈handler机制"><a href="#_1-谈谈handler机制" class="header-anchor">#</a> 1. 谈谈Handler机制？</h4> <ol><li><p>作用</p> <p>跨线程通信，因为子线程不能操作UI。</p></li> <li><p>组成</p> <p>Message(消息)、MessageQueue(消息队列)、Handler(消息处理器)、Looper(消息池)。</p> <p>组成比例(1个线程)：Thread(1):Looper(1):MessageQueue(1):Handler(N)。</p></li> <li><p>流程</p> <p>​	主线程创建的时候会创建一个Looper，同时在Looper内部创建一个消息队列。而创建Handler的时候会取出当前线程的Looper和消息队列，然后Handler在子线程通过<strong>MessageQueue.equeueMessage</strong>在消息队列中添加一条Message；</p> <p>​	通过<strong>Looper.looper()<strong>开启的消息循环会不断调用</strong>MessageQueue.next()</strong>，无消息时会阻塞。取得对应的Message并且通过<strong>Handler.dispatchMessage</strong>传递给Handler，最终调用Handler.handlerMessage处理消息。</p></li></ol> <h4 id="_2-hander引起的内存泄漏如何处理"><a href="#_2-hander引起的内存泄漏如何处理" class="header-anchor">#</a> 2. Hander引起的内存泄漏如何处理？</h4> <ol><li><p>泄漏原因</p> <p><strong>非静态内部类默认持有外部类的引用。</strong></p> <p>当用户关闭activity时，Hander持有activity的引用，导致activity泄漏。</p></li> <li><p>解决方法</p> <p>将Handler定义为静态内部类，在内部类持有Activity的弱引用，并在onDestory中调用<strong>handler.removeMessages</strong>。</p></li></ol> <h4 id="_3-looper死循环为什么不会导致anr"><a href="#_3-looper死循环为什么不会导致anr" class="header-anchor">#</a> 3. Looper死循环为什么不会导致ANR?</h4> <p>​	ANR发生条件：消息没有及时处理、消息处理事件过长。</p> <p>​	而阻塞是没有消息时发生的，不符合ANR条件。<strong>主线程就任务就是处理各种消息，没有消息就会阻塞等待。</strong></p> <h4 id="_4-message如何存储"><a href="#_4-message如何存储" class="header-anchor">#</a> 4. Message如何存储？</h4> <p>​	按时间顺序的单链表结构存储，最近时间在链表头。其他时间Message会遍历插入链表对应位置。</p> <h4 id="_5-子线程如何使用hander"><a href="#_5-子线程如何使用hander" class="header-anchor">#</a> 5. 子线程如何使用Hander?</h4> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
            <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1. 创建looper和消息队里(绑定当前线程)</span>
            val handler <span class="token operator">=</span> object <span class="token operator">:</span><span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//2. handler</span>
                override fun <span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token class-name">Message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 3. 循环处理消息</span>
            <span class="token comment">//4. 上面阻塞了，永远不会执行到这里。  </span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_6-message如何创建效果好"><a href="#_6-message如何创建效果好" class="header-anchor">#</a> 6. Message如何创建效果好？</h4> <ol><li><p>直接生成 <code>Message m = new Message()</code>;</p></li> <li><p>通过<code>Message m = Message.obtain()</code>;</p></li> <li><p>通过<code>Message m = mHander.obtainMessage()</code>，内部调用2方法;</p> <p>后两者效果更好，因为Android默认的消息池中消息数量是50(对象池，链表实现)，而后两者是直接在消息池中取出一个Message实例，这样做就可以避免多生成Message实例。</p></li></ol> <h4 id="_7-handlerthread干嘛用的"><a href="#_7-handlerthread干嘛用的" class="header-anchor">#</a> 7. HandlerThread干嘛用的？</h4> <p>​	是google提供的一个带looper的线程，方便与线程通信(UI消息的简单实现)。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mTid <span class="token operator">=</span> <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">myTid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mLooper <span class="token operator">=</span> <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">myLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">setThreadPriority</span><span class="token punctuation">(</span>mPriority<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onLooperPrepared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mTid <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 外界调用</span>
<span class="token class-name">Handler</span> mThreadHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span>handlerThread<span class="token punctuation">.</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入loop</span>
</code></pre></div><h4 id="_8-handler-postdealy-实现和消息阻塞的深层机制"><a href="#_8-handler-postdealy-实现和消息阻塞的深层机制" class="header-anchor">#</a> 8. Handler.postDealy()实现和消息阻塞的深层机制？</h4> <blockquote><p>IO事件：输入输出(input/output)的对象可以是文件(file)， 网络(socket)，进程之间的管道(pipe)。在linux系统中，都用文件描述符(fd)来表示。</p></blockquote> <ol><li>根据Message时间先后将消息插入Message链表；</li> <li>无限循环计算当前Message是否立即执行(when)，如果没到执行时间，调用<code>nativePollOnce(ptr, nextPollTimeoutMillis);</code>阻塞消息队列，等待系统到时间自动唤醒执行；</li> <li>如果阻塞期间有新消息过来，如果需要立即执行，就立即执行；如果没到时间，插入到前面，然后重新计算阻塞队列唤醒时间；</li> <li>一个消息执行完毕，自动再进行下一次唤醒时间计算，然后阻塞。</li></ol> <p>epoll机制：epoll是Linux内核为处理大批量<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6/9809582" target="_blank" rel="noopener noreferrer">文件描述符<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>而作了改进的poll，是Linux下多路复用IO接口select/poll的增强版本，它能显著提高程序在大量<a href="https://baike.baidu.com/item/%E5%B9%B6%E5%8F%91%E8%BF%9E%E6%8E%A5/3763280" target="_blank" rel="noopener noreferrer">并发连接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中只有少量活跃的情况下的系统CPU利用率。</p> <ul><li><p><code>select</code> 和 <code>poll</code> 监听文件描述符list，进行一个线性的查找 O(n)</p></li> <li><p><code>epoll</code>: 使用了内核文件级别的回调机制O(1)</p> <p>epoll高效的本质在于：</p> <p>减少了用户态和内核态的文件句柄拷贝</p> <p>减少了对可读可写文件句柄的遍历</p> <p>mmap 加速了内核与用户空间的信息传递，epoll是通过内核与用户mmap同一块内存，避免了无谓的内存拷贝</p> <p>IO性能不会随着监听的文件描述的数量增长而下降</p> <p>使用红黑树存储fd，以及对应的回调函数，其插入，查找，删除的性能不错，相比于hash，不必预先分配很多的空间</p> <h4 id="_9-native-looper"><a href="#_9-native-looper" class="header-anchor">#</a> 9. Native Looper?</h4> <ol><li><p>目的</p> <p>Native Loope主要配合Java looper 实现线程通信机制。</p></li> <li><p>实现</p> <p>​	整个的结构很简单，JAVA Looper包含一个MessageQueue，MessageQueue对应的Native 实例是一个NativeMessageQueue实例，NativeMessageQueue在创建的时候生成一个Native Looper。  <strong>其实Native Looper存在的意义就是作为JAVA Looper机制的开关器。</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MessageQueue</span> <span class="token punctuation">{</span>
	 <span class="token keyword">private</span> <span class="token keyword">long</span> mPtr<span class="token punctuation">;</span> <span class="token comment">// 本地消息队列指针</span>
	 <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">nativeInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">nativeDestroy</span><span class="token punctuation">(</span><span class="token keyword">long</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">nativePollOnce</span><span class="token punctuation">(</span><span class="token keyword">long</span> ptr<span class="token punctuation">,</span> <span class="token keyword">int</span> timeoutMillis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是否block </span>
   <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">nativeWake</span><span class="token punctuation">(</span><span class="token keyword">long</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 唤醒本地线程</span>
   <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">nativeIsPolling</span><span class="token punctuation">(</span><span class="token keyword">long</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">nativeSetFileDescriptorEvents</span><span class="token punctuation">(</span><span class="token keyword">long</span> ptr<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">int</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
<span class="token comment">// C++</span>
<span class="token class-name">NativeMessageQueue</span><span class="token operator">::</span><span class="token class-name">NativeMessageQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    mLooper <span class="token operator">=</span> <span class="token class-name">Looper</span><span class="token operator">::</span><span class="token function">getForThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mLooper <span class="token operator">==</span> NULL<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        mLooper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Looper</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token class-name">Looper</span><span class="token operator">::</span><span class="token function">setForThread</span><span class="token punctuation">(</span>mLooper<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
</code></pre></div><p>两种情况：</p> <p>​	当添加Message时，会唤醒本地线程，调用nativewake函数；</p> <p>​	当消息队列为空时，调用nativePollOnce阻塞本地线程。</p></li> <li><p>。。</p></li></ol></li></ul> <h3 id="_4-view"><a href="#_4-view" class="header-anchor">#</a> 4. View</h3> <h4 id="_1-activity、window、view关系"><a href="#_1-activity、window、view关系" class="header-anchor">#</a> 1. Activity、Window、View关系？</h4> <h3 id="_5-性能优化"><a href="#_5-性能优化" class="header-anchor">#</a> 5. 性能优化</h3> <h3 id="_6-架构"><a href="#_6-架构" class="header-anchor">#</a> 6. 架构</h3> <h4 id="_1-说说你对软件架构的理解"><a href="#_1-说说你对软件架构的理解" class="header-anchor">#</a> 1. 说说你对软件架构的理解？</h4> <ol><li><p>软件架构的本质、设计三原则；</p></li> <li><p>架构设计思想和方法(solid/分离关注点/依赖注入/面向切面)；</p></li> <li><p>android架构的发展。</p> <p><a href="https://zhuanlan.zhihu.com/p/66535377" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol> <h3 id="_7-开源"><a href="#_7-开源" class="header-anchor">#</a> 7. 开源</h3> <h4 id="_1-glide"><a href="#_1-glide" class="header-anchor">#</a> 1. Glide</h4> <h4 id="_2-retrofit"><a href="#_2-retrofit" class="header-anchor">#</a> 2. Retrofit</h4> <ol><li><p>如何与UI线程通信的？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Android</span> <span class="token keyword">extends</span> <span class="token class-name">Platform</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">Executor</span> <span class="token function">defaultCallbackExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MainThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Override</span> <span class="token class-name">CallAdapter<span class="token punctuation">.</span>Factory</span> <span class="token function">defaultCallAdapterFactory</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> callbackExecutor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorCallAdapterFactory</span><span class="token punctuation">(</span>callbackExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MainThreadExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
  <span class="token comment">//!!! 通过建立绑定UI线程Looper的Hander实现。</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Handler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>...</p></li></ol> <h3 id="_8-加载图片问题"><a href="#_8-加载图片问题" class="header-anchor">#</a> 8. 加载图片问题</h3> <h4 id="_1-基础知识"><a href="#_1-基础知识" class="header-anchor">#</a> 1. 基础知识</h4> <ul><li><p>一张图片加载到内存大小</p> <p>图片内存大小 = 图片宽度 * 图片高度 * 一个像素字节数(4)</p> <p>利用一个1000*1000像素的图片，默认加载后大小为4M。</p></li> <li><p>一个像素所占字节数</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Bitmap<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span>RGB_565<span class="token punctuation">;</span> <span class="token comment">// Glide用2字节</span>
<span class="token class-name">Bitmap<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span>RGB_888<span class="token punctuation">;</span> <span class="token comment">// 默认4字节</span>
</code></pre></div></li> <li><p>图片压缩方法</p> <p>质量压缩、采样率压缩。</p></li></ul> <h4 id="_2-加载大图"><a href="#_2-加载大图" class="header-anchor">#</a> 2. 加载大图</h4> <p>缩放大图宽高</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//1. 仅仅获取图片宽高</span>
<span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
options<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>bigpicture<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> outHeight <span class="token operator">=</span> options<span class="token punctuation">.</span>outHeight<span class="token punctuation">;</span>
<span class="token keyword">int</span> outWidth <span class="token operator">=</span> options<span class="token punctuation">.</span>outWidth<span class="token punctuation">;</span>
<span class="token comment">//2. 计算缩放参数</span>
options<span class="token punctuation">.</span>inSampleSize <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 缩小一倍</span>
</code></pre></div><h4 id="_3-展示巨图局部"><a href="#_3-展示巨图局部" class="header-anchor">#</a> 3. 展示巨图局部</h4> <p>通过<code>BitmapRegionDecoder</code>只读取对应显示矩形框图大小。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token string">&quot;bigpicture.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BitmapRegionDecoder</span> regionDecoder <span class="token operator">=</span> <span class="token class-name">BitmapRegionDecoder</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> measuredHeight <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> measuredWidth <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Rect</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> measuredWidth<span class="token punctuation">,</span> measuredHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> regionDecoder<span class="token punctuation">.</span><span class="token function">decodeRegion</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            view<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="_4-滑动显示巨图"><a href="#_4-滑动显示巨图" class="header-anchor">#</a> 4. 滑动显示巨图</h4> <p>同上，通过移动距离 动态调整矩形框大小。</p> <ol><li>在 onMeasure 中拿到测量后的大小，设置给 Rect</li> <li>在 onTouchEvent() 方法中，计算滑动的距离，然后设置给 Rect</li> <li>设置了新的显示区域以后，调用 invalidate() 方法， 请求绘制，这时候会调用 onDraw() 方法</li> <li>在 onDraw() 方法中根据 Rect 拿到需要显示的局部 Bitmap， 通过 Canvas 绘制回来。</li></ol> <h4 id="_5-缩放移动地图-zoom-pan"><a href="#_5-缩放移动地图-zoom-pan" class="header-anchor">#</a> 5. 缩放移动地图(zoom pan)</h4> <p><strong>要点：</strong></p> <ul><li>实现View，重写measure，layout，draw过程</li> <li>将整个Bitmap分割成很多方块</li> <li>使用BitmapRegionDecoder来区间加载这些小的Bitmap，铺满整个屏幕</li> <li>以屏幕的左上角为原点，用户移动的时候，控制图片的Translate,映射Bitmap内容到屏幕上去</li></ul> <p><a href="https://github.com/davemorrissey/subsampling-scale-image-view" target="_blank" rel="noopener noreferrer">参考 subsampling-scale-image-view<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>引用</li></ul> <p><a href="https://github.com/yangchong211/YCBlogs" target="_blank" rel="noopener noreferrer">参考1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5c81db916fb9a049d37fe6a1" target="_blank" rel="noopener noreferrer">参考2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/gatieme/CodingInterviews" target="_blank" rel="noopener noreferrer">参考3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.154db40d.js" defer></script><script src="/assets/js/2.c485b593.js" defer></script><script src="/assets/js/83.bb518bb6.js" defer></script>
  </body>
</html>
