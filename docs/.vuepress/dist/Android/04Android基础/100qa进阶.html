<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android进阶 | 知鱼之乐@Android</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Just playing around 1">
    
    <link rel="preload" href="/assets/css/0.styles.fab77d47.css" as="style"><link rel="preload" href="/assets/js/app.fc57e022.js" as="script"><link rel="preload" href="/assets/js/2.a8c6c3ae.js" as="script"><link rel="preload" href="/assets/js/43.b807463f.js" as="script"><link rel="prefetch" href="/assets/js/10.1f0b4cf4.js"><link rel="prefetch" href="/assets/js/100.a8dab1a2.js"><link rel="prefetch" href="/assets/js/101.aed67765.js"><link rel="prefetch" href="/assets/js/102.31e4829d.js"><link rel="prefetch" href="/assets/js/103.b84e3b94.js"><link rel="prefetch" href="/assets/js/104.0abcb0ed.js"><link rel="prefetch" href="/assets/js/105.2b1efd12.js"><link rel="prefetch" href="/assets/js/106.ca343c2b.js"><link rel="prefetch" href="/assets/js/107.0e1aaf70.js"><link rel="prefetch" href="/assets/js/108.bcbe1496.js"><link rel="prefetch" href="/assets/js/109.f2e58033.js"><link rel="prefetch" href="/assets/js/11.3b5d4d9d.js"><link rel="prefetch" href="/assets/js/110.dca83119.js"><link rel="prefetch" href="/assets/js/111.1bf4c2bb.js"><link rel="prefetch" href="/assets/js/112.d27bf211.js"><link rel="prefetch" href="/assets/js/113.fe77b001.js"><link rel="prefetch" href="/assets/js/114.3e90742f.js"><link rel="prefetch" href="/assets/js/115.f06c8502.js"><link rel="prefetch" href="/assets/js/116.f249f2f6.js"><link rel="prefetch" href="/assets/js/117.9c9e3266.js"><link rel="prefetch" href="/assets/js/118.585552a4.js"><link rel="prefetch" href="/assets/js/119.6fd28d8c.js"><link rel="prefetch" href="/assets/js/12.8483cbcc.js"><link rel="prefetch" href="/assets/js/13.9a0c00e0.js"><link rel="prefetch" href="/assets/js/14.fc54f0bc.js"><link rel="prefetch" href="/assets/js/15.0bdd8246.js"><link rel="prefetch" href="/assets/js/16.4955e533.js"><link rel="prefetch" href="/assets/js/17.7c49eeb3.js"><link rel="prefetch" href="/assets/js/18.e9655f93.js"><link rel="prefetch" href="/assets/js/19.aba98f0e.js"><link rel="prefetch" href="/assets/js/20.a663dfab.js"><link rel="prefetch" href="/assets/js/21.70be6b04.js"><link rel="prefetch" href="/assets/js/22.7dfb9f5a.js"><link rel="prefetch" href="/assets/js/23.2094fa32.js"><link rel="prefetch" href="/assets/js/24.505d35c8.js"><link rel="prefetch" href="/assets/js/25.490bc59a.js"><link rel="prefetch" href="/assets/js/26.53c05b33.js"><link rel="prefetch" href="/assets/js/27.198828b7.js"><link rel="prefetch" href="/assets/js/28.4706c105.js"><link rel="prefetch" href="/assets/js/29.894c0ad0.js"><link rel="prefetch" href="/assets/js/3.024d7a3e.js"><link rel="prefetch" href="/assets/js/30.2d82fef6.js"><link rel="prefetch" href="/assets/js/31.a37622a3.js"><link rel="prefetch" href="/assets/js/32.c9292e8d.js"><link rel="prefetch" href="/assets/js/33.e8e5ec21.js"><link rel="prefetch" href="/assets/js/34.3b67fe72.js"><link rel="prefetch" href="/assets/js/35.3d267609.js"><link rel="prefetch" href="/assets/js/36.8bfcd8bd.js"><link rel="prefetch" href="/assets/js/37.32a3bbc5.js"><link rel="prefetch" href="/assets/js/38.460433c9.js"><link rel="prefetch" href="/assets/js/39.4e8803a4.js"><link rel="prefetch" href="/assets/js/4.e465ce45.js"><link rel="prefetch" href="/assets/js/40.814a2790.js"><link rel="prefetch" href="/assets/js/41.e91c05fe.js"><link rel="prefetch" href="/assets/js/42.7aee18ea.js"><link rel="prefetch" href="/assets/js/44.0dd75758.js"><link rel="prefetch" href="/assets/js/45.172d766d.js"><link rel="prefetch" href="/assets/js/46.3efe575d.js"><link rel="prefetch" href="/assets/js/47.80f31f9f.js"><link rel="prefetch" href="/assets/js/48.a86f2753.js"><link rel="prefetch" href="/assets/js/49.466c0d9e.js"><link rel="prefetch" href="/assets/js/5.19e860bb.js"><link rel="prefetch" href="/assets/js/50.87e4b15b.js"><link rel="prefetch" href="/assets/js/51.029ae25a.js"><link rel="prefetch" href="/assets/js/52.0e581e9f.js"><link rel="prefetch" href="/assets/js/53.1e5f9e2c.js"><link rel="prefetch" href="/assets/js/54.2b5b61b4.js"><link rel="prefetch" href="/assets/js/55.8aae53fb.js"><link rel="prefetch" href="/assets/js/56.808353f6.js"><link rel="prefetch" href="/assets/js/57.43f3f7f0.js"><link rel="prefetch" href="/assets/js/58.839639ab.js"><link rel="prefetch" href="/assets/js/59.9782d5b0.js"><link rel="prefetch" href="/assets/js/6.f4100330.js"><link rel="prefetch" href="/assets/js/60.79bf5e30.js"><link rel="prefetch" href="/assets/js/61.e76d4646.js"><link rel="prefetch" href="/assets/js/62.ebe40240.js"><link rel="prefetch" href="/assets/js/63.8d04f05e.js"><link rel="prefetch" href="/assets/js/64.eb42f05d.js"><link rel="prefetch" href="/assets/js/65.0c100fe9.js"><link rel="prefetch" href="/assets/js/66.0c985612.js"><link rel="prefetch" href="/assets/js/67.d987014f.js"><link rel="prefetch" href="/assets/js/68.02a03b99.js"><link rel="prefetch" href="/assets/js/69.732c8bba.js"><link rel="prefetch" href="/assets/js/7.50e53555.js"><link rel="prefetch" href="/assets/js/70.a5ed6d0f.js"><link rel="prefetch" href="/assets/js/71.7b2360c4.js"><link rel="prefetch" href="/assets/js/72.cc2d252c.js"><link rel="prefetch" href="/assets/js/73.880477c8.js"><link rel="prefetch" href="/assets/js/74.8f437293.js"><link rel="prefetch" href="/assets/js/75.d828f38b.js"><link rel="prefetch" href="/assets/js/76.df328550.js"><link rel="prefetch" href="/assets/js/77.1702435f.js"><link rel="prefetch" href="/assets/js/78.390418a2.js"><link rel="prefetch" href="/assets/js/79.61a0689c.js"><link rel="prefetch" href="/assets/js/8.5eed9a57.js"><link rel="prefetch" href="/assets/js/80.4f2b2e40.js"><link rel="prefetch" href="/assets/js/81.f21e3404.js"><link rel="prefetch" href="/assets/js/82.0ce11abf.js"><link rel="prefetch" href="/assets/js/83.70856362.js"><link rel="prefetch" href="/assets/js/84.f1570cca.js"><link rel="prefetch" href="/assets/js/85.68ef1379.js"><link rel="prefetch" href="/assets/js/86.54990a22.js"><link rel="prefetch" href="/assets/js/87.63b0353b.js"><link rel="prefetch" href="/assets/js/88.c3bdd28c.js"><link rel="prefetch" href="/assets/js/89.86f7c8ab.js"><link rel="prefetch" href="/assets/js/9.83e89ef4.js"><link rel="prefetch" href="/assets/js/90.907c0b0d.js"><link rel="prefetch" href="/assets/js/91.892fd2e3.js"><link rel="prefetch" href="/assets/js/92.5512365b.js"><link rel="prefetch" href="/assets/js/93.86b0c0a7.js"><link rel="prefetch" href="/assets/js/94.3b3989f8.js"><link rel="prefetch" href="/assets/js/95.71c7db4d.js"><link rel="prefetch" href="/assets/js/96.da562058.js"><link rel="prefetch" href="/assets/js/97.08808c5f.js"><link rel="prefetch" href="/assets/js/98.064887d6.js"><link rel="prefetch" href="/assets/js/99.203d8e27.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fab77d47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">知鱼之乐@Android</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Android/01基础机制/1.Android系统启动流程.html" class="sidebar-link">Android系统启动过程</a></li><li><a href="/Android/01基础机制/2.Binder进程通信机制.html" class="sidebar-link">Binder进程通信机制</a></li><li><a href="/Android/07面试题/1.面试题-计算机基础.html" class="sidebar-link">1面试题-计算机基础</a></li><li><a href="/Android/07面试题/2.面试题-Android.html" class="sidebar-link">2面试题-Android</a></li><li><a href="/Android/07面试题/3.面试题-架构设计.html" class="sidebar-link">3面试题-架构设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>操作系统等</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/操作系统等/C编译原理.html" class="sidebar-link">C++编译原理</a></li><li><a href="/操作系统等/Linux常用操作手册.html" class="sidebar-link">Linux操作手册</a></li><li><a href="/操作系统等/IOS.html" class="sidebar-link">IOS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Tools/1.Mac开发快捷键大全.html" class="sidebar-link">Mac开发快捷键大全</a></li><li><a href="/Tools/2.翻墙工具指南.html" class="sidebar-link">翻墙工具指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>投名状</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ppt/警世通言.html" class="sidebar-link">警世通言</a></li><li><a href="/ppt/1.阿里技术合伙人.html" class="sidebar-link">阿里技术</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="android进阶"><a href="#android进阶" class="header-anchor">#</a> Android进阶</h3> <p>[TOC]</p> <blockquote><p>Android 知识总结。</p></blockquote> <h4 id="_1-性能优化"><a href="#_1-性能优化" class="header-anchor">#</a> 1. 性能优化</h4> <p><a href="https://www.cnblogs.com/lixiansheng/p/11382341.html" target="_blank" rel="noopener noreferrer">参考1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="_1布局优化"><a href="#_1布局优化" class="header-anchor">#</a> 1布局优化</h5> <p>(1) 删除布局中无用的控件和层次，选择性能较低的ViewGroup。如：层级相同情况下：RL &gt; LL。</p> <p>(2) 采用ViewStub、include、merge标签：</p> <ul><li><include></include> 标签 提高布局的复用性；</li> <li><ViewStub></ViewStub> 标签 延迟加载；原理是 加载了一个宽高都为0的View，默认是不可见的。只能通过setVisibilty或inflate函数才能加载目标布局；
</li> <li><Merge></Merge> 标签 直接将子元素加载到parent布局(其实就是减少include的层级)。
</li></ul> <p>(3) 避免过度绘制</p> <p>​	Overdraw是指屏幕上一个像素点绘制了多次，多个控件叠加。</p> <p>​	查看方法： 开发者选项-&gt;调试GPU过度绘制；</p> <p>​	解决办法：1. 移除Window默认的backgroup(背景色处理) 2. 减少布局嵌套和view深度。</p> <h5 id="_2绘制优化"><a href="#_2绘制优化" class="header-anchor">#</a> 2绘制优化</h5> <p>Android系统每隔16ms发出VSYNC信号，触发对UI进行渲染，如果每次渲染都成功，这样就能够达到流畅的画面所需要的60fps，为了能够实现60fps，这意味着程序的大多数操作都必须在16ms内完成。</p> <ul><li>onDraw中不要创建新的局部对象；</li> <li>onDraw中不要做耗时任务，也不能有大量循环。</li></ul> <h5 id="_3内存泄漏"><a href="#_3内存泄漏" class="header-anchor">#</a> 3内存泄漏</h5> <p>优化方面：</p> <ol><li>在开发过程中避免写出内存泄漏的代码；</li> <li>通过一些分析工具比如MAT、LeakCanary来找出潜在的内存泄漏，然后解决；</li></ol> <p>内存泄漏种类：</p> <ol><li>集合类内存泄漏；</li> <li>单例/静态变量造成的内存泄漏；</li> <li>匿名内部类/非静态内部类；(例如Handler使用)</li> <li>资源未关闭；</li></ol> <h5 id="_4响应速度"><a href="#_4响应速度" class="header-anchor">#</a> 4响应速度</h5> <p>响应速度优化的核心思想就是避免在主线程中做耗时操作。</p> <p>Activity 5s、BoradcastReceiver 10s内未完成报ANR。</p> <h5 id="_5线程优化"><a href="#_5线程优化" class="header-anchor">#</a> 5线程优化</h5> <p>线程优化的思想就是采用线程池，避免程序中存在大量的Thread。</p> <h5 id="_6listview-recycleview-bitmap优化"><a href="#_6listview-recycleview-bitmap优化" class="header-anchor">#</a> 6ListView/RecycleView/Bitmap优化</h5> <ol><li>使用ViewHolder模式提示效率；</li> <li>耗时操作异步加载(如图片加载和设置缓存);</li> <li>分页加载或滑动停止时加载；</li> <li><strong>对图片进行压缩或缓存</strong>。</li></ol> <h5 id="_7其他"><a href="#_7其他" class="header-anchor">#</a> 7其他</h5> <ol><li>避免过度创建对象；</li> <li>不要使用枚举；</li> <li>常量请使用static final来修饰；</li> <li>使用一些Android特有的数据结构，比如SparseArray和Pair等</li> <li>适当采用软引用和弱引用；</li> <li>采用内存缓存和磁盘缓存；</li> <li>尽量使用静态内部类；</li></ol> <h4 id="_2-框架"><a href="#_2-框架" class="header-anchor">#</a> 2.框架</h4> <p><a href="https://blog.csdn.net/smile_Running/article/details/94724540" target="_blank" rel="noopener noreferrer">参考1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="_1-目录结构"><a href="#_1-目录结构" class="header-anchor">#</a> 1. 目录结构</h5> <p><strong>base</strong>存放app的基类</p> <p><strong>common</strong>存放一些常量,接口,公用的东西</p> <p><strong>contract</strong>连接V层和P层的一个契约包</p> <p><strong>model</strong>M层,数据库,网络请求,服务等业务操作</p> <p><strong>presenter</strong>P层,负责连接V层和M层,中心管理器</p> <p><strong>ui</strong>V层,负责UI的展示</p> <p><strong>utils</strong>存放工具类</p> <p><strong>widget</strong>存放自定义的一些组件</p> <h5 id="_2-mvp"><a href="#_2-mvp" class="header-anchor">#</a> 2. MVP</h5> <blockquote><p>model（模型），负责访问网络数据、访问数据库数据，提供数据源</p> <p>view（视图），负责更新界面、响应用户界面操作</p> <p>controller（控制器），负责业务逻辑控制，处理数据</p></blockquote> <ul><li><p>好处</p> <p><code>易于维护</code>，<code>易于测试</code>，<code>松耦合</code>，<code>复用性高</code></p> <p>分离了视图逻辑和业务逻辑，降低了耦合；</p> <p>Activity只处理声明周期的任务，代码更加简洁；</p> <p>视图逻辑和业务逻辑分别抽象到了View和Presenter的接口中，提高代码的阅读性。</p> <p>Presenter被抽象成接口，可以有多种具体的实现，所以方便进行单元测试。</p></li> <li><p>缺点</p> <p>(1)activity 内存泄漏</p> <p><code>解决办法就是让Presenter 持有Activity的弱引用。</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BasePresenter</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span> <span class="token keyword">extends</span> <span class="token class-name">ImvpBaseView</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>  
  <span class="token keyword">protected</span> <span class="token class-name">Reference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span>mViewRef<span class="token punctuation">;</span>  
<span class="token comment">//建立关联 </span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attachView</span><span class="token punctuation">(</span><span class="token class-name">V</span> view<span class="token punctuation">)</span><span class="token punctuation">{</span>           
     mViewRef<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span> 
<span class="token comment">//获取view </span>
  <span class="token keyword">protected</span> <span class="token class-name">V</span> <span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
      <span class="token keyword">return</span> mViewRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token punctuation">}</span>    
<span class="token comment">//判断是否与View建立了关联</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isViewAttached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
      <span class="token keyword">return</span> mViewRef<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mViewRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">;</span> 
   <span class="token punctuation">}</span>   

 <span class="token comment">//该方法在activity或者Fragment的onDestory中调用 </span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detachView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
      <span class="token keyword">if</span><span class="token punctuation">(</span>mViewRef<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
        mViewRef<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
       mViewRef<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>     
   <span class="token punctuation">}</span>   
 <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><p>(2) 一个Activity对应多个P?</p> <p>有一定p重复实现，极少。</p> <p>(3) 接口过于复杂？</p> <p>建立Base类，抽common接口实现。</p></li> <li><p>....</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBaseView</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBasePresenter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseView</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">attachView</span><span class="token punctuation">(</span><span class="token class-name">V</span> view<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseActivity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">P</span> <span class="token keyword">extends</span> <span class="token class-name">IBasePresenter</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">IBaseView</span><span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">P</span> mPresenter<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token function">getLayoutId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化mPresenter</span>
        <span class="token function">initPresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>mPresenter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            mPresenter<span class="token punctuation">.</span><span class="token function">attachView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//初始化</span>
        <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 初始化mPresenter</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">initPresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">getLayoutId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BasePresenter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseView</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IBasePresenter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">DataManager</span> mDataManager<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">V</span> mView<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">BasePresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token class-name">AppDbHelper</span> appDbHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DbHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">AppPreferenceHelper</span> appPreferenceHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PreferenceHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">AppApiHelper</span> appApiHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         mDataManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataManager</span><span class="token punctuation">(</span>appDbHelper<span class="token punctuation">,</span> appApiHelper<span class="token punctuation">,</span> appPreferenceHelper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attachView</span><span class="token punctuation">(</span><span class="token class-name">V</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mView <span class="token operator">=</span> view<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MainContract</span> <span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">View</span> <span class="token keyword">extends</span> <span class="token class-name">IBaseView</span><span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">testGetMview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">Presenter</span> <span class="token keyword">extends</span> <span class="token class-name">IBasePresenter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">testGetMpresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">testDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">testRequestNetwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">testPreference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">BaseActivity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MainPresenter</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">MainContract<span class="token punctuation">.</span>View</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initPresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mPresenter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MainPresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mPresenter<span class="token punctuation">.</span><span class="token function">testGetMpresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPresenter<span class="token punctuation">.</span><span class="token function">testDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPresenter<span class="token punctuation">.</span><span class="token function">testRequestNetwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPresenter<span class="token punctuation">.</span><span class="token function">testPreference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getLayoutId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetMview</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;print&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;我是V层的引用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainPresenter</span> <span class="token keyword">extends</span> <span class="token class-name">BasePresenter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MainContract<span class="token punctuation">.</span>View</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">MainContract<span class="token punctuation">.</span>Presenter</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testGetMpresenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;print&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;我是P层的引用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mView<span class="token punctuation">.</span><span class="token function">testGetMview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mDataManager<span class="token punctuation">.</span><span class="token function">testDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRequestNetwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mDataManager<span class="token punctuation">.</span><span class="token function">testRequestNetwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPreference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mDataManager<span class="token punctuation">.</span><span class="token function">testPreference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h5 id="_3-mvvm"><a href="#_3-mvvm" class="header-anchor">#</a> 3.MVVM</h5> <p><a href="https://www.e-learn.cn/content/qita/615073" target="_blank" rel="noopener noreferrer">参考1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/loaderman/p/10076529.html" target="_blank" rel="noopener noreferrer">参考2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/antoniolg/androidmvvm" target="_blank" rel="noopener noreferrer">gitdemo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p><strong>关键字： MVVM、Databinding、ViewModel、LiveData、Lifecycle。</strong></p> <p>MVP中的P替换为VM。</p></blockquote> <p><img src="images/mvvm.png" alt="mvvm"></p> <ul><li><p><code>DataBinding</code>用来实现<code>View</code>层与<code>ViewModel</code>数据的双向绑定(但实际上在<code>Android Jetpack</code>中<code>DataBinding</code>只存在于布局和布局生命周期控制器之间,当数据变化绑定到布局生命周期控制器时再转发给<code>ViewModel</code>,布局控制器可以持有<code>DataBinding</code>但<code>ViewModel</code>不应该持有<code>DataBinding</code>)</p></li> <li><p><code>ViewModel</code>与<code>Presenter</code>大致相同,都是负责处理数据和实现业务逻辑,但是<code>ViewModel</code>层不应该直接或者间接地持有<code>View</code>层的任何引用,因为一个<code>ViewModel</code>不应该直达自己具体是和哪一个<code>View</code>进行交互的.<code>ViewModel</code>主要的工作就是将<code>Model</code>提供来的数据直接翻译成<code>View</code>层能够直接使用的数据,并将这些数据暴露出去,同时<code>ViewModel</code>也可以发布事件,供<code>View</code>层订阅.</p> <p>MVVM的核心思想是观察者模式,它通过事件和转移View层数据持有权来实现View层与ViewModel层的解耦.</p> <p>在MVVM中View不是数据的实际持有者,它只负责数据如何呈现以及点击事件的传递,不做的数据处理工作,而数据的处理者和持有者变成ViewModel,它通过接收View层传递过来的时间改变自身状态,发出事件或者改变自己持有的数据触发View的更新.</p> <p>MVVM解决了MVP中的存在的一些问题,比如它无需定义接口,ViewModel与View层彻底无关更好复用,并且有Google的Android Jetpack作为强力后援.</p> <p>但是MVVM也有自己的缺点,那就是使用MVVM的情况下ViewModel与View层的通信变得更加困难了,所以在一些极其简单的页面中请酌情使用,否则就会有一种脱裤子放屁的感觉,在使用MVP这个道理也依然适用.</p> <h5 id="_4-jetpack"><a href="#_4-jetpack" class="header-anchor">#</a> 4.Jetpack</h5> <blockquote><p><strong>Jetpack可以有效减少OOM和No Pointer Exception</strong></p></blockquote> <p><a href="https://developer.android.google.cn/jetpack" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/KunMinX/Jetpack-MVVM-Best-Practice" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="_3-进程通信方式和机制"><a href="#_3-进程通信方式和机制" class="header-anchor">#</a> 3.进程通信方式和机制</h4> <p><a href="https://www.jianshu.com/p/16daa35de724" target="_blank" rel="noopener noreferrer">参考1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p><strong>进程间通信 Inter-Process Communication（IPC）：是在多任务操作系统或联网的计算机之间运行的程序和进程所用的通信技术。有两种类型的进程间通信（IPC）。</strong> <strong>1 本地过程调用（LPC）：LPC用在多任务操作系统中，使得同时运行的任务能互相会话。这些任务共享内存空间使任务同步和互相发送信息。</strong> <strong>2　远程过程调用（RPC）：RPC类似于LPC，只是在网上工作RPC开始是出现在Sun微系统公司和HP公司的运行UNIX操作系统的计算机中。</strong></p></blockquote> <p><img src="images/ipc_info.jpeg" alt="ipc"></p> <ul><li><p>Messenger AIDI区别</p> <p>Messenger的本质也是AIDL，只不过对其进行了封装，在操作的时候不需要写.aidl问题；</p> <p>在server端，messenger处理任务是单线程的，aidl多多线程的；</p> <p>在client端，aidl是同步的，messenger是异步的。</p></li> <li><p><strong>都是基于Binder机制通信！！！</strong></p> <p>AIDL、Messenger、ContentProvider。</p></li> <li><p>为什么SystemServer进程与Zygote进程通讯采用Socket而不是Binder?</p> <p>fork只能拷贝当前线程，不支持多线程的fork。</p> <p>如果zygote使用binder的多线程模型与system_server进程进行通讯的话，fork()出的App进程的binder通讯没法用，那么只能再使用exec()启动一个新进程。</p> <p><a href="https://blog.csdn.net/qq_39037047/article/details/88066589" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h4 id="_4-flutter-reactnative"><a href="#_4-flutter-reactnative" class="header-anchor">#</a> 4.Flutter/ReactNative</h4> <h4 id="_5-ams、pms源码学习"><a href="#_5-ams、pms源码学习" class="header-anchor">#</a> 5.AMS、PMS源码学习</h4> <h4 id="_6-java注解"><a href="#_6-java注解" class="header-anchor">#</a> 6.Java注解</h4> <p><a href="https://www.cnblogs.com/yangming1996/p/9295168.html" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>「注解的本质就是一个继承了 Annotation 接口的接口」</strong>。</p> <p><strong>原理</strong></p> <p>应用层面：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// java内置Override注解</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>SOURCE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Override</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">// 本质是</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Override</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>虚拟机层面：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
	* 虚拟机编译时生成了代理类(注解类的所有方法都会被代理)。
	* 然后可以通过方法名获取注解属性值。
	*/</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> $<span class="token class-name">Proxy1</span> <span class="token keyword">extends</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">HelloWorldAnn</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m2<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m4<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m0<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m3<span class="token punctuation">;</span>

    <span class="token keyword">public</span> $<span class="token class-name">Proxy1</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m1<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>var1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> var3<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Class</span> <span class="token function">annotationType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m4<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m0<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            m1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;equals&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m2 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m4 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.company.MainTest$HelloWorldAnn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;annotationType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m0 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.Object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;hashCode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.company.MainTest$HelloWorldAnn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchMethodError</span><span class="token punctuation">(</span>var2<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoClassDefFoundError</span><span class="token punctuation">(</span>var3<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fc57e022.js" defer></script><script src="/assets/js/2.a8c6c3ae.js" defer></script><script src="/assets/js/43.b807463f.js" defer></script>
  </body>
</html>
