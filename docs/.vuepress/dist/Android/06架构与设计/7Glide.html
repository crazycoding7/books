<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Glide | 知鱼之乐@Android</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Just playing around 1">
    
    <link rel="preload" href="/assets/css/0.styles.6dee712c.css" as="style"><link rel="preload" href="/assets/js/app.6841e91c.js" as="script"><link rel="preload" href="/assets/js/2.a8c6c3ae.js" as="script"><link rel="preload" href="/assets/js/11.9fb18116.js" as="script"><link rel="prefetch" href="/assets/js/10.1f0b4cf4.js"><link rel="prefetch" href="/assets/js/100.97b9f065.js"><link rel="prefetch" href="/assets/js/101.5bce5ea4.js"><link rel="prefetch" href="/assets/js/102.3b97e9c2.js"><link rel="prefetch" href="/assets/js/103.0c53723c.js"><link rel="prefetch" href="/assets/js/104.f2a15478.js"><link rel="prefetch" href="/assets/js/105.6d5a56a5.js"><link rel="prefetch" href="/assets/js/106.ca343c2b.js"><link rel="prefetch" href="/assets/js/107.0e1aaf70.js"><link rel="prefetch" href="/assets/js/108.833b7b5c.js"><link rel="prefetch" href="/assets/js/109.1abd988b.js"><link rel="prefetch" href="/assets/js/110.b526fde0.js"><link rel="prefetch" href="/assets/js/111.d250d346.js"><link rel="prefetch" href="/assets/js/112.d27bf211.js"><link rel="prefetch" href="/assets/js/113.c81ebfd7.js"><link rel="prefetch" href="/assets/js/114.409f2ac2.js"><link rel="prefetch" href="/assets/js/115.19cb8561.js"><link rel="prefetch" href="/assets/js/116.746dc9c1.js"><link rel="prefetch" href="/assets/js/117.a88be900.js"><link rel="prefetch" href="/assets/js/118.40d7211d.js"><link rel="prefetch" href="/assets/js/119.81e390a3.js"><link rel="prefetch" href="/assets/js/12.acad5fe2.js"><link rel="prefetch" href="/assets/js/13.78011127.js"><link rel="prefetch" href="/assets/js/14.99cb3a34.js"><link rel="prefetch" href="/assets/js/15.ddb617e3.js"><link rel="prefetch" href="/assets/js/16.f3ba4f0d.js"><link rel="prefetch" href="/assets/js/17.1cfd46a3.js"><link rel="prefetch" href="/assets/js/18.e9655f93.js"><link rel="prefetch" href="/assets/js/19.0e7ceeb1.js"><link rel="prefetch" href="/assets/js/20.a663dfab.js"><link rel="prefetch" href="/assets/js/21.05dc3a84.js"><link rel="prefetch" href="/assets/js/22.51d1522c.js"><link rel="prefetch" href="/assets/js/23.a653a467.js"><link rel="prefetch" href="/assets/js/24.2c24f8ef.js"><link rel="prefetch" href="/assets/js/25.daf6f73d.js"><link rel="prefetch" href="/assets/js/26.3d35c600.js"><link rel="prefetch" href="/assets/js/27.69042bd0.js"><link rel="prefetch" href="/assets/js/28.bb8eb37c.js"><link rel="prefetch" href="/assets/js/29.42a3e28b.js"><link rel="prefetch" href="/assets/js/3.283f7f5f.js"><link rel="prefetch" href="/assets/js/30.ad49b03f.js"><link rel="prefetch" href="/assets/js/31.6afd9e33.js"><link rel="prefetch" href="/assets/js/32.aad686ad.js"><link rel="prefetch" href="/assets/js/33.1ae927e3.js"><link rel="prefetch" href="/assets/js/34.526c684e.js"><link rel="prefetch" href="/assets/js/35.e126696a.js"><link rel="prefetch" href="/assets/js/36.48bcbc8f.js"><link rel="prefetch" href="/assets/js/37.e62a9ac7.js"><link rel="prefetch" href="/assets/js/38.5da55e12.js"><link rel="prefetch" href="/assets/js/39.e9b8d28c.js"><link rel="prefetch" href="/assets/js/4.a4dd05ce.js"><link rel="prefetch" href="/assets/js/40.56177462.js"><link rel="prefetch" href="/assets/js/41.d34b7c29.js"><link rel="prefetch" href="/assets/js/42.f6c0f311.js"><link rel="prefetch" href="/assets/js/43.b807463f.js"><link rel="prefetch" href="/assets/js/44.0dd75758.js"><link rel="prefetch" href="/assets/js/45.172d766d.js"><link rel="prefetch" href="/assets/js/46.3efe575d.js"><link rel="prefetch" href="/assets/js/47.80f31f9f.js"><link rel="prefetch" href="/assets/js/48.1e54c9ea.js"><link rel="prefetch" href="/assets/js/49.e444e98b.js"><link rel="prefetch" href="/assets/js/5.f41556b0.js"><link rel="prefetch" href="/assets/js/50.dafe8f59.js"><link rel="prefetch" href="/assets/js/51.c67ee041.js"><link rel="prefetch" href="/assets/js/52.abf1cf4f.js"><link rel="prefetch" href="/assets/js/53.3d9b10da.js"><link rel="prefetch" href="/assets/js/54.8eeeee0a.js"><link rel="prefetch" href="/assets/js/55.34b140aa.js"><link rel="prefetch" href="/assets/js/56.e9cc391e.js"><link rel="prefetch" href="/assets/js/57.70580e95.js"><link rel="prefetch" href="/assets/js/58.14a2c9cf.js"><link rel="prefetch" href="/assets/js/59.ca8d6730.js"><link rel="prefetch" href="/assets/js/6.f4100330.js"><link rel="prefetch" href="/assets/js/60.63c7b0e1.js"><link rel="prefetch" href="/assets/js/61.7575b42a.js"><link rel="prefetch" href="/assets/js/62.ebe40240.js"><link rel="prefetch" href="/assets/js/63.8d04f05e.js"><link rel="prefetch" href="/assets/js/64.368cbdc8.js"><link rel="prefetch" href="/assets/js/65.0c100fe9.js"><link rel="prefetch" href="/assets/js/66.5cd493a6.js"><link rel="prefetch" href="/assets/js/67.845ccc17.js"><link rel="prefetch" href="/assets/js/68.041a0846.js"><link rel="prefetch" href="/assets/js/69.189a1471.js"><link rel="prefetch" href="/assets/js/7.773fb2ba.js"><link rel="prefetch" href="/assets/js/70.d16b58c2.js"><link rel="prefetch" href="/assets/js/71.d64c5d7b.js"><link rel="prefetch" href="/assets/js/72.60bbbddb.js"><link rel="prefetch" href="/assets/js/73.54838388.js"><link rel="prefetch" href="/assets/js/74.9fc3731e.js"><link rel="prefetch" href="/assets/js/75.d828f38b.js"><link rel="prefetch" href="/assets/js/76.df328550.js"><link rel="prefetch" href="/assets/js/77.c76fc4ba.js"><link rel="prefetch" href="/assets/js/78.d5289282.js"><link rel="prefetch" href="/assets/js/79.61a0689c.js"><link rel="prefetch" href="/assets/js/8.4ffe3bf9.js"><link rel="prefetch" href="/assets/js/80.4ce69602.js"><link rel="prefetch" href="/assets/js/81.3db499f6.js"><link rel="prefetch" href="/assets/js/82.a0daba6a.js"><link rel="prefetch" href="/assets/js/83.85f7eb07.js"><link rel="prefetch" href="/assets/js/84.02cd76ee.js"><link rel="prefetch" href="/assets/js/85.68ef1379.js"><link rel="prefetch" href="/assets/js/86.632cc2f9.js"><link rel="prefetch" href="/assets/js/87.45b66c9f.js"><link rel="prefetch" href="/assets/js/88.a5d932e2.js"><link rel="prefetch" href="/assets/js/89.db41fe75.js"><link rel="prefetch" href="/assets/js/9.39a8535d.js"><link rel="prefetch" href="/assets/js/90.388cf60c.js"><link rel="prefetch" href="/assets/js/91.c4c20f24.js"><link rel="prefetch" href="/assets/js/92.7eeec473.js"><link rel="prefetch" href="/assets/js/93.77ccfce3.js"><link rel="prefetch" href="/assets/js/94.e1d8cd25.js"><link rel="prefetch" href="/assets/js/95.da7d783a.js"><link rel="prefetch" href="/assets/js/96.e857c3ab.js"><link rel="prefetch" href="/assets/js/97.5b011ec2.js"><link rel="prefetch" href="/assets/js/98.064887d6.js"><link rel="prefetch" href="/assets/js/99.377e6f70.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6dee712c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">知鱼之乐@Android</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Android基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Android/01基础机制/1.Android系统启动流程.html" class="sidebar-link">Android系统启动过程</a></li><li><a href="/Android/01基础机制/2.Binder进程通信机制.html" class="sidebar-link">Binder进程通信机制</a></li><li><a href="/Android/07面试题/1.面试题-计算机基础.html" class="sidebar-link">1面试题-计算机基础</a></li><li><a href="/Android/07面试题/2.面试题-Android.html" class="sidebar-link">2面试题-Android</a></li><li><a href="/Android/07面试题/3.面试题-架构设计.html" class="sidebar-link">3面试题-架构设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>操作系统等</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/操作系统等/C编译原理.html" class="sidebar-link">C++编译原理</a></li><li><a href="/操作系统等/Linux常用操作手册.html" class="sidebar-link">Linux操作手册</a></li><li><a href="/操作系统等/IOS.html" class="sidebar-link">IOS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tools</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Tools/1.Mac开发快捷键大全.html" class="sidebar-link">Mac开发快捷键大全</a></li><li><a href="/Tools/2.翻墙工具指南.html" class="sidebar-link">翻墙工具指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>投名状</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ppt/警世通言.html" class="sidebar-link">警世通言</a></li><li><a href="/ppt/1.阿里技术合伙人.html" class="sidebar-link">阿里技术</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="glide"><a href="#glide" class="header-anchor">#</a> Glide</h2> <p>[TOC]</p> <h4 id="_1-介绍"><a href="#_1-介绍" class="header-anchor">#</a> 1. 介绍</h4> <p>​	Glide是一个高效的Android图片加载库，注重平滑的滚动。</p> <p><img src="/assets/img/glide_cache.51eee703.png" alt=""></p> <ul><li>优点</li></ul> <h5 id="生命周期集成"><a href="#生命周期集成" class="header-anchor">#</a> <strong>生命周期集成</strong>;</h5> <p>1、创建一个无UI的Fragment，具体来说是<code>SupportRequestManagerFragment／RequestManagerFragment</code>，并绑定到当前Activity，这样Fragment就可以感知Activity的生命周期；
2、在创建Fragment时，初始化<code>Lifecycle</code>、<code>LifecycleListener</code>，并且在生命周期的onStart() 、onStop()、 onDestroy()中调用相关方法；
3、在创建RequestManager时传入<code>Lifecycle</code> 对象，并且LifecycleListener实现了<code>LifecycleListener</code>接口；
4、这样当生命周期变化的时候，就能通过接口回调去通知RequestManager处理请求。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 空UI</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SupportRequestManagerFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token string">&quot;SupportRMFragment&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ActivityFragmentLifecycle</span> lifecycle<span class="token punctuation">;</span>
  
   <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lifecycle<span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通知对应的RequestManager处理图片请求(1对多通知)！</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lifecycle<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lifecycle<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">unregisterFragmentWithRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 请求类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestManager</span>
    <span class="token keyword">implements</span>  <span class="token class-name">LifecycleListener</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resumeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    targetTracker<span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pauseRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    targetTracker<span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetTracker<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> target <span class="token operator">:</span> targetTracker<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clear</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    targetTracker<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    requestTracker<span class="token punctuation">.</span><span class="token function">clearRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre></div><h5 id="高效的缓存机制"><a href="#高效的缓存机制" class="header-anchor">#</a> <strong>高效的缓存机制</strong></h5> <ol><li><p>Glide缓存机制大致分为三层：Lru算法缓存、弱引用缓存、磁盘缓存。</p> <p>读取的顺序是：弱引用缓存、Lru算法缓存、磁盘缓存</p> <p>写入的顺序是：弱引用缓存、Lru算法缓存、磁盘缓存（不准确）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Engine</span><span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span>
      <span class="token class-name">MemoryCache</span> memoryCache<span class="token punctuation">,</span> <span class="token comment">// 内存缓存</span>
      <span class="token class-name">DiskCache<span class="token punctuation">.</span>Factory</span> diskCacheFactory<span class="token punctuation">,</span> <span class="token comment">// 硬盘缓存</span>
      <span class="token class-name">GlideExecutor</span> diskCacheExecutor<span class="token punctuation">,</span>
      <span class="token class-name">GlideExecutor</span> sourceExecutor<span class="token punctuation">,</span>
      <span class="token class-name">GlideExecutor</span> sourceUnlimitedExecutor<span class="token punctuation">,</span>
      <span class="token class-name">GlideExecutor</span> animationExecutor<span class="token punctuation">,</span>
      <span class="token keyword">boolean</span> isActiveResourceRetentionAllowed<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
  
	<span class="token comment">// 加载图片</span>
  <span class="token keyword">private</span> <span class="token class-name">EngineResource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadFromMemory</span><span class="token punctuation">(</span>
      <span class="token class-name">EngineKey</span> key<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isMemoryCacheable<span class="token punctuation">,</span> <span class="token keyword">long</span> startTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMemoryCacheable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">EngineResource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> active <span class="token operator">=</span> <span class="token function">loadFromActiveResources</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 弱引用加载正在使用的图片</span>
    <span class="token comment">// 实现代码：final Map&lt;Key, ResourceWeakReference&gt; activeEngineResources = new HashMap&lt;&gt;();</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>active <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>VERBOSE_IS_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded resource from active resources&quot;</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> active<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">EngineResource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> cached <span class="token operator">=</span> <span class="token function">loadFromCache</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// LruCache LinkedHashMap加载图片</span>
    <span class="token comment">// 实现代码： LruResourceCache 中的   private final Map&lt;T, Y&gt; cache = new LinkedHashMap&lt;&gt;(100, 0.75f, true);</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>VERBOSE_IS_LOGGABLE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">logWithTimeAndKey</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded resource from cache&quot;</span><span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
  
</code></pre></div></li></ol> <img src="/Users/xin/AndroidBlogs/android/06架构与设计/images/glide_cache.png" style="zoom:80%;"> <h5 id="多种图片格式的缓存-支持gif、缩略图等。"><a href="#多种图片格式的缓存-支持gif、缩略图等。" class="header-anchor">#</a> <strong>多种图片格式的缓存，支持GIF、缩略图等。</strong></h5> <ul><li><p>ARGB_8888 :32位图,带透明度,每个像素占4个字节</p></li> <li><p>ARGB_4444 :16位图,带透明度,每个像素占2个字节</p></li> <li><p>RGB_565 :16位图,不带透明度,每个像素占2个字节</p></li> <li><p>ALPHA_8 :32位图,只有透明度,不带颜色,每个像素占4个字节</p> <p>Picasso的默认质量是 ARGB_8888
Glide的默认质量则为 RGB_565</p> <p><strong>Picasso</strong> 是下载图片然后缓存完整的大小到本地，比如说图片的大小是1080p的，之后如果我需要同一张图片，就会返回这张 full size 的，如果我需要resize，也是对这种 full size 的做 resize。</p> <p><strong>Glide</strong> 则是完全不一样的做法。Glide 是会先下载图片，然后改变图片的大小，以适应 imageView 的要求，然后缓存到本地。 所以如果你是下载同一张图片，但是设定两个不一样大小的 imageView, 那么Glide 实际上是会缓存两份。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 根据不同显示的宽高生成不同的缓存</span>
<span class="token keyword">public</span> <span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span> LoadStatus <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    EngineKey key <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">buildKey</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> 
width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> resourceClass<span class="token punctuation">,</span> transcodeClass<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h4 id="_2-原理"><a href="#_2-原理" class="header-anchor">#</a> 2. 原理</h4> <ul><li><p>异步加载</p> <p>主要用到三个线程池，然后通过handler进行UI更新</p> <p>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GlideBuilder</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">GlideExecutor</span> sourceExecutor<span class="token punctuation">;</span>   <span class="token comment">//加载源文件的线程池，包括网络加载</span>
  <span class="token keyword">private</span> <span class="token class-name">GlideExecutor</span> diskCacheExecutor<span class="token punctuation">;</span> <span class="token comment">//加载硬盘缓存的线程池</span>
  <span class="token keyword">private</span> <span class="token class-name">GlideExecutor</span> animationExecutor<span class="token punctuation">;</span> <span class="token comment">//动画线程池</span>
<span class="token punctuation">}</span>
<span class="token comment">// 通过handler通知UI更新</span>
<span class="token keyword">private</span> val MAIN_THREAD_EXECUTOR <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> val handler <span class="token operator">=</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        override fun <span class="token function">execute</span><span class="token punctuation">(</span>command<span class="token operator">:</span> <span class="token class-name">Runnable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            handler<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对象池技术request、弱引用 WeakHashMap&lt;Request, Boolean&gt;、内置线程池也支持okhttp等。</p></li> <li><p>缓存</p> <p>图片三级缓存：内存缓存、硬盘缓存、网络。</p> <ol><li><p>内存缓存</p> <p>利用LRUCache算法。利用LinkedHashmap实现有序(hashmap+双向链表)。</p> <p>LruCache小结：</p> <ul><li><strong>LinkHashMap 继承HashMap，在 HashMap的基础上，新增了双向链表结构，每次访问数据的时候，会更新被访问的数据的链表指针，具体就是先在链表中删除该节点，然后添加到链表头header之前，这样就保证了链表头header节点之前的数据都是最近访问的（从链表中删除并不是真的删除数据，只是移动链表指针，数据本身在map中的位置是不变的）。</strong></li> <li><strong>LruCache 内部用LinkHashMap存取数据，在双向链表保证数据新旧顺序的前提下，设置一个最大内存，往里面put数据的时候，当数据达到最大内存的时候，将最老的数据移除掉，保证内存不超过设定的最大值。</strong></li></ul></li> <li><p>硬盘缓存类似</p></li></ol></li> <li><p>防止OOM</p> <ol><li><p>LruCache缓存大小设置，可以有效防止OOM；</p></li> <li><p>LruCache里存的是软引用对象，那么当内存不足的时候，Bitmap会被回收，也就是说通过SoftReference修饰的Bitmap就不会导致OOM；</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LruCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SoftReference</span><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mLruCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LruCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SoftReference</span><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">sizeOf</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//默认返回1，这里应该返回Bitmap占用的内存大小，单位：K</span>
            <span class="token comment">//Bitmap被回收了，大小是0</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getByteCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>onLowMemory</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//Glide</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLowMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Engine asserts this anyway when removing resources, fail faster and consistently</span>
    <span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">assertMainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// memory cache needs to be cleared before bitmap pool to clear re-pooled Bitmaps too. See #687.</span>
    memoryCache<span class="token punctuation">.</span><span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitmapPool<span class="token punctuation">.</span><span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    arrayPool<span class="token punctuation">.</span><span class="token function">clearMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Bitmap像素存储考虑</p> <p><strong>Bitmap的像素数据大小 = 宽 * 高 * 1像素占用的内存。</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token comment">// 1像素占用字节数</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ALPHA_8_BYTES_PER_PIXEL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ARGB_4444_BYTES_PER_PIXEL <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ARGB_8888_BYTES_PER_PIXEL <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> RGB_565_BYTES_PER_PIXEL <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// glide</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> RGBA_F16_BYTES_PER_PIXEL <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
</code></pre></div><p>如果Bitmap使用 <code>RGB_565</code> 格式，则1像素占用 2 byte，<code>ARGB_8888</code> 格式则占4 byte。
<strong>在选择图片加载框架的时候，可以将内存占用这一方面考虑进去，更少的内存占用意味着发生OOM的概率越低。</strong> Glide内存开销是Picasso的一半，就是因为默认Bitmap格式不同。</p> <p><strong>那是否可以让像素数据不放在java堆中，而是放在native堆中呢</strong>？据说Android 3.0到8.0 之间Bitmap像素数据存在Java堆，而8.0之后像素数据存到native堆中。</p></li></ol></li> <li><p>内存泄漏</p> <p>当然，修改也比较简单粗暴，<strong>将ImageView用WeakReference修饰</strong>就完事了。</p> <p>事实上，这种方式虽然解决了内存泄露问题，但是并不完美，例如在界面退出的时候，我们除了希望ImageView被回收，同时希望加载图片的任务可以取消，队未执行的任务可以移除。</p> <p>Glide的做法是监听生命周期回调，看 <code>RequestManager</code> 这个类,在Activity/fragment 销毁的时候，取消图片加载任务，细节大家可以自己去看源。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetTracker<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> target <span class="token operator">:</span> targetTracker<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//清理任务</span>
      <span class="token function">clear</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    targetTracker<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    requestTracker<span class="token punctuation">.</span><span class="token function">clearRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lifecycle<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lifecycle<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span>connectivityMonitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mainHandler<span class="token punctuation">.</span><span class="token function">removeCallbacks</span><span class="token punctuation">(</span>addSelfToLifecycle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    glide<span class="token punctuation">.</span><span class="token function">unregisterRequestManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>其他</p></li></ul> <h6 id="图片错乱"><a href="#图片错乱" class="header-anchor">#</a> 图片错乱</h6> <p>由于RecyclerView或者LIstView的复用机制，网络加载图片开始的时候ImageView是第一个item的，加载成功之后ImageView由于复用可能跑到第10个item去了，在第10个item显示第一个item的图片肯定是错的。</p> <p>常规的做法是给ImageView设置tag，tag一般是图片地址，更新ImageView之前判断tag是否跟url一致。</p> <p>当然，可以在item从列表消失的时候，取消对应的图片加载任务。要考虑放在图片加载框架做还是放在UI做比较合适。</p> <h6 id="线程池任务过多"><a href="#线程池任务过多" class="header-anchor">#</a> 线程池任务过多</h6> <p>列表滑动，会有很多图片请求，如果是第一次进入，没有缓存，那么队列会有很多任务在等待。所以在请求网络图片之前，需要判断队列中是否已经存在该任务，存在则不加到队列去。</p> <h4 id="_3-如果让你设计一个图片加载框架-你会考虑哪些问题"><a href="#_3-如果让你设计一个图片加载框架-你会考虑哪些问题" class="header-anchor">#</a> 3. 如果让你设计一个图片加载框架，你会考虑哪些问题？</h4> <p>框架涉及知识点</p> <ol><li>异步加载：线程池；</li> <li>切换线程：Handler；</li> <li>缓存策略：LruCache、DiskLurCache</li> <li>防止OOM：软引用、LruCache、图片压缩、Bitmap像素存储；</li> <li>内存泄漏：生命周期集成；</li> <li>列表滑动加载问题：加载错乱、队列满任务多问题。</li></ol> <h4 id="_4-如何加载大图和长图"><a href="#_4-如何加载大图和长图" class="header-anchor">#</a> 4. 如何加载大图和长图</h4> <h5 id="_1-图片压缩-利用bitmapfactory-options-insamplesize-按比例压缩"><a href="#_1-图片压缩-利用bitmapfactory-options-insamplesize-按比例压缩" class="header-anchor">#</a> <strong>1. 图片压缩(利用BitmapFactory.Options inSampleSize 按比例压缩)；</strong></h5> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token function">getAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token string">&quot;tangyan.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token comment">//先获得图片的宽、高，然后根据显示大小进行压缩  </span>
  <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> tmpOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  tmpOptions<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
  <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tmpOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token keyword">int</span> width <span class="token operator">=</span> tmpOptions<span class="token punctuation">.</span>outWidth<span class="token punctuation">;</span>  
 <span class="token keyword">int</span> height <span class="token operator">=</span> tmpOptions<span class="token punctuation">.</span>outHeight<span class="token punctuation">;</span> 
</code></pre></div><h5 id="_2-局部显示-bitmapregiondecoder"><a href="#_2-局部显示-bitmapregiondecoder" class="header-anchor">#</a> <strong>2. 局部显示(BitmapRegionDecoder);</strong></h5> <p><code>Android</code>里面是利用<code>BitmapRegionDecoder</code>来局部展示图片的，展示的是一块矩形区域。为了完成这个功能那么就需要一个方法设置图片，另一个方法设置展示的区域。</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">//设置显示图片的中心区域(显示一个图片大小为一般的矩形区域)  </span>
	<span class="token class-name">BitmapRegionDecoder</span> bitmapRegionDecoder <span class="token operator">=</span> <span class="token class-name">BitmapRegionDecoder</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
options<span class="token punctuation">.</span>inPreferredConfig <span class="token operator">=</span> <span class="token class-name">Bitmap<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span>RGB_565<span class="token punctuation">;</span>  
	<span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> bitmapRegionDecoder<span class="token punctuation">.</span><span class="token function">decodeRegion</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">,</span> width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>  
	mImageView<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
</code></pre></div><p>根据上面的分析呢，我们这个自定义控件思路就非常清晰了：</p> <ul><li>提供一个设置图片的入口</li> <li>重写onTouchEvent，在里面根据用户移动的手势，去更新显示区域的参数</li> <li>每次更新区域参数后，调用invalidate，onDraw里面去regionDecoder.decodeRegion拿到bitmap，去draw</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zhy<span class="token punctuation">.</span>blogcodes<span class="token punctuation">.</span>largeImage<span class="token punctuation">.</span>view</span><span class="token punctuation">;</span>  
  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Bitmap</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">BitmapFactory</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">BitmapRegionDecoder</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Canvas</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Rect</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">AttributeSet</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">MotionEvent</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">;</span>  
  
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>  
  
<span class="token comment">/**  
 * Created by zhy on 15/5/16.  
 */</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LargeImageView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span>  
<span class="token punctuation">{</span>  
    <span class="token keyword">private</span> <span class="token class-name">BitmapRegionDecoder</span> mDecoder<span class="token punctuation">;</span>  
    <span class="token comment">/**  
     * 图片的宽度和高度  
     */</span>  
    <span class="token keyword">private</span> <span class="token keyword">int</span> mImageWidth<span class="token punctuation">,</span> mImageHeight<span class="token punctuation">;</span>  
    <span class="token comment">/**  
     * 绘制的区域  
     */</span>  
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">Rect</span> mRect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">private</span> <span class="token class-name">MoveGestureDetector</span> mDetector<span class="token punctuation">;</span>  
  
  
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
    <span class="token keyword">static</span>  
    <span class="token punctuation">{</span>  
        options<span class="token punctuation">.</span>inPreferredConfig <span class="token operator">=</span> <span class="token class-name">Bitmap<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span>RGB_565<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setInputStream</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> is<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">try</span>  
        <span class="token punctuation">{</span>  
            mDecoder <span class="token operator">=</span> <span class="token class-name">BitmapRegionDecoder</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span> tmpOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapFactory<span class="token punctuation">.</span>Options</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// Grab the bounds for the scene dimensions  </span>
            tmpOptions<span class="token punctuation">.</span>inJustDecodeBounds <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
            <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tmpOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            mImageWidth <span class="token operator">=</span> tmpOptions<span class="token punctuation">.</span>outWidth<span class="token punctuation">;</span>  
            mImageHeight <span class="token operator">=</span> tmpOptions<span class="token punctuation">.</span>outHeight<span class="token punctuation">;</span>  
  
            <span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span> <span class="token keyword">finally</span>  
        <span class="token punctuation">{</span>  
  
            <span class="token keyword">try</span>  
            <span class="token punctuation">{</span>  
                <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>  
            <span class="token punctuation">{</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
  
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        mDetector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MoveGestureDetector</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MoveGestureDetector<span class="token punctuation">.</span>SimpleMoveGestureDetector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            <span class="token annotation punctuation">@Override</span>  
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onMove</span><span class="token punctuation">(</span><span class="token class-name">MoveGestureDetector</span> detector<span class="token punctuation">)</span>  
            <span class="token punctuation">{</span>  
                <span class="token keyword">int</span> moveX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> detector<span class="token punctuation">.</span><span class="token function">getMoveX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token keyword">int</span> moveY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> detector<span class="token punctuation">.</span><span class="token function">getMoveY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mImageWidth <span class="token operator">&gt;</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
                <span class="token punctuation">{</span>  
                    mRect<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token operator">-</span>moveX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token function">checkWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token punctuation">}</span>  
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mImageHeight <span class="token operator">&gt;</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
                <span class="token punctuation">{</span>  
                    mRect<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>moveY<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token function">checkHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                    <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token punctuation">}</span>  
  
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
  
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
  
  
        <span class="token class-name">Rect</span> rect <span class="token operator">=</span> mRect<span class="token punctuation">;</span>  
        <span class="token keyword">int</span> imageWidth <span class="token operator">=</span> mImageWidth<span class="token punctuation">;</span>  
        <span class="token keyword">int</span> imageHeight <span class="token operator">=</span> mImageHeight<span class="token punctuation">;</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>right <span class="token operator">&gt;</span> imageWidth<span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            rect<span class="token punctuation">.</span>right <span class="token operator">=</span> imageWidth<span class="token punctuation">;</span>  
            rect<span class="token punctuation">.</span>left <span class="token operator">=</span> imageWidth <span class="token operator">-</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>left <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            rect<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
            rect<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
  
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
  
        <span class="token class-name">Rect</span> rect <span class="token operator">=</span> mRect<span class="token punctuation">;</span>  
        <span class="token keyword">int</span> imageWidth <span class="token operator">=</span> mImageWidth<span class="token punctuation">;</span>  
        <span class="token keyword">int</span> imageHeight <span class="token operator">=</span> mImageHeight<span class="token punctuation">;</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>bottom <span class="token operator">&gt;</span> imageHeight<span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            rect<span class="token punctuation">.</span>bottom <span class="token operator">=</span> imageHeight<span class="token punctuation">;</span>  
            rect<span class="token punctuation">.</span>top <span class="token operator">=</span> imageHeight <span class="token operator">-</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>top <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  
        <span class="token punctuation">{</span>  
            rect<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  
            rect<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
  
  
    <span class="token keyword">public</span> <span class="token class-name">LargeImageView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        mDetector<span class="token punctuation">.</span><span class="token function">onToucEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token class-name">Bitmap</span> bm <span class="token operator">=</span> mDecoder<span class="token punctuation">.</span><span class="token function">decodeRegion</span><span class="token punctuation">(</span>mRect<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>bm<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
  
    <span class="token annotation punctuation">@Override</span>  
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onMeasure</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token keyword">int</span> imageWidth <span class="token operator">=</span> mImageWidth<span class="token punctuation">;</span>  
        <span class="token keyword">int</span> imageHeight <span class="token operator">=</span> mImageHeight<span class="token punctuation">;</span>  
  
         <span class="token comment">//默认直接显示图片的中心区域，可以自己去调节  </span>
        mRect<span class="token punctuation">.</span>left <span class="token operator">=</span> imageWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>  
        mRect<span class="token punctuation">.</span>top <span class="token operator">=</span> imageHeight <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>  
        mRect<span class="token punctuation">.</span>right <span class="token operator">=</span> mRect<span class="token punctuation">.</span>left <span class="token operator">+</span> width<span class="token punctuation">;</span>  
        mRect<span class="token punctuation">.</span>bottom <span class="token operator">=</span> mRect<span class="token punctuation">.</span>top <span class="token operator">+</span> height<span class="token punctuation">;</span>  
  
    <span class="token punctuation">}</span>  
  
  
<span class="token punctuation">}</span>  
</code></pre></div><p>根据上述源码:</p> <ol><li>setInputStream里面去获得图片的真实的宽度和高度，以及初始化我们的mDecoder</li> <li>onMeasure里面为我们的显示区域的rect赋值，大小为view的尺寸</li> <li>onTouchEvent里面我们监听move的手势，在监听的回调里面去改变rect的参数，以及做边界检查，最后invalidate</li> <li>在onDraw里面就是根据rect拿到bitmap，然后draw了</li></ol> <h5 id="_3-降低图片质量、利用本地内存保存bitmap"><a href="#_3-降低图片质量、利用本地内存保存bitmap" class="header-anchor">#</a> <strong>3. 降低图片质量、利用本地内存保存BitMap</strong></h5> <ul><li>参考</li></ul> <p><a href="https://juejin.im/post/5dbeda27e51d452a161e00c8" target="_blank" rel="noopener noreferrer">设计图片加载框架<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/billshen/p/13306285.html" target="_blank" rel="noopener noreferrer">生命周期和缓存机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/Piasy/BigImageViewer" target="_blank" rel="noopener noreferrer">BigImageViewer SubsamplingScaleImageView<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/mingfeng002/p/11400433.html" target="_blank" rel="noopener noreferrer">Android  bitmap 存储位置变迁<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_32019367/article/details/103883118" target="_blank" rel="noopener noreferrer">框架介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6841e91c.js" defer></script><script src="/assets/js/2.a8c6c3ae.js" defer></script><script src="/assets/js/11.9fb18116.js" defer></script>
  </body>
</html>
